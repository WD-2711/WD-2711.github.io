<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="pragma" content="no-cache">
  <meta http-equiv="cache-control" content="no-cache">
  <meta http-equiv="expires" content="0">
  
  <title>wmctf-2023 | wd-z711&#39;s B10g</title>
  <meta name="author" content="wd-z711">
  
  <meta name="description" content="Common student in China. Interested in web &amp; re.">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="wmctf-2023"/>
  <meta property="og:site_name" content="wd-z711&#39;s B10g"/>

  
    <meta property="og:image" content=""/>
  

  
  
    <link href="/favicon.png" rel="icon">
  
  
  <link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>

  <!-- analytics -->
  
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'G-YHJSKZDC3Y', 'auto');
  ga('send', 'pageview');
</script>




<meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="wd-z711's B10g" type="application/atom+xml">
</head>

 <body>  
  <nav id="main-nav" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
      <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
		<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
	  <a class="navbar-brand" href="/">wd-z711&#39;s B10g</a>
      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		  
		  <li>
			<a href="/archives" title="All the articles.">
			  <i class="fa fa-archive"></i>Archives
			</a>
		  </li>
		  
		  <li>
			<a href="/categories" title="All the categories.">
			  <i class="fa fa-folder"></i>Categories
			</a>
		  </li>
		  
		  <li>
			<a href="/about" title="About me.">
			  <i class="fa fa-user"></i>About
			</a>
		  </li>
		  
		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
  	<div class="content">
    	 


	
		<div class="page-header">
			<h1> wmctf-2023</h1>
		</div>
	



<div class="row post">

	<!-- cols -->
	
	<div id="top_meta"></div>
	<div class="col-md-9">
	

	<!-- content -->
	<div class="mypage">		
	  		

	  <h1 id="WMCTF2023"><a href="#WMCTF2023" class="headerlink" title="WMCTF2023"></a>WMCTF2023</h1><p>&emsp;8.20的比赛，拖了快两个月，我是懒狗，呜呜呜。</p>
<span id="more"></span>
<h2 id="0x00-ezAndroid"><a href="#0x00-ezAndroid" class="headerlink" title="0x00 ezAndroid"></a>0x00 ezAndroid</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">耐心搜索</span><br></pre></td></tr></table></figure>
<p>&emsp;Android killer与PKID显示未加壳。jeb打开：</p>
<p><img src="/images/wmctf-2023/image-20231011140306345.png" alt="image-20231011140306345" style="zoom:67%;" /></p>
<p>&emsp;跟踪this.CheckUsername与this.check2函数。发现是naive层的函数，如下所示：</p>
<p><img src="/images/wmctf-2023/image-20231011140418292.png" alt="image-20231011140418292" style="zoom:67%;" /></p>
<p>&emsp;（1）找到java函数在native层对应的函数符号，并以此找到函数地址。（包名：<code>com.wmctf.ezandroid</code>）</p>
<p>&emsp;&emsp;（a）objection注入失败（frida反调试），但是幸运的是，关键函数CheckUsername与check2都使用动态注册，根据frida_hook_libart，有：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">frida -U -f com.wmctf.ezandroid -l hook_RegisterNatives.js --no-pause</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;（2）可以得到CheckUsername和check2在libezandroid.so中的名字：<code>0x35a4</code>与<code>0x3f0c</code>。如下所示：</p>
<p><img src="/images/wmctf-2023/image-20231011143020836.png" alt="image-20231011143020836" style="zoom:67%;" /></p>
<h3 id="sub-35a4-CheckUsername"><a href="#sub-35a4-CheckUsername" class="headerlink" title="sub_35a4-CheckUsername"></a>sub_35a4-CheckUsername</h3><h4 id="Step1"><a href="#Step1" class="headerlink" title="Step1"></a>Step1</h4><p>&emsp;分析libezandroid.so，对于sub_35a4（CheckUsername），其中首先调用了sub_3EC0(a1, name, 0LL)，其中a1为JNIEnv，name为用户名。跟进后，发现是JNIEnv+0x548函数。</p>
<p><img src="/images/wmctf-2023/image-20231011144740090.png" alt="image-20231011144740090" style="zoom:67%;" /></p>
<p>&emsp;因此，打算hook sub_3EC0函数，并打印其输入与返回值。但是首先，先绕过反调试（<code>因为frida注入时总会退出</code>）。</p>
<h4 id="Step2"><a href="#Step2" class="headerlink" title="Step2"></a>Step2</h4><p>&emsp;&emsp;反调试绕过，见<a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/278827">链接</a>。首先查看open了哪些文件：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// look_open.js</span></span><br><span class="line"><span class="comment">// find open function in all modules</span></span><br><span class="line"><span class="keyword">var</span> pth = <span class="title class_">Module</span>.<span class="title function_">findExportByName</span>(<span class="literal">null</span>, <span class="string">&quot;open&quot;</span>)</span><br><span class="line"><span class="title class_">Interceptor</span>.<span class="title function_">attach</span>(pth, &#123;</span><br><span class="line">    <span class="attr">onEnter</span>:<span class="keyword">function</span>(<span class="params">args</span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">filename</span> = args[<span class="number">0</span>]</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">filename</span>.<span class="title function_">readCString</span>())</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">onLeave</span>:<span class="keyword">function</span>(<span class="params">ret</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> ret</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>&emsp;发现断在了：</p>
<p><img src="/images/wmctf-2023/image-20231011160627564.png" alt="image-20231011160627564" style="zoom:67%;" /></p>
<p>&emsp;/proc/self/maps用于访问当前进程的内存映射信息。查看此映射信息：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// look_maps.js</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">look_maps</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">		<span class="keyword">var</span> source_path = <span class="string">&quot;file://&quot;</span> + <span class="string">&quot;/proc/self/maps&quot;</span></span><br><span class="line">		<span class="keyword">var</span> <span class="title class_">Paths</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;java.nio.file.Paths&quot;</span>);</span><br><span class="line">		<span class="keyword">var</span> <span class="variable constant_">URI</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;java.net.URI&quot;</span>);</span><br><span class="line">		<span class="keyword">var</span> path = <span class="title class_">Paths</span>.<span class="title function_">get</span>(<span class="variable constant_">URI</span>.<span class="title function_">create</span>(source_path));</span><br><span class="line">		<span class="keyword">var</span> <span class="title class_">Files</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;java.nio.file.Files&quot;</span>);</span><br><span class="line">		<span class="keyword">var</span> fileBytes = <span class="title class_">Files</span>.<span class="title function_">readAllBytes</span>(path);</span><br><span class="line">		<span class="keyword">var</span> <span class="title class_">JString</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;java.lang.String&quot;</span>);</span><br><span class="line">		<span class="keyword">var</span> ret = <span class="title class_">JString</span>.$new(fileBytes);</span><br><span class="line">		<span class="variable language_">console</span>.<span class="title function_">log</span>(ret)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">setImmediate</span>(look_maps)</span><br></pre></td></tr></table></figure>
<p>&emsp;当挂上frida之后，如下所示：</p>
<p><img src="/images/wmctf-2023/image-20231011164144232.png" alt="image-20231011164144232" style="zoom:67%;" /></p>
<p>&emsp;要绕过此检测，就要备份一个正常启动的maps文件，如下所示：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// bypass.js</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">bypass</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> openPtr = <span class="title class_">Module</span>.<span class="title function_">getExportByName</span>(<span class="string">&#x27;libc.so&#x27;</span>, <span class="string">&#x27;open&#x27;</span>);</span><br><span class="line">    <span class="keyword">var</span> open = <span class="keyword">new</span> <span class="title class_">NativeFunction</span>(openPtr, <span class="string">&#x27;int&#x27;</span>, [<span class="string">&#x27;pointer&#x27;</span>, <span class="string">&#x27;int&#x27;</span>]);</span><br><span class="line">    <span class="comment">// 事先准备好</span></span><br><span class="line">    <span class="keyword">var</span> fakePath = <span class="string">&quot;/data/local/tmp/ezandroid.maps&quot;</span>;</span><br><span class="line">    <span class="comment">// 替换 open 函数</span></span><br><span class="line">    <span class="title class_">Interceptor</span>.<span class="title function_">replace</span>(openPtr, <span class="keyword">new</span> <span class="title class_">NativeCallback</span>(<span class="keyword">function</span> (<span class="params">pathnameptr, flag</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> pathname = <span class="title class_">Memory</span>.<span class="title function_">readUtf8String</span>(pathnameptr);</span><br><span class="line">        <span class="keyword">var</span> realFd = <span class="title function_">open</span>(pathnameptr, flag);</span><br><span class="line">        <span class="comment">// pathname 中含有 &quot;maps&quot;，此时返回 fakePath 的 fd</span></span><br><span class="line">        <span class="keyword">if</span> (pathname.<span class="title function_">indexOf</span>(<span class="string">&quot;maps&quot;</span>) &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> filename = <span class="title class_">Memory</span>.<span class="title function_">allocUtf8String</span>(fakePath);</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_">open</span>(filename, flag);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">var</span> fd = <span class="title function_">open</span>(pathnameptr, flag);</span><br><span class="line">        <span class="keyword">return</span> fd;</span><br><span class="line">    &#125;, <span class="string">&#x27;int&#x27;</span>, [<span class="string">&#x27;pointer&#x27;</span>, <span class="string">&#x27;int&#x27;</span>]));</span><br><span class="line">  &#125;</span><br><span class="line"><span class="title function_">setImmediate</span>(bypass)</span><br></pre></td></tr></table></figure>
<h4 id="Step3"><a href="#Step3" class="headerlink" title="Step3"></a>Step3</h4><p>&emsp;快乐的hook sub_3EC0()：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// hook_sub_3EC0.js</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">bypass</span>(<span class="params"></span>) &#123;</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line"><span class="title function_">setImmediate</span>(bypass)</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">hook_sub_3ec0</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> offset = <span class="number">0x3ec0</span></span><br><span class="line">    <span class="keyword">var</span> base = <span class="title class_">Module</span>.<span class="title function_">findBaseAddress</span>(<span class="string">&#x27;libezandroid.so&#x27;</span>)</span><br><span class="line">    <span class="keyword">var</span> func_addr = base.<span class="title function_">add</span>(offset)</span><br><span class="line">    <span class="title class_">Interceptor</span>.<span class="title function_">attach</span>(<span class="title function_">ptr</span>(func_addr), &#123;</span><br><span class="line">        <span class="attr">onEnter</span>:<span class="keyword">function</span>(<span class="params">args</span>)&#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(args[<span class="number">1</span>].<span class="title function_">readCString</span>())</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">onLeave</span>:<span class="keyword">function</span>(<span class="params">ret</span>)&#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;ret:&quot;</span>, ret.<span class="title function_">readCString</span>())</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&emsp;发现返回值ret为用户名，但是args[1]并不是想象中的，为用户名，猜测应该是用户名的jstring对象。</p>
<h4 id="Step4"><a href="#Step4" class="headerlink" title="Step4"></a>Step4</h4><p>&emsp;&emsp;紧接着分析，发现sub_35a4函数貌似经过ollvm的混淆，有很多while循环，如下所示：</p>
<p><img src="/images/wmctf-2023/image-20231011194917434.png" alt="image-20231011194917434" style="zoom:67%;" /></p>
<p>&emsp;使用<a target="_blank" rel="noopener" href="https://github.com/cq674350529/deflat/tree/master">项目</a>，将deflat.py代码改为：</p>
<p><img src="/images/wmctf-2023/image-20231011214247374.png" alt="image-20231011214247374" style="zoom:67%;" /></p>
<p>&emsp;即可扫描到sub_35a4函数，运行指令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 deflat.py -f libezandroid.so --addr 0x4035A4</span><br></pre></td></tr></table></figure>
<p>&emsp;但是效果不尽人意。</p>
<h4 id="Step5"><a href="#Step5" class="headerlink" title="Step5"></a>Step5</h4><p>&emsp;&emsp;经过艰苦卓绝的手动测试，终于得到如下结论：</p>
<ul>
<li>一共三轮大循环，前两轮大循环无用。</li>
<li>用户名长度为10，如下所示，其中v47为用户名长度：</li>
</ul>
<p><img src="/images/wmctf-2023/image-20231011221556799.png" alt="image-20231011221556799" style="zoom:67%;" /></p>
<ul>
<li><code>memcmp(v30, &amp;byte_A138, 0xAu)</code>应总返回0，即比较成功。</li>
</ul>
<p>&emsp;接下来，重点关注以下部分（仅执行一次）：</p>
<p><img src="/images/wmctf-2023/image-20231011221904999.png" alt="image-20231011221904999" style="zoom:67%;" /></p>
<p>&emsp;钩取sub_60A0函数，得到返回值为<code>12345678</code>。</p>
<p>&emsp;钩取sub_6C2C函数，其参数分别为：用户名，返回字符串（要返回），用户名长度，字符串”12345678”，某个值（要返回）。</p>
<p>&emsp;钩取memcmp函数，但是系统可能一直在调用memcmp，且Interceptor.attach开销很大，导致钩取时直接卡住。</p>
<h4 id="Step6"><a href="#Step6" class="headerlink" title="Step6"></a>Step6</h4><p>&emsp;分析sub_6C2C函数，首先使用deflat olllvm反混淆，但失败。之后，将程序划分为多个Block，分别为：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// block 1</span></span><br><span class="line">v21 = <span class="number">0</span>;</span><br><span class="line">i = <span class="number">0x6A42046E</span>;</span><br><span class="line"><span class="comment">// block 2</span></span><br><span class="line"><span class="keyword">if</span>(v21 + <span class="number">1</span> &gt;= <span class="number">0</span>)</span><br><span class="line">    v10 = v21 + <span class="number">1</span>;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    v10 = v21 + <span class="number">256</span>;</span><br><span class="line">v21 = v21 + <span class="number">1</span> - (v10 &amp; <span class="number">0xFFFFFF00</span>);</span><br><span class="line">v11 = v15 + (<span class="type">unsigned</span> __int8)v22[v21 + <span class="number">256</span>];</span><br><span class="line">v12 = v11 + <span class="number">255</span>;</span><br><span class="line"><span class="keyword">if</span> (v11 &gt;= <span class="number">0</span>)</span><br><span class="line">    v12 = v15 + (<span class="type">unsigned</span> __int8)v22[v21 + <span class="number">256</span>];</span><br><span class="line">v15 = v11 - (v12 &amp; <span class="number">0xFFFFFF00</span>);</span><br><span class="line">result = <span class="built_in">swap</span>(&amp;v22[v21 + <span class="number">256</span>], &amp;v22[v15 + <span class="number">256</span>]);</span><br><span class="line">*(_BYTE *)(a2 + j) = *(_BYTE *)(v20 + j) ^ v22[(<span class="type">unsigned</span> __int8)(v22[v21 + <span class="number">256</span>] + v22[v15 + <span class="number">256</span>]) + <span class="number">256</span>] ^ j;</span><br><span class="line">i = <span class="number">-0x235CE214</span>u;</span><br><span class="line"><span class="comment">// block 3</span></span><br><span class="line">v5 = <span class="number">0x3D13C5C</span>;</span><br><span class="line"><span class="keyword">if</span>(v21 &gt;= <span class="number">256</span>)</span><br><span class="line">    v5 = <span class="number">-0x59910D2C</span>u;</span><br><span class="line">i = v5;</span><br><span class="line"><span class="comment">// block 4</span></span><br><span class="line">++j;</span><br><span class="line">i = <span class="number">-0x16F5EC03</span>u;</span><br><span class="line"><span class="comment">// block 5</span></span><br><span class="line"><span class="keyword">if</span> ( j &gt;= a3 )</span><br><span class="line">    v9 = <span class="number">0x531796B4</span>;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    v9 = <span class="number">-0x338869E1</span>u;</span><br><span class="line">i = v9;</span><br><span class="line"><span class="comment">// block 6</span></span><br><span class="line">++v21;</span><br><span class="line">i = <span class="number">-0x3F77EF18</span>u;</span><br><span class="line"><span class="comment">// block 7</span></span><br><span class="line">v15 = <span class="number">0</span>;</span><br><span class="line">v21 = <span class="number">0</span>;</span><br><span class="line">j = <span class="number">0</span>;</span><br><span class="line">i = <span class="number">-0x16F5EC03</span>u;</span><br><span class="line"><span class="comment">// block 8</span></span><br><span class="line">v6 = <span class="number">0x63790CC6</span>;</span><br><span class="line"><span class="keyword">if</span>(v21 &gt;= <span class="number">256</span>)</span><br><span class="line">    v6 = <span class="number">0x5BE5E1B6</span>;</span><br><span class="line">i = v6;</span><br><span class="line"><span class="comment">// block 9</span></span><br><span class="line">v7 = v15 + (<span class="type">unsigned</span> __int8)v22[v21 + <span class="number">256</span>] + (<span class="type">unsigned</span> __int8)v22[v21];</span><br><span class="line">v8 = v7 + <span class="number">255</span>;</span><br><span class="line"><span class="keyword">if</span> ( v7 &gt;= <span class="number">0</span> )</span><br><span class="line">    v8 = v15 + (<span class="type">unsigned</span> __int8)v22[v21 + <span class="number">256</span>] + (<span class="type">unsigned</span> __int8)v22[v21];</span><br><span class="line">v15 = v7 - (v8 &amp; <span class="number">0xFFFFFF00</span>);</span><br><span class="line">result = <span class="built_in">swap</span>(&amp;v22[v21 + <span class="number">256</span>], &amp;v22[v15 + <span class="number">256</span>]);</span><br><span class="line">i = <span class="number">0x25E9A458</span>;</span><br><span class="line"><span class="comment">// block 10</span></span><br><span class="line">v22[v21 + <span class="number">256</span>] = v21;</span><br><span class="line">v22[v21] = *(_BYTE *)(a4 + v21 % a5);</span><br><span class="line">i = <span class="number">-0x1F4D6769</span>u;</span><br><span class="line"><span class="comment">// block 11</span></span><br><span class="line">++v21;</span><br></pre></td></tr></table></figure>
<p>&emsp;block的运行逻辑为：先256次 <code>block3-&gt;block10-&gt;block6</code>，block3，block1，再256次 <code>block8-&gt;block9-&gt;block11</code>，block8，block7，最后10次<code>block5-&gt;block2-&gt;block4</code>。经过分析，属于<code>RC4算法</code>，密钥为<code>12345678</code>。RC4魔改了一下，最后异或j。</p>
<h4 id="Step7"><a href="#Step7" class="headerlink" title="Step7"></a>Step7</h4><p>&emsp;这一步主要是获取memcmp的第2个参数<code>byte_A138</code>。前面钩取memcmp的方法行不通，那么找到byte_A138在哪儿赋值的。找到相关函数，如下所示：</p>
<p><img src="/images/wmctf-2023/image-20231012122728031.png" alt="image-20231012122728031" style="zoom:67%;" /></p>
<p>&emsp;得到<code>byte_A138 = [0xe9,0x97,0x64,0xe6,0x7e,0xeb,0xbd,0xc1,0x0,0x1e]</code>。解密脚本出不了，猜测是不是byte_A138的计算有问题，frida钩取一下。打印内存的脚本：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">print_mem</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">var</span> addr = <span class="title class_">Module</span>.<span class="title function_">findBaseAddress</span>(<span class="string">&quot;libezandroid.so&quot;</span>)</span><br><span class="line">        <span class="keyword">var</span> byte_A138 = addr.<span class="title function_">add</span>(<span class="number">0xa138</span>)</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">hexdump</span>(byte_A138, &#123;</span><br><span class="line">            <span class="attr">offset</span>:<span class="number">0</span>,</span><br><span class="line">            <span class="attr">length</span>: <span class="number">64</span>,</span><br><span class="line">            <span class="attr">header</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">ansi</span>: <span class="literal">true</span>,</span><br><span class="line">        &#125;))</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&emsp;发现<code>byte_A138</code>应该为：<code>[0xe9,0x97,0x64,0xe6,0x7e,0xeb,0xbd,0xc1,0xab,0x43]</code>。</p>
<p>&emsp;针对用户名的解密脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> ARC4</span><br><span class="line"> </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">rc4util</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, key</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(key, <span class="built_in">str</span>):</span><br><span class="line">            self.__keyGen = key.encode()</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">isinstance</span>(key, <span class="built_in">bytes</span>):</span><br><span class="line">            self.__keyGen = key        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__encrypt</span>(<span class="params">self, data</span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">        rc4 = ARC4.new(self.__keyGen)</span><br><span class="line">        res = rc4.encrypt(data)</span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__decrypt</span>(<span class="params">self, data</span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">        rc4 = ARC4.new(self.__keyGen)</span><br><span class="line">        res = rc4.decrypt(data)</span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">Encrypt</span>(<span class="params">self, d</span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">      res = self.__encrypt(d)</span><br><span class="line">      <span class="keyword">return</span> res</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">Decrypt</span>(<span class="params">self, d</span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">      res = self.__decrypt(d)</span><br><span class="line">      <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line">key = <span class="string">&quot;12345678&quot;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Entry</span>(<span class="params">d</span>):</span><br><span class="line">  rc4 = rc4util(key)</span><br><span class="line">  ret = rc4.Encrypt(d)</span><br><span class="line">  <span class="keyword">return</span> ret</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Decry</span>(<span class="params">d</span>):</span><br><span class="line">  rc4 = rc4util(key)</span><br><span class="line">  ret = rc4.Decrypt(d)</span><br><span class="line">  <span class="keyword">return</span> ret</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">  ciphertext = <span class="built_in">bytes</span>([<span class="number">0xe9</span>,<span class="number">0x97</span>,<span class="number">0x64</span>,<span class="number">0xe6</span>,<span class="number">0x7e</span>,<span class="number">0xeb</span>,<span class="number">0xbd</span>,<span class="number">0xc1</span>,<span class="number">0xab</span>,<span class="number">0x43</span>])</span><br><span class="line">  res = Entry(ciphertext)</span><br><span class="line">  <span class="keyword">for</span> i, j <span class="keyword">in</span> <span class="built_in">enumerate</span>(res):</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(i^j), end = <span class="string">&quot;&quot;</span>)</span><br><span class="line"><span class="comment"># Re_1s_eaSy</span></span><br></pre></td></tr></table></figure>
<h3 id="sub-3f0c-check2"><a href="#sub-3f0c-check2" class="headerlink" title="sub_3f0c-check2"></a>sub_3f0c-check2</h3><p>&emsp;再来看验证密码的函数，与上个函数的分析类似，密码长度为16。重点关注sub_AFC与unk_A158。</p>
<p><img src="/images/wmctf-2023/image-20231012144127979.png" alt="image-20231012144127979" style="zoom:67%;" /></p>
<h4 id="Step1-1"><a href="#Step1-1" class="headerlink" title="Step1"></a>Step1</h4><p>&emsp;钩取sub_AFC，发现参数为：密码、0x10、Re_1s_eaSy123456。分析sub_AFC，划分block（化简版）：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// block1</span></span><br><span class="line">v19 = <span class="built_in">strlen</span>(v27);</span><br><span class="line">v29 = v30 - <span class="number">354358356</span>;</span><br><span class="line">result = <span class="built_in">sub_11A0</span>(&amp;v29, v20);</span><br><span class="line">v18 = <span class="number">0</span>;</span><br><span class="line"><span class="comment">// block2</span></span><br><span class="line">v29 = v30 + <span class="number">51219284</span>;</span><br><span class="line">v8 = &amp;v29;</span><br><span class="line">v7 = v33;</span><br><span class="line"><span class="built_in">sub_1CD8</span>(&amp;v29, v33);</span><br><span class="line">v29 = v30 - <span class="number">1988849943</span>;</span><br><span class="line"><span class="built_in">sub_2000</span>(v8, v7);</span><br><span class="line">v29 = v30 + <span class="number">1568064809</span>;</span><br><span class="line"><span class="built_in">sub_1990</span>(v8, v7, <span class="number">10LL</span>);</span><br><span class="line">v29 = v30 + <span class="number">901913056</span>;</span><br><span class="line">result = <span class="built_in">sub_2ADC</span>(v8, v7, v22 + v18);</span><br><span class="line"><span class="comment">// block3</span></span><br><span class="line">v29 = v30 + <span class="number">51219284</span>;</span><br><span class="line">v10 = &amp;v29;</span><br><span class="line">v9 = v33;</span><br><span class="line"><span class="built_in">sub_1CD8</span>(&amp;v29, v33);</span><br><span class="line">v29 = v30 - <span class="number">1988849943</span>;</span><br><span class="line"><span class="built_in">sub_2000</span>(v10, v9);</span><br><span class="line">v29 = v30 - <span class="number">879117111</span>;</span><br><span class="line"><span class="built_in">sub_23FC</span>(v10, v9);</span><br><span class="line">v29 = v30 + <span class="number">1568064809</span>;</span><br><span class="line">result = <span class="built_in">sub_1990</span>(v10, v9, v17);</span><br><span class="line"><span class="comment">// block4</span></span><br><span class="line">++v17;</span><br><span class="line"><span class="comment">// block5</span></span><br><span class="line"><span class="comment">// block6</span></span><br><span class="line"><span class="comment">// block7</span></span><br><span class="line">v18 += <span class="number">16</span>;</span><br><span class="line"><span class="comment">// block8</span></span><br><span class="line">v29 = v30 - <span class="number">739967527</span>;</span><br><span class="line">v12 = &amp;v29;</span><br><span class="line">v11 = v33;</span><br><span class="line"><span class="built_in">sub_165C</span>(&amp;v29, v22 + v18, v33);</span><br><span class="line">v29 = v30 + <span class="number">1568064809</span>;</span><br><span class="line">result = <span class="built_in">sub_1990</span>(v12, v11, <span class="number">0LL</span>);</span><br><span class="line">v17 = <span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<p>&emsp;计算过程：block1、block6、block8、9次<code>block5-&gt;block3-&gt;block4</code>、block5、block2、block7、block6。化简后：block1、block8、9次<code>block3-&gt;block4</code>、block2、block7。</p>
<p>&emsp;分析block1中的sub_11A0，参数分别为：-2263271711、Re_1s_eaSy123456，猜测是初始化参数，在此跳过。</p>
<p>&emsp;再分析block8中的sub_165C，是将用户输入的密码传递到另一个变量中，例如存到变量里是<code>abcdefghijklmnoz</code>，那么变量则为<code>aeimbfjncgkodhlz</code>。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">d = &#123;<span class="string">&quot;0&quot;</span>:[], <span class="string">&quot;1&quot;</span>:[], <span class="string">&quot;2&quot;</span>:[], <span class="string">&quot;3&quot;</span>:[]&#125;</span><br><span class="line">inp = <span class="string">&quot;...&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">    ind = i % <span class="number">4</span></span><br><span class="line">    d[<span class="built_in">str</span>(ind)].append(inp[i])</span><br><span class="line">inp = d[<span class="string">&quot;0&quot;</span>] + d[<span class="string">&quot;1&quot;</span>] + d[<span class="string">&quot;2&quot;</span>] + d[<span class="string">&quot;3&quot;</span>]</span><br></pre></td></tr></table></figure>
<p>&emsp;block8中的sub_1990，逻辑为（轮密钥加）：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">byte_A178 = [...]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">	<span class="keyword">if</span> i % <span class="number">4</span> == <span class="number">0</span>:</span><br><span class="line">        k = <span class="number">3</span> - i / <span class="number">4</span></span><br><span class="line">    j = k + (i % <span class="number">4</span>) * <span class="number">4</span></span><br><span class="line">    ret[i] ^= byte_A178[j + arg3 * <span class="number">16</span>]</span><br></pre></td></tr></table></figure>
<p>&emsp;block3中的sub_1CD8，是字节替换。block3中的sub_2000，是行移位。sub_23FC是列混淆。sub_2ADC则是重新得到密文。综上，属于<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/98514678">AES加密流程</a>。</p>
<p>&emsp;既然，AES是对称加密，那么我们把要比较的密文扔进去，再过一遍，不就得到明文了吗？（<code>我真傻逼</code>）</p>
<p>&emsp;hook得到要比较的密文：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2bc8208b5c0da79b2a513ad27171ca50</span><br></pre></td></tr></table></figure>
<p>&emsp;主动调用sub_afc函数（不要忘记前面的bypass哦）：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">bypass</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> openPtr = <span class="title class_">Module</span>.<span class="title function_">getExportByName</span>(<span class="string">&#x27;libc.so&#x27;</span>, <span class="string">&#x27;open&#x27;</span>);</span><br><span class="line">    <span class="keyword">var</span> open = <span class="keyword">new</span> <span class="title class_">NativeFunction</span>(openPtr, <span class="string">&#x27;int&#x27;</span>, [<span class="string">&#x27;pointer&#x27;</span>, <span class="string">&#x27;int&#x27;</span>]);</span><br><span class="line">    <span class="comment">// 事先准备好</span></span><br><span class="line">    <span class="keyword">var</span> fakePath = <span class="string">&quot;/data/local/tmp/ezandroid.maps&quot;</span>;</span><br><span class="line">    <span class="comment">// 替换 open 函数</span></span><br><span class="line">    <span class="title class_">Interceptor</span>.<span class="title function_">replace</span>(openPtr, <span class="keyword">new</span> <span class="title class_">NativeCallback</span>(<span class="keyword">function</span> (<span class="params">pathnameptr, flag</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> pathname = <span class="title class_">Memory</span>.<span class="title function_">readUtf8String</span>(pathnameptr);</span><br><span class="line">        <span class="keyword">var</span> realFd = <span class="title function_">open</span>(pathnameptr, flag);</span><br><span class="line">        <span class="comment">// pathname 中含有 &quot;maps&quot;，此时返回 fakePath 的 fd</span></span><br><span class="line">        <span class="keyword">if</span> (pathname.<span class="title function_">indexOf</span>(<span class="string">&quot;maps&quot;</span>) &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> filename = <span class="title class_">Memory</span>.<span class="title function_">allocUtf8String</span>(fakePath);</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_">open</span>(filename, flag);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">var</span> fd = <span class="title function_">open</span>(pathnameptr, flag);</span><br><span class="line">        <span class="keyword">return</span> fd;</span><br><span class="line">    &#125;, <span class="string">&#x27;int&#x27;</span>, [<span class="string">&#x27;pointer&#x27;</span>, <span class="string">&#x27;int&#x27;</span>]));</span><br><span class="line">  &#125;</span><br><span class="line"><span class="title function_">setImmediate</span>(bypass)</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">call_sub_afc</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> offset = <span class="number">0x0AFC</span></span><br><span class="line">    <span class="keyword">var</span> base = <span class="title class_">Module</span>.<span class="title function_">findBaseAddress</span>(<span class="string">&#x27;libezandroid.so&#x27;</span>)</span><br><span class="line">    <span class="keyword">var</span> addr = base.<span class="title function_">add</span>(offset)</span><br><span class="line">    <span class="keyword">var</span> func  = <span class="keyword">new</span> <span class="title class_">NativeFunction</span>(addr, <span class="string">&#x27;pointer&#x27;</span>, [<span class="string">&#x27;pointer&#x27;</span>, <span class="string">&#x27;int&#x27;</span>, <span class="string">&#x27;pointer&#x27;</span>])</span><br><span class="line">	<span class="comment">// 密文</span></span><br><span class="line">    <span class="keyword">var</span> arg0 = <span class="title class_">Memory</span>.<span class="title function_">alloc</span>(<span class="number">16</span>);</span><br><span class="line">    <span class="title class_">Memory</span>.<span class="title function_">writeByteArray</span>(arg0, [<span class="number">0x2b</span>, <span class="number">0xc8</span>, <span class="number">0x20</span>, <span class="number">0x8b</span>, <span class="number">0x5c</span>, <span class="number">0x0d</span>, <span class="number">0xa7</span>, <span class="number">0x9b</span>, <span class="number">0x2a</span>, <span class="number">0x51</span>, <span class="number">0x3a</span>, <span class="number">0xd2</span>, <span class="number">0x71</span>, <span class="number">0x71</span>, <span class="number">0xca</span>, <span class="number">0x50</span>]);</span><br><span class="line">    <span class="comment">// 密钥</span></span><br><span class="line">    <span class="keyword">var</span> arg2 = <span class="title class_">Memory</span>.<span class="title function_">alloc</span>(<span class="number">16</span>);</span><br><span class="line">    <span class="title class_">Memory</span>.<span class="title function_">writeByteArray</span>(arg2, [<span class="number">0x52</span>, <span class="number">0x65</span>, <span class="number">0x5f</span>, <span class="number">0x31</span>, <span class="number">0x73</span>, <span class="number">0x5f</span>, <span class="number">0x65</span>, <span class="number">0x61</span>, <span class="number">0x53</span>, <span class="number">0x79</span>, <span class="number">0x31</span>, <span class="number">0x32</span>, <span class="number">0x33</span>, <span class="number">0x34</span>, <span class="number">0x35</span>, <span class="number">0x36</span>]);</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">var</span> env = <span class="title class_">Java</span>.<span class="property">vm</span>.<span class="title function_">getEnv</span>()</span><br><span class="line">        <span class="comment">// 主动调用 sub_afc</span></span><br><span class="line">        <span class="title function_">func</span>(<span class="title function_">ptr</span>(arg0), <span class="number">0x10</span>, <span class="title function_">ptr</span>(arg2))</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">hook_sub_afc</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> offset = <span class="number">0x0AFC</span></span><br><span class="line">    <span class="keyword">var</span> base = <span class="title class_">Module</span>.<span class="title function_">findBaseAddress</span>(<span class="string">&#x27;libezandroid.so&#x27;</span>)</span><br><span class="line">    <span class="keyword">var</span> func_addr = base.<span class="title function_">add</span>(offset)</span><br><span class="line">    <span class="keyword">var</span> arg0 = <span class="literal">null</span></span><br><span class="line">    <span class="title class_">Interceptor</span>.<span class="title function_">attach</span>(<span class="title function_">ptr</span>(func_addr), &#123;</span><br><span class="line">        <span class="attr">onEnter</span>:<span class="keyword">function</span>(<span class="params">args</span>)&#123;</span><br><span class="line">            arg0 = args[<span class="number">0</span>]</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;enter&quot;</span>)</span><br><span class="line">            <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">hexdump</span>(<span class="title function_">ptr</span>(arg0), &#123;</span><br><span class="line">                    <span class="attr">offset</span>: <span class="number">0</span>,</span><br><span class="line">                    <span class="attr">length</span>: <span class="number">64</span>,</span><br><span class="line">                    <span class="attr">header</span>: <span class="literal">true</span>,</span><br><span class="line">                    <span class="attr">ansi</span>: <span class="literal">true</span>,</span><br><span class="line">                &#125;)) </span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">onLeave</span>:<span class="keyword">function</span>(<span class="params">ret</span>)&#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;return&quot;</span>)</span><br><span class="line">            <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">hexdump</span>(<span class="title function_">ptr</span>(arg0), &#123;</span><br><span class="line">                    <span class="attr">offset</span>: <span class="number">0</span>,</span><br><span class="line">                    <span class="attr">length</span>: <span class="number">64</span>,</span><br><span class="line">                    <span class="attr">header</span>: <span class="literal">true</span>,</span><br><span class="line">                    <span class="attr">ansi</span>: <span class="literal">true</span>,</span><br><span class="line">                &#125;)) </span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Step2-1"><a href="#Step2-1" class="headerlink" title="Step2"></a>Step2</h4><p>&emsp;与正常的AES加密结果不同，猜测更换了S盒。表面上没改，实际用的时候改了，真狗啊。下面是抓取S盒的脚本：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">bypass</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> openPtr = <span class="title class_">Module</span>.<span class="title function_">getExportByName</span>(<span class="string">&#x27;libc.so&#x27;</span>, <span class="string">&#x27;open&#x27;</span>);</span><br><span class="line">    <span class="keyword">var</span> open = <span class="keyword">new</span> <span class="title class_">NativeFunction</span>(openPtr, <span class="string">&#x27;int&#x27;</span>, [<span class="string">&#x27;pointer&#x27;</span>, <span class="string">&#x27;int&#x27;</span>]);</span><br><span class="line">    <span class="comment">// 事先准备好</span></span><br><span class="line">    <span class="keyword">var</span> fakePath = <span class="string">&quot;/data/local/tmp/ezandroid.maps&quot;</span>;</span><br><span class="line">    <span class="comment">// 替换 open 函数</span></span><br><span class="line">    <span class="title class_">Interceptor</span>.<span class="title function_">replace</span>(openPtr, <span class="keyword">new</span> <span class="title class_">NativeCallback</span>(<span class="keyword">function</span> (<span class="params">pathnameptr, flag</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> pathname = <span class="title class_">Memory</span>.<span class="title function_">readUtf8String</span>(pathnameptr);</span><br><span class="line">        <span class="keyword">var</span> realFd = <span class="title function_">open</span>(pathnameptr, flag);</span><br><span class="line">        <span class="comment">// pathname 中含有 &quot;maps&quot;，此时返回 fakePath 的 fd</span></span><br><span class="line">        <span class="keyword">if</span> (pathname.<span class="title function_">indexOf</span>(<span class="string">&quot;maps&quot;</span>) &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> filename = <span class="title class_">Memory</span>.<span class="title function_">allocUtf8String</span>(fakePath);</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_">open</span>(filename, flag);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">var</span> fd = <span class="title function_">open</span>(pathnameptr, flag);</span><br><span class="line">        <span class="keyword">return</span> fd;</span><br><span class="line">    &#125;, <span class="string">&#x27;int&#x27;</span>, [<span class="string">&#x27;pointer&#x27;</span>, <span class="string">&#x27;int&#x27;</span>]));</span><br><span class="line">  &#125;</span><br><span class="line"><span class="title function_">setImmediate</span>(bypass)</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">hook_sub_2fb4</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> offset = <span class="number">0x2fb4</span></span><br><span class="line">    <span class="keyword">var</span> base = <span class="title class_">Module</span>.<span class="title function_">findBaseAddress</span>(<span class="string">&#x27;libezandroid.so&#x27;</span>)</span><br><span class="line">    <span class="keyword">var</span> func_addr = base.<span class="title function_">add</span>(offset)</span><br><span class="line">    <span class="keyword">var</span> data = base.<span class="title function_">add</span>(<span class="number">0xa000</span>)</span><br><span class="line">    <span class="title class_">Interceptor</span>.<span class="title function_">attach</span>(<span class="title function_">ptr</span>(func_addr), &#123;</span><br><span class="line">        <span class="attr">onEnter</span>:<span class="keyword">function</span>(<span class="params">args</span>)&#123;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">onLeave</span>:<span class="keyword">function</span>(<span class="params">ret</span>)&#123;</span><br><span class="line">            <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">hexdump</span>(<span class="title function_">ptr</span>(data), &#123;</span><br><span class="line">                    <span class="attr">offset</span>: <span class="number">0</span>,</span><br><span class="line">                    <span class="attr">length</span>: <span class="number">256</span>,</span><br><span class="line">                    <span class="attr">header</span>: <span class="literal">true</span>,</span><br><span class="line">                    <span class="attr">ansi</span>: <span class="literal">true</span>,</span><br><span class="line">                &#125;)) </span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&emsp;抓到的S盒为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[0x29, 0x40, 0x57, 0x6e, 0x85, 0x9c, 0xb3, 0xca, 0xe1, 0xf8, 0x0f, 0x26, 0x3d, 0x54, 0x6b, 0x82,0x99, 0xb0, 0xc7, 0xde, 0xf5, 0x0c, 0x23, 0x3a, 0x51, 0x68, 0x7f, 0x96, 0xad, 0xc4, 0xdb, 0xf2,0x09, 0x20, 0x37, 0x4e, 0x65, 0x7c, 0x93, 0xaa, 0xc1, 0xd8, 0xef, 0x06, 0x1d, 0x34, 0x4b, 0x62,0x79, 0x90, 0xa7, 0xbe, 0xd5, 0xec, 0x03, 0x1a, 0x31, 0x48, 0x5f, 0x76, 0x8d, 0xa4, 0xbb, 0xd2,0xe9, 0x00, 0x17, 0x2e, 0x45, 0x5c, 0x73, 0x8a, 0xa1, 0xb8, 0xcf, 0xe6, 0xfd, 0x14, 0x2b, 0x42,0x59, 0x70, 0x87, 0x9e, 0xb5, 0xcc, 0xe3, 0xfa, 0x11, 0x28, 0x3f, 0x56, 0x6d, 0x84, 0x9b, 0xb2,0xc9, 0xe0, 0xf7, 0x0e, 0x25, 0x3c, 0x53, 0x6a, 0x81, 0x98, 0xaf, 0xc6, 0xdd, 0xf4, 0x0b, 0x22,0x39, 0x50, 0x67, 0x7e, 0x95, 0xac, 0xc3, 0xda, 0xf1, 0x08, 0x1f, 0x36, 0x4d, 0x64, 0x7b, 0x92,0xa9, 0xc0, 0xd7, 0xee, 0x05, 0x1c, 0x33, 0x4a, 0x61, 0x78, 0x8f, 0xa6, 0xbd, 0xd4, 0xeb, 0x02,0x19, 0x30, 0x47, 0x5e, 0x75, 0x8c, 0xa3, 0xba, 0xd1, 0xe8, 0xff, 0x16, 0x2d, 0x44, 0x5b, 0x72,0x89, 0xa0, 0xb7, 0xce, 0xe5, 0xfc, 0x13, 0x2a, 0x41, 0x58, 0x6f, 0x86, 0x9d, 0xb4, 0xcb, 0xe2,0xf9, 0x10, 0x27, 0x3e, 0x55, 0x6c, 0x83, 0x9a, 0xb1, 0xc8, 0xdf, 0xf6, 0x0d, 0x24, 0x3b, 0x52,0x69, 0x80, 0x97, 0xae, 0xc5, 0xdc, 0xf3, 0x0a, 0x21, 0x38, 0x4f, 0x66, 0x7d, 0x94, 0xab, 0xc2,0xd9, 0xf0, 0x07, 0x1e, 0x35, 0x4c, 0x63, 0x7a, 0x91, 0xa8, 0xbf, 0xd6, 0xed, 0x04, 0x1b, 0x32,0x49, 0x60, 0x77, 0x8e, 0xa5, 0xbc, 0xd3, 0xea, 0x01, 0x18, 0x2f, 0x46, 0x5d, 0x74, 0x8b, 0xa2,0xb9, 0xd0, 0xe7, 0xfe, 0x15, 0x2c, 0x43, 0x5a, 0x71, 0x88, 0x9f, 0xb6, 0xcd, 0xe4, 0xfb, 0x12]</span><br></pre></td></tr></table></figure>
<p>&emsp;S盒求逆，得到：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[65, 232, 143, 54, 221, 132, 43, 210, 121, 32, 199, 110, 21, 188, 99, 10, 177, 88, 255, 166, 77, 244, 155, 66, 233, 144, 55, 222, 133, 44, 211, 122, 33, 200, 111, 22, 189, 100, 11, 178, 89, 0, 167, 78, 245, 156, 67, 234, 145, 56, 223, 134, 45, 212, 123, 34, 201, 112, 23, 190, 101, 12, 179, 90, 1, 168, 79, 246, 157, 68, 235, 146, 57, 224, 135, 46, 213, 124, 35, 202, 113, 24, 191, 102, 13, 180, 91, 2, 169, 80, 247, 158, 69, 236, 147, 58, 225, 136, 47, 214, 125, 36, 203, 114, 25, 192, 103, 14, 181, 92, 3, 170, 81, 248, 159, 70, 237, 148, 59, 226, 137, 48, 215, 126, 37, 204, 115, 26, 193, 104, 15, 182, 93, 4, 171, 82, 249, 160, 71, 238, 149, 60, 227, 138, 49, 216, 127, 38, 205, 116, 27, 194, 105, 16, 183, 94, 5, 172, 83, 250, 161, 72, 239, 150, 61, 228, 139, 50, 217, 128, 39, 206, 117, 28, 195, 106, 17, 184, 95, 6, 173, 84, 251, 162, 73, 240, 151, 62, 229, 140, 51, 218, 129, 40, 207, 118, 29, 196, 107, 18, 185, 96, 7, 174, 85, 252, 163, 74, 241, 152, 63, 230, 141, 52, 219, 130, 41, 208, 119, 30, 197, 108, 19, 186, 97, 8, 175, 86, 253, 164, 75, 242, 153, 64, 231, 142, 53, 220, 131, 42, 209, 120, 31, 198, 109, 20, 187, 98, 9, 176, 87, 254, 165, 76, 243, 154]</span><br></pre></td></tr></table></figure>
<p>&emsp;根据<a target="_blank" rel="noopener" href="https://github.com/lmshao/AES">项目</a>，快乐得到：<code>_eZ_Rc4_@nd_AES!</code>。最后flag：<code>Re_1s_eaSy_eZ_Rc4_@nd_AES!</code>。</p>
<h2 id="0x01-ez-v1deo"><a href="#0x01-ez-v1deo" class="headerlink" title="0x01 ez_v1deo"></a>0x01 ez_v1deo</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">视频好像被L1near弄坏掉了</span><br></pre></td></tr></table></figure>
<p>&emsp;7s的avi视频，92.8MB，感觉离谱，肯定藏了什么东西。根据<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/162679898">AVI格式</a>看了看，感觉没啥问题，单纯就是觉得strl块（存放avi数据流）太大了，92MB。但是看了一下，<a target="_blank" rel="noopener" href="https://wooyun.js.org/drops/CTF%E4%B8%AD%E6%AF%94%E8%BE%83%E5%A5%BD%E7%8E%A9%E7%9A%84stego.html">链接</a>说avi文件体积本来就很大，所以应该也没啥问题，还推荐了MSU VideoStego工具来分析avi文件。</p>
<p>&emsp;详细的avi格式：<a target="_blank" rel="noopener" href="https://sp4n9x.github.io/2020/12/30/AVI%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F%E5%88%86%E6%9E%90/">链接</a>。</p>
<p>&emsp;MSU VideoStego工具解压缩需要密码，试了几个说不行。最后使用binwalk提取出了sit类型的文件。但是感觉方向错了，看wp。</p>
<h3 id="wp"><a href="#wp" class="headerlink" title="wp"></a>wp</h3><p>（1）首先使用ffmpeg将avi转为帧格式。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i flag.avi -r 20 ./images/image-%3d.png</span><br></pre></td></tr></table></figure>
<p>（2）使用lsb提取。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span> n <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">144</span>):</span><br><span class="line">    img = Image.<span class="built_in">open</span>(<span class="string">&quot;C:\\Users\\23957\\Desktop\\images\\image-&#123;:0&gt;3d&#125;.png&quot;</span>.<span class="built_in">format</span>(n))</span><br><span class="line">    img = img.convert(<span class="string">&quot;RGB&quot;</span>)</span><br><span class="line">    width, height = img.size</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, width):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, height):</span><br><span class="line">            tmp = img.getpixel((i,j))</span><br><span class="line">            <span class="comment"># 最后一位为 0，则为 0 </span></span><br><span class="line">            <span class="keyword">if</span> tmp[<span class="number">1</span>] &amp; <span class="number">0x1</span> == <span class="number">0</span>:</span><br><span class="line">                img.putpixel((i,j), <span class="number">0</span>)</span><br><span class="line">            <span class="comment"># 最后一位为 1，则为 255 </span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                img.putpixel((i,j), <span class="number">255</span>)</span><br><span class="line">    img.save(<span class="string">&quot;C:\\Users\\23957\\Desktop\\images\\output\\image-&#123;:0&gt;3d&#125;.png&quot;</span>.<span class="built_in">format</span>(n))</span><br></pre></td></tr></table></figure>
<p>&emsp;最终得到flag：<code>WMCTF&#123;5b658ab9-946c-3869-fc21-6ad99b3bc714&#125;</code>。虽然和逆向没太大关系，但是学到了。</p>
<hr>
<p>&emsp;发现我好像把题目记录错了，日了狗了，以下是更改版本。</p>
<h2 id="0x02-gohunt"><a href="#0x02-gohunt" class="headerlink" title="0x02 gohunt"></a>0x02 gohunt</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmctf&#123;...&#125;</span><br></pre></td></tr></table></figure>
<p>&emsp;一个flag.jpg，一个gohunt。jpg扫出来数据为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">YMQHsYFQu7kkTqu3Xmt1ruYUDLU8uaMoPpsfjqYF4TQMMKtw5KF7cpWrkWpk3</span><br></pre></td></tr></table></figure>
<p>&emsp;跑一跑Gohunt，猜测逻辑是有一个original.jpg，输入flag，之后输出了flag.jpg。</p>
<h3 id="Gohunt分析"><a href="#Gohunt分析" class="headerlink" title="Gohunt分析"></a>Gohunt分析</h3><p>&emsp;发现其中导入了很多github相关函数，那么，直接binaryAI处理一波（没啥卵用），Go_parser报错，显示找不到Moduledata，看来是作者自己删了。</p>
<p>&emsp;重点是分析main_main函数。对于<code>__encoding_base64_Encoding__DecodeString</code>函数，得到其转换码表：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">decodeMap = [<span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;.&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\x0e&#x27;</span>, <span class="string">b&#x27;\x17&#x27;</span>, <span class="string">b&#x27;\x1b&#x27;</span>, <span class="string">b&#x27;0&#x27;</span>, <span class="string">b&#x27;)&#x27;</span>, <span class="string">b&#x27;\x0f&#x27;</span>, <span class="string">b&#x27;$&#x27;</span>, <span class="string">b&#x27;\x13&#x27;</span>, <span class="string">b&#x27;=&#x27;</span>, <span class="string">b&#x27;-&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;!&#x27;</span>, <span class="string">b&#x27;*&#x27;</span>, <span class="string">b&#x27;\x18&#x27;</span>, <span class="string">b&#x27;5&#x27;</span>, <span class="string">b&#x27;2&#x27;</span>, <span class="string">b&#x27;\x1a&#x27;</span>, <span class="string">b&#x27;:&#x27;</span>, <span class="string">b&#x27;?&#x27;</span>, <span class="string">b&#x27;\x04&#x27;</span>, <span class="string">b&#x27;%&#x27;</span>, <span class="string">b&#x27;8&#x27;</span>, <span class="string">b&#x27;6&#x27;</span>, <span class="string">b&#x27;\x1e&#x27;</span>, <span class="string">b&#x27; &#x27;</span>, <span class="string">b&#x27;\x00&#x27;</span>, <span class="string">b&#x27;4&#x27;</span>, <span class="string">b&#x27;,&#x27;</span>, <span class="string">b&#x27;\x02&#x27;</span>, <span class="string">b&#x27;\x0b&#x27;</span>, <span class="string">b&#x27;\x1c&#x27;</span>, <span class="string">b&#x27;\n&#x27;</span>, <span class="string">b&#x27;&amp;&#x27;</span>, <span class="string">b&#x27;3&#x27;</span>, <span class="string">b&#x27;;&#x27;</span>, <span class="string">b&#x27;\x06&#x27;</span>, <span class="string">b&#x27;9&#x27;</span>, <span class="string">b&#x27;\t&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;+&#x27;</span>, <span class="string">b&#x27;(&#x27;</span>, <span class="string">b&#x27;1&#x27;</span>, <span class="string">b&#x27;\x14&#x27;</span>, <span class="string">b&#x27;\x0c&#x27;</span>, <span class="string">b&#x27;\x1d&#x27;</span>, <span class="string">b&#x27;\x11&#x27;</span>, <span class="string">b&#x27;7&#x27;</span>, <span class="string">b&#x27;\x08&#x27;</span>, <span class="string">b&quot;&#x27;&quot;</span>, <span class="string">b&#x27;\x01&#x27;</span>, <span class="string">b&#x27;\x15&#x27;</span>, <span class="string">b&#x27;\x07&#x27;</span>, <span class="string">b&#x27;\x10&#x27;</span>, <span class="string">b&#x27;\r&#x27;</span>, <span class="string">b&#x27;\x19&#x27;</span>, <span class="string">b&#x27;&quot;&#x27;</span>, <span class="string">b&#x27;#&#x27;</span>, <span class="string">b&#x27;&lt;&#x27;</span>, <span class="string">b&#x27;&gt;&#x27;</span>, <span class="string">b&#x27;\x12&#x27;</span>, <span class="string">b&#x27;\x16&#x27;</span>, <span class="string">b&#x27;\x1f&#x27;</span>, <span class="string">b&#x27;\x03&#x27;</span>, <span class="string">b&#x27;\x05&#x27;</span>, <span class="string">b&#x27;/&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;\xff&#x27;</span>, <span class="string">b&#x27;=&#x27;</span>, <span class="string">b&#x27;\x00&#x27;</span>, <span class="string">b&#x27;\x00&#x27;</span>, <span class="string">b&#x27;\x00&#x27;</span>]</span><br><span class="line">base64Key = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> ind, d <span class="keyword">in</span> <span class="built_in">enumerate</span>(decodeMap):</span><br><span class="line">    <span class="keyword">if</span> d != <span class="string">b&#x27;\xff&#x27;</span> <span class="keyword">and</span> ind &lt;= <span class="number">255</span>:</span><br><span class="line">        base64Key[<span class="built_in">int</span>.from_bytes(d, byteorder=<span class="string">&#x27;little&#x27;</span>, signed=<span class="literal">True</span>)] = <span class="built_in">chr</span>(ind)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">64</span>):</span><br><span class="line">    <span class="built_in">print</span>(base64Key[i], end = <span class="string">&quot;&quot;</span>)</span><br><span class="line"><span class="comment"># NkQxHyXmiZTReo05ngu7dlv1BpE2SfLwM@qr6IUjb4AaP9+z3cDVOCKhJYFWs8tG</span></span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">xxtea</span><br><span class="line">value:1234</span><br><span class="line">key:FMT2ZCEHS6pcfD2R</span><br><span class="line">result:b0fe8b4d 7806d98b fac7b443</span><br><span class="line">result ^ NPWrpd1CEJH2QcJ3 = [0x3,0xdb,0xa9,0xc2,0xfb,0xbd,0x37,0x3b,0x6,0xfe,0x8f,0xc8]</span><br><span class="line"></span><br><span class="line">0x03dba9c2/0x3a=0x110757...0x6</span><br><span class="line">0x0cFBBD373B06FE8FC8/0x3a=0x394e4bfc9a9a753c...0x30</span><br><span class="line">0x110757/0x3a=0x4b29...0xd</span><br><span class="line">0xd394E4BFC9A9A753C/0x3a=0x3A5E0A2340756BF3...0x2E</span><br><span class="line">0x4B29/0x3a=0x14b...0x2b</span><br><span class="line">0x2b3A5E0A2340756BF3/0x3a=0xBECCA7E620020646...0x17</span><br><span class="line">0x14b/0x3a=0x5...0x29</span><br><span class="line">0x29BECCA7E620020646/0x3a=0xb8415257d469f747...0x30</span><br><span class="line">0x5/0x3a=0x0...0x5</span><br><span class="line">0x5B8415257D469F747/0x3a=0x193eeb59ca48729b...0x29</span><br><span class="line">&quot;H5rH&quot;.append(&quot;Y7TwcE41bzWvMQZXa8fyeprJoBdmhsu9DqVgxRPtFLKN65UH2CikG3SAj&quot;[0x29])=&quot;H5rHF&quot;</span><br><span class="line">0x193eeb59ca48729b/0x3a</span><br></pre></td></tr></table></figure>
<h2 id="0x03-ios"><a href="#0x03-ios" class="headerlink" title="0x03 ios"></a>0x03 ios</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmctf&#123;...&#125;</span><br></pre></td></tr></table></figure>
<h2 id="0x04-RightBack"><a href="#0x04-RightBack" class="headerlink" title="0x04 RightBack"></a>0x04 RightBack</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmctf&#123;...&#125;</span><br></pre></td></tr></table></figure>

  
	</div>

	<div>
  	<center>
	<div class="pagination">

    
    
    <a href="/2023/08/24/gray-wolf-analysis/" type="button" class="btn btn-default"><i
                class="fa fa-arrow-circle-o-left"></i> 上一页</a>
    

    <a href="/" type="button" class="btn btn-default"><i class="fa fa-home"></i>Home</a>
    
    <a href="/2023/08/09/recentlyThink-3/" type="button" class="btn btn-default ">下一页<i
                class="fa fa-arrow-circle-o-right"></i></a>
    

    
</div>

    </center>
	</div>


	<!-- comment -->
	
<section id="comment">
    <h2 class="title">留言</h2>

    <!-- 
    <div id="disqus_thread" class="ds-thread">
        <script type="text/javascript">
            /**
             * RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
             * LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
             */
                /*
                 var disqus_config = function () {
                 this.page.url = PAGE_URL; // Replace PAGE_URL with your page's canonical URL variable
                 this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
                 };
                 */
            (function() { // DON'T EDIT BELOW THIS LINE
                var d = document, s = d.createElement('script');

                s.src = 'https://https-wd-2711-tech.disqus.com/embed.js';

                s.setAttribute('data-timestamp', +new Date());
                (d.head || d.body).appendChild(s);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by
                Disqus.</a></noscript>
    </div> -->
    <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
    <div id="vcomments"></div>
    <script>
        new Valine({
            el: '#vcomments',
            appId: 'wLIJ70s3fPvW8WJPgVVAuWVR-gzGzoHsz',
            appKey: 'NVGqxhUkqtFv2CbwmXXWjCdR'
        })
    </script>

    
</section>


	</div> <!-- col-md-9/col-md-12 -->
		
	
	<div id="side_meta">
		<div class="col-md-3" id="post_meta"> 

	<!-- date -->
	
	<div class="meta-widget">
	<i class="fa fa-clock-o"></i>
	2023-08-20 
	</div>
	

	<!-- categories -->
    
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#categorys"><i class="fa fa-folder"></i></a>	
    <ul id="categorys" class="tag_box list-unstyled collapse in">
          
  <li>
    <li><a href="/categories/re/">re<span>35</span></a></li>
  </li>

    </ul>
	</div>
	

	<!-- tags -->
		

	<!-- toc -->
	<div class="meta-widget">
	
	</div>
	
    <hr>
	
</div><!-- col-md-3 -->

	</div>

	<!-- copyright -->
	<div>
    <ul class="post-copyright">
      <li class="post-copyright-author">
      <strong>作者:  </strong>wd-z711</a>
      </li>
      <li class="post-copyright-link">
      <strong>文章链接:  </strong>
      <a href="/" target="_blank" title="">https://wd-2711.tech/</a>
      </li>
      <li class="post-copyright-license">
        <strong>版权声明:   </strong>
        本博客所有文章除特别声明外，均采用 <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">CC BY-NC-ND 4.0</a>
        许可协议。转载请注明出处!
      </li>
    </ul>
  <div>
 	

		


</div><!-- row -->




	</div>
  </div>
  <div class="container-narrow">
  <footer> <p>
  &copy; 2023 wd-z711
  
      <!-- with help from <a href="http://hexo.io/" target="_blank">Hexo</a>,<a target="_blank" rel="noopener" href="http://github.com/wzpan/hexo-theme-freemind/">Freemind</a>,<a href="http://getbootstrap.com/" target="_blank">Twitter Bootstrap</a> and <a href="http://getbootstrap.com/" target="_blank">BOOTSTRA.386</a>. 
     <br> Theme by <a target="_blank" rel="noopener" href="http://github.com/wzpan/hexo-theme-freemind/">Freemind.386</a>.     -->

     <!-- <script type="text/javascript">
      (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
      (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
      e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
      })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');
      
      _st('install','aB-vgeB8gEDrnRJuhceL','2.0.0');
    </script> -->
    </p>
 </footer>
</div> <!-- container-narrow -->
  


  
<a id="gotop" href="#">   
  <span>⬆︎TOP</span>
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/search.js"></script> 


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



   <script type="text/javascript">      
     var search_path = "search.xml";
	 if (search_path.length == 0) {
	 	search_path = "search.xml";
	 }
	 var path = "/" + search_path;
     searchFunc(path, 'local-search-input', 'local-search-result');
   </script>

</body>
   </html>
