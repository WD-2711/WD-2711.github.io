<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="pragma" content="no-cache">
  <meta http-equiv="cache-control" content="no-cache">
  <meta http-equiv="expires" content="0">
  
  <title>malicious-code-analysis-1 | wd-z711&#39;s B10g</title>
  <meta name="author" content="wd-z711">
  
  <meta name="description" content="Common student in China. Interested in web &amp; re.">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="malicious-code-analysis-1"/>
  <meta property="og:site_name" content="wd-z711&#39;s B10g"/>

  
    <meta property="og:image" content=""/>
  

  
  
    <link href="/favicon.png" rel="icon">
  
  
  <link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>

  <!-- analytics -->
  
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'G-YHJSKZDC3Y', 'auto');
  ga('send', 'pageview');
</script>




<meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="wd-z711's B10g" type="application/atom+xml">
</head>

 <body>  
  <nav id="main-nav" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
      <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
		<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
	  <a class="navbar-brand" href="/">wd-z711&#39;s B10g</a>
      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		  
		  <li>
			<a href="/archives" title="All the articles.">
			  <i class="fa fa-archive"></i>Archives
			</a>
		  </li>
		  
		  <li>
			<a href="/categories" title="All the categories.">
			  <i class="fa fa-folder"></i>Categories
			</a>
		  </li>
		  
		  <li>
			<a href="/about" title="About me.">
			  <i class="fa fa-user"></i>About
			</a>
		  </li>
		  
		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
  	<div class="content">
    	 


	
		<div class="page-header">
			<h1> malicious-code-analysis-1</h1>
		</div>
	



<div class="row post">

	<!-- cols -->
	
	<div id="top_meta"></div>
	<div class="col-md-9">
	

	<!-- content -->
	<div class="mypage">		
	  		

	  <h1 id="恶意代码分析实战笔记-1"><a href="#恶意代码分析实战笔记-1" class="headerlink" title="恶意代码分析实战笔记-1"></a>恶意代码分析实战笔记-1</h1><p>&emsp;诸葛建伟老师翻译的书，泽华大佬推荐的，看里面有好多作业，感觉不错，拿来读读。</p>
<span id="more"></span>
<h2 id="0x00-恶意代码分析技术入门"><a href="#0x00-恶意代码分析技术入门" class="headerlink" title="0x00 恶意代码分析技术入门"></a>0x00 恶意代码分析技术入门</h2><p>&emsp;被感染的主机可以用特征码来辨别是否被感染。特征码分为基于主机的特征码、基于网络的特征码。基于主机的特征码关注的是恶意代码对系统做了什么（例如创建或修改的文件，对注册表的特定修改），而不是恶意代码本身的特性（类似于病毒特征码）。晚会罗特征码是通过检测网络流量来检测恶意代码。</p>
<p>&emsp;恶意代码可以分为：</p>
<p>（1）后门：攻击者无需认证即可连接到远程计算机上，并可以在本地系统执行命令。</p>
<p>（2）僵尸网络：被同一个僵尸网络感染的计算机会听从一台服务器的控制。</p>
<p>（3）下载器：用于下载其它恶意代码。</p>
<p>（4）启动器：用于启动其他恶意程序的恶意代码。</p>
<p>（5）内核套件：用来隐藏其他恶意代码，使得代码很难被受害者发现。</p>
<p>（6）蠕虫：用于自我复制和感染其他计算机的恶意代码。</p>
<p>（7）勒索软件、间谍软件、发送垃圾邮件等。</p>
<p>&emsp;分析恶意代码的通用规则（感觉很有用）：</p>
<p>（1）不要过于陷入细节，大多数恶意程序是复杂的，不可能了解每一个细节，要关注最关键的功能。</p>
<p>（2）不同的任务有不同的方法，没有通用的方法。</p>
<p>（3）不断学习新技术。</p>
<h2 id="0x01-静态分析基础技术"><a href="#0x01-静态分析基础技术" class="headerlink" title="0x01 静态分析基础技术"></a>0x01 静态分析基础技术</h2><p>&emsp;拿到一个恶意程序，步骤为：</p>
<p>（1）上传VirusTotal看看。</p>
<p>（2）计算哈希值，之后在网上搜一搜是否有这个恶意样本。</p>
<p>（3）使用Strings程序查看文件中的可打印字符串（ASCII与Unicode）。</p>
<p>&emsp;很多恶意程序都会加壳，这样的话其可打印字符串就会很少。加壳代码通常会包含<code>LoadLibrary</code>与<code>GetProcAddress</code>函数，用于加载和使用其他函数。可以使用PEiD检测加壳。但是注意，很多PEiD会在没有警告的情况下运行恶意代码。</p>
<p>&emsp;一些知识点复习：</p>
<p>（1）导入函数：程序使用的但存储在另一程序中的函数。代码库通过链接方式被链接到主程序中，然后程序员将一些导入函数链接到他们编写的程序中。链接分为静态链接、动态链接、运行时链接，运行时链接在恶意代码中经常使用，此时，只有当需要使用函数时，才链接到库，而不是像动态链接那样在程序启动时链接。一些windows API允许程序员导入并没有在程序文件头中列出的链接函数，这些API有：<code>LoadLibrary</code>、<code>GetProcAddress</code>、<code>LdrGetProcAddress</code>、<code>LdrLoadDll</code>。可以<strong>使用<code>Dependency Walker</code>观察动态链接函数，<code>PE view</code>可以查看PE头字段，<code>Resource Hacker</code>可以查看PE文件的<code>.rsrc</code>字段</strong>。</p>
<p>&emsp;常见的dll都有：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>DLL</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>kernel32.dll</td>
<td>核心系统功能，比如访问与操作内存、文件与硬件。</td>
</tr>
<tr>
<td>advapi32.dll</td>
<td>对核心windows组件的访问，比如服务管理器与<strong>注册表</strong>。其中<code>Software\Microsoft\Windows\CurrentVersion\Run</code>注册表项表示windows启动时会自动装载哪些程序。</td>
</tr>
<tr>
<td>user32.dll</td>
<td>包含用户界面组件，如按钮、滚动条以及响应用户操作的组件。</td>
</tr>
<tr>
<td>gdi32.dll</td>
<td>图形显示与操作的函数。</td>
</tr>
<tr>
<td>ntdll.dll</td>
<td>windows内核的接口，可执行文件一般不直接导入这个dll，而是由kernel32.dll间接导入。如果可执行文件导入了ntdll.dll，那么意味着程序员企图使用那些不是正常提供给windows使用的函数，例如隐藏功能与操作进程。</td>
</tr>
<tr>
<td>wsock32.dll和ws2_32.dll</td>
<td>联网dll。</td>
</tr>
<tr>
<td>wininet.dll</td>
<td>更高层次的网络函数，例如ftp、http等。</td>
</tr>
</tbody>
</table>
</div>
<p>&emsp;<code>Ex</code>后缀的函数名，例如<code>CreateWindowEx</code>等，这意味着：此函数曾经被更新过。</p>
<p>（2）导出函数：exe文件也可以有导出函数。</p>
<p>&emsp;PE文件格式：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>节名</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>.text</td>
<td>可执行的代码</td>
</tr>
<tr>
<td>.rdata</td>
<td>全局可访问的只读数据，可能包含导入导出函数信息</td>
</tr>
<tr>
<td>.data</td>
<td>程序的全局数据</td>
</tr>
<tr>
<td>.idata</td>
<td>可能包含导入函数信息</td>
</tr>
<tr>
<td>.edata</td>
<td>可能包含导出函数信息</td>
</tr>
<tr>
<td>.pdata</td>
<td>只在64位可执行文件中存在，存储异常处理信息</td>
</tr>
<tr>
<td>.rsrc</td>
<td>使用的资源，例如图标、图片、字符串等</td>
</tr>
<tr>
<td>.reloc</td>
<td>重定位库文件的信息</td>
</tr>
</tbody>
</table>
</div>
<p>&emsp;windows不会关心实际的分节名称，因为使用了PE头中的其他信息来确定如何使用一个分节。因此，分节名称可以被更改。如果PE中节的虚拟大小大于五粒大小，那么就要怀疑是否为加壳代码。</p>
<h3 id="实验1"><a href="#实验1" class="headerlink" title="实验1"></a>实验1</h3><p>&emsp;1. <code>Lab01-01.exe</code>报警：55/71，<code>Lab01-01.dll</code>报警：44/70。</p>
<p>&emsp;2. 编译时间右键查看属性即可。</p>
<p>&emsp;3. 查看PE节都正常，<code>Lab01-01.exe/dll</code>未有混淆迹象。</p>
<p>&emsp;4. 导入函数：<code>CreateFileA|CopyFileA|FindNextFileA|_stricmp</code>。</p>
<p>&emsp;5. 有<code>CopyFileA</code>复制文件的导入函数。答案：检查<code>C:\windows\system32\kerne132.dll</code>用数字<code>1</code>代替了字母<code>l</code>，此文件可以用来在主机作为恶意代码感染的迹象进行搜索</p>
<p>&emsp;6. 没有网络迹象。答案：在dll中有一个私网ip地址<code>127.26.152.13</code>字符串。</p>
<p>&emsp;7. 可能是查找所有文件，并匹配字符串。答案：dll文件可能是一个后门，而exe文件是用来安装与运行此dll文件的。</p>
<h3 id="实验2"><a href="#实验2" class="headerlink" title="实验2"></a>实验2</h3><p>&emsp;1. <code>Lab01-02.exe</code>报警：56/71。</p>
<p>&emsp;2. UPX节，有加壳。</p>
<p>&emsp;3. 去壳后，有导入函数<code>CreateThread|WaiteForSingleObject|CreateServiceA|InternetOpenUrlA</code>，猜测是在互联网下载程序并运行。</p>
<p>&emsp;4. 可能是在<code>http://www.malwareanalysisbook.com</code>中下载的程序。答案：通过名为<code>Malservice</code>的服务，并通过到<code>http://www.malwareanalysisbook.com</code>的网络流量，来检查被恶意代码感染的主机。</p>
<h3 id="实验3"><a href="#实验3" class="headerlink" title="实验3"></a>实验3</h3><p>&emsp;1. <code>Lab01-03.exe</code>报警：61/71。</p>
<p>&emsp;2. 无节名，且虚拟大小远大于存储大小，猜测有加壳或混淆。使用<a target="_blank" rel="noopener" href="https://www.52pojie.cn/thread-886615-1-1.html">FSG脱壳</a>，也就是x64dbg手脱一下。</p>
<p>&emsp;3. 去壳后，有导入函数<code>OleInitialize|CoCreateInstance|VariantInit</code>等，这些有的函数是来自于<code>ole32.dll</code>，此dll可以实现基于 RPC的远程对象通信机制，用于在网络上进行对象的创建和调用。</p>
<p>&emsp;4. 有一些导入库，例如<code>ole32.dll</code>、<code>oleaut32.dll</code>，这能够创建COM组件，实现RPC远程对象通信等。</p>
<h3 id="实验4"><a href="#实验4" class="headerlink" title="实验4"></a>实验4</h3><p>&emsp;1. <code>Lab01-04.exe</code>报警：59/71。</p>
<p>&emsp;2. 没有加壳迹象。</p>
<p>&emsp;3. <code>2019-08-31 06:26:59</code>编译的。</p>
<p>&emsp;4. 有导入函数<code>LoadLibraryA|WinExec</code>等，猜测此运行了某些命令或程序。答案：此程序会写文件到磁盘上，然后执行它。</p>
<p>&emsp;5. 无通信迹象。答案：字符串<code>\system32\wupdmgr.exe</code>表示，此程序会在这个位置创建或修改文件，而另一个URL字符串表示会在此URL上下载文件。</p>
<p>&emsp;6. 发现有一个GUI32程序，猜测 <code>Lab01-04.exe</code>会调用这个GUI32程序。</p>
<h2 id="0x02-在虚拟机中分析恶意代码"><a href="#0x02-在虚拟机中分析恶意代码" class="headerlink" title="0x02 在虚拟机中分析恶意代码"></a>0x02 在虚拟机中分析恶意代码</h2><p>&emsp;主机模式逻辑结构：</p>
<p><img src="/images/malicious-code-analysis-1/image-20230924233603889.png" alt="image-20230924233603889" style="zoom:67%;" /></p>
<p>&emsp;桥接模式：允许虚拟机和物理机器一样连接到相同的物理网卡上。</p>
<h2 id="0x03-动态分析基础技术"><a href="#0x03-动态分析基础技术" class="headerlink" title="0x03 动态分析基础技术"></a>0x03 动态分析基础技术</h2><p>&emsp;沙箱：Norman沙箱、GFI沙箱。</p>
<p>&emsp;沙箱的缺点：只能简单的运行程序，不能带有命令行选项；可能无法记录所有事件，因为有的恶意代码等待一天后才执行；等等。</p>
<h3 id="如何运行一个dll文件？"><a href="#如何运行一个dll文件？" class="headerlink" title="如何运行一个dll文件？"></a>如何运行一个dll文件？</h3><h4 id="方法1：rundll32-exe"><a href="#方法1：rundll32-exe" class="headerlink" title="方法1：rundll32.exe"></a>方法1：<code>rundll32.exe</code></h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rundll32.exe dll_name, func_name</span><br><span class="line">rundll32.exe dll_name, 函数序号（例如 #5）</span><br></pre></td></tr></table></figure>
<h4 id="方法2：修改PE头"><a href="#方法2：修改PE头" class="headerlink" title="方法2：修改PE头"></a>方法2：修改PE头</h4><p>&emsp;在<code>IMAGE_FILE_HEADER</code>的特征域中擦除<code>IMAGE_FILE_DLL(0x200)</code>标记，这样的话点击就会调用<code>DLLMain</code>函数。</p>
<h4 id="方法3：安装为服务的dll"><a href="#方法3：安装为服务的dll" class="headerlink" title="方法3：安装为服务的dll"></a>方法3：安装为服务的dll</h4><p>&emsp;有的dll会被安装为服务，例如它导出了<code>InstallService</code>函数，那么就可以运行：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rundll32.exe dll_name, InstallService service_name</span><br><span class="line">// windows 中启动服务</span><br><span class="line">net start service_name</span><br></pre></td></tr></table></figure>
<p>&emsp;如果没有<code>InstallService</code>，而是有<code>ServiceMain</code>函数，那么就要修改注册表为一个未使用服务进行手动安装，注册表为<code>HKLM\SYSTEM\CurrentControlSet\Services</code>，之后使用<code>net start</code>启动此服务。</p>
<h3 id="进程监视器-Process-Monitor"><a href="#进程监视器-Process-Monitor" class="headerlink" title="进程监视器 Process Monitor"></a>进程监视器 Process Monitor</h3><p>&emsp;windows中的进程监视器可以进行<strong><code>文件监视与注册表监视</code></strong>。但是由于它能<strong>监视几乎所有的系统调用</strong>，且会保存在内存中，因此可能耗尽内存而使得机器崩溃，因此需要限定捕获时间。监视器的过滤操作详见P41。Process Monitor默认排除procmon.exe与pagefile的日志记录，因为他们经常被访问且没有提供有用的信息。</p>
<p>&emsp;如果恶意代码是开机启动的，那么需要将进程监视器安装为自启动驱动，从而捕获恶意代码的启动事件。</p>
<h3 id="进程浏览器-Process-Explorer"><a href="#进程浏览器-Process-Explorer" class="headerlink" title="进程浏览器 Process Explorer"></a>进程浏览器 Process Explorer</h3><p>&emsp;列出所有进程，进程载入的dll，各种进程属性等。默认服务为粉色，进程为蓝色，新进程为绿色，被终止进程为红色。</p>
<p>&emsp;进程浏览器可以验证磁盘上的镜像文件是否有微软的签名，具体在<code>双击进程-&gt;Image-&gt;Verify</code>。此过程验证的是磁盘上的镜像文件，而不是内存中的，所以攻击者如果使用进程替换技术，此功能就检查不出来了（类似于内存马）。</p>
<p>&emsp;还可以查看进程中的字符串来识别是否有进程替换（即磁盘文件与内存中文件是否相同），具体在<code>双击进程-&gt;Strings-&gt;Image/Memory</code>。</p>
<p>&emsp;还可以<code>Find-&gt;Find Handle or DLL</code>找到句柄或dll，当在磁盘中发现恶意dll并想知道谁用了它时，就可以用此方法找到恶意进程。</p>
<p>&emsp;还可以分析而已文档，先打开进程浏览器，之后打开此文档，查看文档是否启动了任意进程，并通过<code>双击进程-&gt;Image-&gt;path</code>查看进程位置。</p>
<h3 id="比较注册表的工具-RegShot"><a href="#比较注册表的工具-RegShot" class="headerlink" title="比较注册表的工具 RegShot"></a>比较注册表的工具 RegShot</h3><p>&emsp;可比较运行恶意代码前后两次的注册表快照。</p>
<h3 id="模拟网络的工具"><a href="#模拟网络的工具" class="headerlink" title="模拟网络的工具"></a>模拟网络的工具</h3><p>&emsp;恶意代码会经常连接到网络，所以可以模拟网络，而不需要实际连接互联网。首先，必须<strong>防止恶意代码探测到自己处于虚拟环境</strong>中。</p>
<p>（1）ApateDNS：可以用来查看恶意代码发出的DNS请求，其通过在本地上监听UDP的53端口，<strong>使用用户指定的IP地址去响应DNS查询请求</strong>（例如程序请求<code>www.baidu.com</code>，我返回<code>192.168.1.1</code>，也可以选择<code>NXDOMAIN</code>，表示不返回任何ip）。</p>
<p>（2）Netcat：可以被用在支持端口扫描、隧道等工具的对内/对外链接上。监听模式下其可以当作服务器，在连接模式下可以充当客户端。<strong>netcat可以从标准输入得到数据并进行网络传输，通过标准输出显示到远程主机中</strong>。</p>
<p>（3）Wireshark：截获并记录网络数据包。</p>
<p>（4）INetSim：可以模拟HTTP、HTTPS、FTP、DNS等，它会努力伪装的像一台真正的服务器。它会相应恶意代码发来的请求，例如恶意代码请求图片，那么INetSim就会返回一张图片。</p>
<h3 id="动态工具组合分析的例子"><a href="#动态工具组合分析的例子" class="headerlink" title="动态工具组合分析的例子"></a>动态工具组合分析的例子</h3><p>&emsp;准备工作：（1）启动进程监视器，过滤器设置为保留可执行恶意代码文件名，并清空所有事件。（2）启动进程浏览器。（3）使用RegShot对注册表拍摄快照。（4）使用INetSim和ApateDNS设置虚拟网络。（5）使用Wireshark记录网络行为。</p>
<p>&emsp;虚拟网络的配置架构如下所示：</p>
<p><img src="/images/malicious-code-analysis-1/image-20230927190703285.png" alt="image-20230927190703285" style="zoom:67%;" /></p>
<p>&emsp;分析过程见P55。</p>
<h3 id="实验1-1"><a href="#实验1-1" class="headerlink" title="实验1"></a>实验1</h3><p>&emsp;1. 此程序或许被加壳，仅有<code>ExitProcess</code>导入函数，字符串列表如下：</p>
<p><img src="/images/malicious-code-analysis-1/image-20230928123000193.png" alt="image-20230928123000193" style="zoom:67%;" /></p>
<p>&emsp;2-3. 感染迹象特征与网络特征码，程序运行报错，所以无法动态调试。已看答案，在此不再描述。</p>
<h3 id="实验2-1"><a href="#实验2-1" class="headerlink" title="实验2"></a>实验2</h3><p>&emsp;1. 查看导出表，有<code>Install</code>函数，故运行：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rundll32.exe Lab03-02.dll, Install aaa</span><br></pre></td></tr></table></figure>
<p>&emsp;就会将dll安装为aaa服务，但是答案使用的<code>rundll32.exe Lab03-02.dll, installA aaa</code>。</p>
<p>&emsp;2. <code>net start aaa</code>。真正运行时1，2都在ntdll.exe中出错误，不知道为啥。</p>
<p>&emsp;3. 在进程浏览器中查找<code>Lab03-02.dll</code>被使用的程序。</p>
<p>&emsp;4. 使用进程pid过滤。</p>
<p>&emsp;注：启动任何服务，60s后才能看到网络通信。5-6的感染迹象与网络特征码在此略，主要是运行不起来。</p>
<h3 id="实验3-实验4"><a href="#实验3-实验4" class="headerlink" title="实验3-实验4"></a>实验3-实验4</h3><p>&emsp;此文件也运行不起来，直接看看答案。实验3中的程序是击键记录器，写入到某个log中。实验4中的程序则会删除自身。</p>
<p>&emsp;注：<code>svchost.exe</code>作为孤儿进程是不寻常的，它通常是<code>services.exe</code>的子进程。</p>
<h2 id="0x04-x86反汇编速成班"><a href="#0x04-x86反汇编速成班" class="headerlink" title="0x04 x86反汇编速成班"></a>0x04 x86反汇编速成班</h2><p>&emsp;快速过一遍。</p>
<p>&emsp;计算机系统的6个抽象层次，从低到高列举，层次越低，可移植性越差：</p>
<p>（1）硬件：唯一的物理层，由电子电路组成，这些电路实现了XOR、AND、NOT门的复杂组合，称为数字逻辑。</p>
<p>（2）微指令：又叫固件，微指令只能在为它设计的特定电路上执行，它们通常是为特定的计算机硬件设计的。</p>
<p>（3）机器码：机器码由多条微指令实现，机器码由操作码opcode组成，高级语言编写的程序可以编译成机器码。</p>
<p>（4）低级语言：汇编语言。</p>
<p>（5）高级语言：C/C++，可编译成机器码。</p>
<p>（6）解释型语言：C#、Perl、.NET、java等，翻译为字节码，在解释器中运行。解释器独立于操作系统，可以将字节码翻译成机器码，可以自己处理错误与管理内存。</p>
<p>&emsp;汇编语言分为x86/x64/SPARC/PowerPC/MIPS/ARM，其中x86是大部分PC使用的体系结构，因此大部分恶意代码是x86编译的。</p>
<p>&emsp;x86体系结构如下：</p>
<p><img src="/images/malicious-code-analysis-1/image-20231010215224592.png" alt="image-20231010215224592" style="zoom:67%;" /></p>
<ul>
<li>控制单元：使用指令指针寄存器IP从内存中取指令。</li>
<li>算术逻辑单元ALU：执行从内存中取来的质量，并将结果放到寄存器或内存中。</li>
</ul>
<p>&emsp;程序内存分布与增长方向：</p>
<p><img src="/images/malicious-code-analysis-1/image-20231010215649324.png" alt="image-20231010215649324" style="zoom:67%;" /></p>
<p>&emsp;表示127.0.0.1，大端序（高位在前）：0x7F000001，小端序（低位在前）：0x0100007F。</p>
<p>&emsp;寄存器要注意的点：</p>
<p>（1）SF（sign）：当运算结果为负数，SF置为1；TF：置位时，x86每次处理一条指令。</p>
<p>（2）pusha：按顺序AX、CX、DX、BX、SP、BP、SI、DI压入栈中。</p>
<p>（3）pushad：按顺序EAX、ECX、EDX、EBX、ESP、EBP、ESI、EDI压入栈中。</p>
<p>&emsp;函数调用要注意的点：<code>push 参数；call A（相当于push eip；jmp A）；push ebp；mov ebp, esp</code>。函数结束时，<code>mov esp, ebp；pop ebp；ret（相当于pop eip；jmp eip）</code>。</p>
<p>&emsp;条件指令要注意的点：</p>
<p>（1）ja与jg相比，ja使用无符号比较，jg使用有符号比较。</p>
<p>（2）jb与jl相比，jb使用无符号比较，jl使用有符号比较。</p>
<p>（3）jo：溢出标志OF=1；js：符号位SF=1；jecxz：ECX=0。</p>
<p>&emsp;重复指令要注意的点：</p>
<p>（1）repe cmpsb：逐字节比较EDI与ESI两块缓冲区，当ECX=0或缓冲区不一致时，则停止比较。</p>
<p>（2）rep stosb：给定初始值AL，将AL赋给EDI缓冲区地址的所有字节，直到ECX=0。</p>
<p>（3）rep movsb：ESI到EDI复制，直到ECX=0。</p>
<p>（4）repne scasb：在一段缓冲区中搜索一个字节，EDI为缓冲区地址，AL为要找的字节，直到ECX=0或找到该字节。</p>
<h2 id="0x05-IDA-pro"><a href="#0x05-IDA-pro" class="headerlink" title="0x05 IDA pro"></a>0x05 IDA pro</h2><p>&emsp;快速过一遍。</p>
<p>&emsp;默认情况下，图形模式中，红色箭头代表条件跳转未被采用，绿色表示条件跳转被采用，蓝色表示无条件跳转。文本模式种，实线箭头表示无条件跳转，虚线表示条件跳转。对于二进制线性地址空间条而言，浅蓝色是库代码，红色是编译器生成的代码，深蓝色是用户代码，导入数据为粉红色，已经定义的数据为灰色，未定义的数据为棕色。</p>
<p>&emsp;有时候Ida无法识别出基于EBP的栈帧，修正方法：<code>Alt+P -&gt; BP based frame -&gt; 4 bytes for Saved Reg</code>。</p>
<p>&emsp;<code>IDA可以画出函数间的调用图</code>。</p>
<p>&emsp;各种细节的操作更新到了tool-use中。</p>
<p>&emsp;IDC脚本：</p>
<p>（1）IDC脚本学习在ida安装目录下的idc文件夹下，有空学习（挖个坑）。</p>
<p>（2）IDC脚本是由函数组成的程序，所有函数都是静态的，参数无需指定类型，auto被用来定义局部变量，其中事先定义好了很多内建函数。</p>
<p>（3）举例：PEiD是一个检测加壳的工具，它也可以识别加密算法，其对应的插件Krypto ANALyzer可以导出idc脚本如下，此脚本负责在文件的ida数据库中设置书签和注释：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;idc.idc&gt;</span></span></span><br><span class="line"><span class="type">static</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">auto</span> slotidx;</span><br><span class="line">	slotidx = <span class="number">1</span>;</span><br><span class="line">	<span class="comment">// 在 0x00403108 添加标记，内容为 &quot;RIGNDAEL [S] [char]&quot;</span></span><br><span class="line">	<span class="comment">// 0,0,0 代表标记类型、颜色与边界样式</span></span><br><span class="line">	<span class="comment">// slotidx+0 代表创建标记</span></span><br><span class="line">	MarkPosition(<span class="number">0x00403108</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, slotidx+<span class="number">0</span>, <span class="string">&quot;RIGNDAEL [S] [char]&quot;</span>);</span><br><span class="line">	<span class="comment">// 在 0x00403109 的前一个非尾指令处添加注释</span></span><br><span class="line">	MakeComm(PrevNotTail(<span class="number">0x00403109</span>), <span class="string">&quot;RINDAEL [S] [char]\nRIJNDAEL(AES):SBOX(also used in other ciphers).&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&emsp;IDAPython：</p>
<p>（1）感觉比idc更方便，比idc强大很多。idapython<code>可以访问idaapi，idc与idautils 3个模块</code>。</p>
<p>（2）例子，对idb中的所有call指令上色：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> idautils <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> idc <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># ScreenEA 获取光标位置</span></span><br><span class="line"><span class="comment"># SegStart(ScreenEA()) 与 SegEnd(ScreenEA()) ：获取段开头地址与段结尾地址</span></span><br><span class="line"><span class="comment"># Heads(SegStart(ScreenEA()), SegEnd(ScreenEA())) ：获取指定范围内所有指令的地址</span></span><br><span class="line">heads = Heads(SegStart(ScreenEA()), SegEnd(ScreenEA()))</span><br><span class="line">functionCalls = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> heads:</span><br><span class="line">    <span class="comment"># 获取指定地址处的助记符</span></span><br><span class="line">    <span class="keyword">if</span> GetMnem(i) == <span class="string">&quot;call&quot;</span>:</span><br><span class="line">        functionCalls.append(i)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> functionCalls:</span><br><span class="line">    <span class="comment"># CIC_ITEM 表示设置的类型为 ITEM 类型</span></span><br><span class="line">    <span class="comment"># 0xc7fdff 表示颜色值</span></span><br><span class="line">    SetColor(i, CIC_ITEM, <span class="number">0xc7fdff</span>)</span><br></pre></td></tr></table></figure>
<h4 id="实验1-2"><a href="#实验1-2" class="headerlink" title="实验1"></a>实验1</h4><p>&emsp;1. 0x1000D02E</p>
<p>&emsp;2. 0x100163CC</p>
<p>&emsp;3. 9</p>
<p>&emsp;4. pics.praticalmalwareanalysis.com</p>
<p>&emsp;5. 23</p>
<p>&emsp;6. 1</p>
<p>&emsp;7. 0x10095B34</p>
<p>&emsp;8. 启动计算器。答案：启动远程shell会话。</p>
<p>&emsp;9. 运行完sub_10003695，将返回值给dword_1008E5C4。sub_10003695函数的作用是检测操作系统版本的platformID是否为2，即是否为win7之类的。</p>
<p>&emsp;10. 会执行sub_100052A2函数，其内容是发送字符串+工作时间到远端。答案：查询注册表WorkTime与WorkTimes，并通过shell发送出去。</p>
<p>&emsp;11. 在系统中找寻是否有某个名字的程序，若有则发送到远端。</p>
<p>&emsp;12. 获取systemid并发送给远端。答案：改为GetSystemLanguage。</p>
<p><img src="/images/malicious-code-analysis-1/image-20231011120149863.png" alt="image-20231011120149863" style="zoom:67%;" /></p>
<p>&emsp;13. 图好复杂，看不出来。答案：</p>
<p>（1）View-&gt;Graph-&gt;User xrefs chart，选择递归深度为1。</p>
<p><img src="/images/malicious-code-analysis-1/image-20231011133749190.png" alt="image-20231011133749190" style="zoom:67%;" /></p>
<p><img src="/images/malicious-code-analysis-1/image-20231011133758687.png" alt="image-20231011133758687" style="zoom:67%;" /></p>
<p>（2）同理，选择递归深度为2。</p>
<p>&emsp;14. 30s。</p>
<p>&emsp;15. 2，1，6。</p>
<p>&emsp;16. 分别定义为AF_INET、Sock_stream、IPPROTO_TCP。但是IDA没有这个符号。答案：选择，右击，use standard symbolic constant。</p>
<p>&emsp;17. 被使用了。如下所示：</p>
<p><img src="/images/malicious-code-analysis-1/image-20231011131417839.png" alt="image-20231011131417839" style="zoom:67%;" /></p>
<p>&emsp;字符串表示：找到虚拟机，安装中止。</p>
<p><img src="/images/malicious-code-analysis-1/image-20231011131454159.png" alt="image-20231011131454159" style="zoom:67%;" /></p>
<p>&emsp;18. 发现了一段字符。</p>
<p>&emsp;19. 脚本有些过时，对于ida7.7而言，更改如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> idautils <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> idaapi</span><br><span class="line"><span class="keyword">import</span> ida_bytes</span><br><span class="line">sea = get_screen_ea()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x00</span>,<span class="number">0x50</span>):</span><br><span class="line">        b = idaapi.get_bytes(sea+i, <span class="number">1</span>)</span><br><span class="line">        decoded_byte = <span class="built_in">int</span>.from_bytes(b, byteorder=<span class="string">&#x27;little&#x27;</span>) ^ <span class="number">0x55</span></span><br><span class="line">        ida_bytes.patch_byte(sea+i, decoded_byte)</span><br></pre></td></tr></table></figure>
<p>&emsp;20. A键，变为：<code>xdoor is this backdoor, string decoded for Practical Malware Analysis Lab :)1234</code>。</p>
<p>&emsp;21. 脚本工作原理不必赘述。</p>
<p>To be continued…</p>

  
	</div>

	<div>
  	<center>
	<div class="pagination">

    
    
    <a href="/2023/09/05/rust-rrrre/" type="button" class="btn btn-default"><i
                class="fa fa-arrow-circle-o-left"></i> 上一页</a>
    

    <a href="/" type="button" class="btn btn-default"><i class="fa fa-home"></i>Home</a>
    
    <a href="/2023/08/25/wannaCry-analysis/" type="button" class="btn btn-default ">下一页<i
                class="fa fa-arrow-circle-o-right"></i></a>
    

    
</div>

    </center>
	</div>


	<!-- comment -->
	
<section id="comment">
    <h2 class="title">留言</h2>

    <!-- 
    <div id="disqus_thread" class="ds-thread">
        <script type="text/javascript">
            /**
             * RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
             * LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
             */
                /*
                 var disqus_config = function () {
                 this.page.url = PAGE_URL; // Replace PAGE_URL with your page's canonical URL variable
                 this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
                 };
                 */
            (function() { // DON'T EDIT BELOW THIS LINE
                var d = document, s = d.createElement('script');

                s.src = 'https://https-wd-2711-tech.disqus.com/embed.js';

                s.setAttribute('data-timestamp', +new Date());
                (d.head || d.body).appendChild(s);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by
                Disqus.</a></noscript>
    </div> -->
    <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
    <div id="vcomments"></div>
    <script>
        new Valine({
            el: '#vcomments',
            appId: 'wLIJ70s3fPvW8WJPgVVAuWVR-gzGzoHsz',
            appKey: 'NVGqxhUkqtFv2CbwmXXWjCdR'
        })
    </script>

    
</section>


	</div> <!-- col-md-9/col-md-12 -->
		
	
	<div id="side_meta">
		<div class="col-md-3" id="post_meta"> 

	<!-- date -->
	
	<div class="meta-widget">
	<i class="fa fa-clock-o"></i>
	2023-08-28 
	</div>
	

	<!-- categories -->
    
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#categorys"><i class="fa fa-folder"></i></a>	
    <ul id="categorys" class="tag_box list-unstyled collapse in">
          
  <li>
    <li><a href="/categories/re-book/">re-book<span>11</span></a></li>
  </li>

    </ul>
	</div>
	

	<!-- tags -->
		

	<!-- toc -->
	<div class="meta-widget">
	
	   <a data-toggle="collapse" data-target="#toc"><i class="fa fa-bars"></i></a>
	   <div id="toc" class="toc collapse in">
		   <span class="toc-title">Contents</span>
			<ol class="toc-article"><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E7%AC%94%E8%AE%B0-1"><span class="toc-article-text">恶意代码分析实战笔记-1</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#0x00-%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E6%8A%80%E6%9C%AF%E5%85%A5%E9%97%A8"><span class="toc-article-text">0x00 恶意代码分析技术入门</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#0x01-%E9%9D%99%E6%80%81%E5%88%86%E6%9E%90%E5%9F%BA%E7%A1%80%E6%8A%80%E6%9C%AF"><span class="toc-article-text">0x01 静态分析基础技术</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#%E5%AE%9E%E9%AA%8C1"><span class="toc-article-text">实验1</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#%E5%AE%9E%E9%AA%8C2"><span class="toc-article-text">实验2</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#%E5%AE%9E%E9%AA%8C3"><span class="toc-article-text">实验3</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#%E5%AE%9E%E9%AA%8C4"><span class="toc-article-text">实验4</span></a></li></ol></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#0x02-%E5%9C%A8%E8%99%9A%E6%8B%9F%E6%9C%BA%E4%B8%AD%E5%88%86%E6%9E%90%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81"><span class="toc-article-text">0x02 在虚拟机中分析恶意代码</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#0x03-%E5%8A%A8%E6%80%81%E5%88%86%E6%9E%90%E5%9F%BA%E7%A1%80%E6%8A%80%E6%9C%AF"><span class="toc-article-text">0x03 动态分析基础技术</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#%E5%A6%82%E4%BD%95%E8%BF%90%E8%A1%8C%E4%B8%80%E4%B8%AAdll%E6%96%87%E4%BB%B6%EF%BC%9F"><span class="toc-article-text">如何运行一个dll文件？</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-4"><a class="toc-article-link" href="#%E6%96%B9%E6%B3%951%EF%BC%9Arundll32-exe"><span class="toc-article-text">方法1：rundll32.exe</span></a></li><li class="toc-article-item toc-article-level-4"><a class="toc-article-link" href="#%E6%96%B9%E6%B3%952%EF%BC%9A%E4%BF%AE%E6%94%B9PE%E5%A4%B4"><span class="toc-article-text">方法2：修改PE头</span></a></li><li class="toc-article-item toc-article-level-4"><a class="toc-article-link" href="#%E6%96%B9%E6%B3%953%EF%BC%9A%E5%AE%89%E8%A3%85%E4%B8%BA%E6%9C%8D%E5%8A%A1%E7%9A%84dll"><span class="toc-article-text">方法3：安装为服务的dll</span></a></li></ol></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#%E8%BF%9B%E7%A8%8B%E7%9B%91%E8%A7%86%E5%99%A8-Process-Monitor"><span class="toc-article-text">进程监视器 Process Monitor</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#%E8%BF%9B%E7%A8%8B%E6%B5%8F%E8%A7%88%E5%99%A8-Process-Explorer"><span class="toc-article-text">进程浏览器 Process Explorer</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#%E6%AF%94%E8%BE%83%E6%B3%A8%E5%86%8C%E8%A1%A8%E7%9A%84%E5%B7%A5%E5%85%B7-RegShot"><span class="toc-article-text">比较注册表的工具 RegShot</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#%E6%A8%A1%E6%8B%9F%E7%BD%91%E7%BB%9C%E7%9A%84%E5%B7%A5%E5%85%B7"><span class="toc-article-text">模拟网络的工具</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#%E5%8A%A8%E6%80%81%E5%B7%A5%E5%85%B7%E7%BB%84%E5%90%88%E5%88%86%E6%9E%90%E7%9A%84%E4%BE%8B%E5%AD%90"><span class="toc-article-text">动态工具组合分析的例子</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#%E5%AE%9E%E9%AA%8C1-1"><span class="toc-article-text">实验1</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#%E5%AE%9E%E9%AA%8C2-1"><span class="toc-article-text">实验2</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#%E5%AE%9E%E9%AA%8C3-%E5%AE%9E%E9%AA%8C4"><span class="toc-article-text">实验3-实验4</span></a></li></ol></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#0x04-x86%E5%8F%8D%E6%B1%87%E7%BC%96%E9%80%9F%E6%88%90%E7%8F%AD"><span class="toc-article-text">0x04 x86反汇编速成班</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#0x05-IDA-pro"><span class="toc-article-text">0x05 IDA pro</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-4"><a class="toc-article-link" href="#%E5%AE%9E%E9%AA%8C1-2"><span class="toc-article-text">实验1</span></a></li></ol></li></ol></li></ol></li></ol>
		</div>
	
	</div>
	
    <hr>
	
</div><!-- col-md-3 -->

	</div>

	<!-- copyright -->
	<div>
    <ul class="post-copyright">
      <li class="post-copyright-author">
      <strong>作者:  </strong>wd-z711</a>
      </li>
      <li class="post-copyright-link">
      <strong>文章链接:  </strong>
      <a href="/" target="_blank" title="">https://wd-2711.tech/</a>
      </li>
      <li class="post-copyright-license">
        <strong>版权声明:   </strong>
        本博客所有文章除特别声明外，均采用 <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">CC BY-NC-ND 4.0</a>
        许可协议。转载请注明出处!
      </li>
    </ul>
  <div>
 	

		


</div><!-- row -->




	</div>
  </div>
  <div class="container-narrow">
  <footer> <p>
  &copy; 2023 wd-z711
  
      <!-- with help from <a href="http://hexo.io/" target="_blank">Hexo</a>,<a target="_blank" rel="noopener" href="http://github.com/wzpan/hexo-theme-freemind/">Freemind</a>,<a href="http://getbootstrap.com/" target="_blank">Twitter Bootstrap</a> and <a href="http://getbootstrap.com/" target="_blank">BOOTSTRA.386</a>. 
     <br> Theme by <a target="_blank" rel="noopener" href="http://github.com/wzpan/hexo-theme-freemind/">Freemind.386</a>.     -->

     <!-- <script type="text/javascript">
      (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
      (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
      e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
      })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');
      
      _st('install','aB-vgeB8gEDrnRJuhceL','2.0.0');
    </script> -->
    </p>
 </footer>
</div> <!-- container-narrow -->
  


  
<a id="gotop" href="#">   
  <span>⬆︎TOP</span>
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/search.js"></script> 


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



   <script type="text/javascript">      
     var search_path = "search.xml";
	 if (search_path.length == 0) {
	 	search_path = "search.xml";
	 }
	 var path = "/" + search_path;
     searchFunc(path, 'local-search-input', 'local-search-result');
   </script>

</body>
   </html>
