<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="pragma" content="no-cache">
  <meta http-equiv="cache-control" content="no-cache">
  <meta http-equiv="expires" content="0">
  
  <title>camera-experiment | wd-z711&#39;s B10g</title>
  <meta name="author" content="wd-z711">
  
  <meta name="description" content="Common student in China. Interested in web &amp; re.">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="camera-experiment"/>
  <meta property="og:site_name" content="wd-z711&#39;s B10g"/>

  
    <meta property="og:image" content=""/>
  

  
  
    <link href="/favicon.png" rel="icon">
  
  
  <link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>

  <!-- analytics -->
  
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'G-YHJSKZDC3Y', 'auto');
  ga('send', 'pageview');
</script>




<meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="wd-z711's B10g" type="application/atom+xml">
</head>

 <body>  
  <nav id="main-nav" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
      <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
		<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
	  <a class="navbar-brand" href="/">wd-z711&#39;s B10g</a>
      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		  
		  <li>
			<a href="/archives" title="All the articles.">
			  <i class="fa fa-archive"></i>Archives
			</a>
		  </li>
		  
		  <li>
			<a href="/categories" title="All the categories.">
			  <i class="fa fa-folder"></i>Categories
			</a>
		  </li>
		  
		  <li>
			<a href="/about" title="About me.">
			  <i class="fa fa-user"></i>About
			</a>
		  </li>
		  
		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
  	<div class="content">
    	 


	
		<div class="page-header">
			<h1> camera-experiment</h1>
		</div>
	



<div class="row post">

	<!-- cols -->
	
	<div id="top_meta"></div>
	<div class="col-md-9">
	

	<!-- content -->
	<div class="mypage">		
	  		

	  <h1 id="摄像头实验"><a href="#摄像头实验" class="headerlink" title="摄像头实验"></a>摄像头实验</h1><h2 id="摘要："><a href="#摘要：" class="headerlink" title="## 摘要："></a>## 摘要：</h2><p>&emsp;本课程报告完成了一个基于STM32的摄像头控制项目。软件上，项目并未使用HAL库，而是使用寄存器库，直接对开发板、屏幕、摄像头等硬件的寄存器进行操作。项目涉及了多种头文件，例如stm32f10x.h（定义了STM32F10x芯片的寄存器定义和外设结构体，可以方便地访问和配置STM32F10x芯片的外设）、system_stm32f10x.h（STM32F10x芯片的系统配置函数，初始化时钟系统，设置系统时钟源和时钟频率）等，这些都是来自MCD Application团队提供的头文件。在个人开发中，结合开发板、摄像头、屏幕对应的开发文档与提供的接口代码，设计编程了按键初始化、屏幕输出字符/刷新、摄像头画面风格等函数，并在main函数中进行硬件操作的结合。最终，使用STM32 F103ZET6开发板，结合MCU屏幕与摄像头，可以实现两个功能：（1）在屏幕中可以看到摄像头的画面；（2）使用按键，可以调节摄像头显示画面的风格。</p>
<span id="more"></span>
<h2 id="0x00-实验设备-amp-软件"><a href="#0x00-实验设备-amp-软件" class="headerlink" title="0x00 实验设备&amp;软件"></a>0x00 实验设备&amp;软件</h2><div class="table-container">
<table>
<thead>
<tr>
<th>设备名称</th>
<th>设备型号</th>
</tr>
</thead>
<tbody>
<tr>
<td>开发板</td>
<td>STM32 F103ZET6</td>
</tr>
<tr>
<td>屏幕</td>
<td>MCU电阻屏，IC驱动：ILI9341/ST7789</td>
</tr>
<tr>
<td>摄像头</td>
<td>OV7725</td>
</tr>
<tr>
<td>软件</td>
<td>Keil uVision5</td>
</tr>
</tbody>
</table>
</div>
<h2 id="0x01-头文件介绍"><a href="#0x01-头文件介绍" class="headerlink" title="0x01 头文件介绍"></a>0x01 头文件介绍</h2><div class="table-container">
<table>
<thead>
<tr>
<th>文件名</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>stm32f10x.h</td>
<td>STM32F10x芯片的寄存器定义和外设结构体，可以方便地访问和配置STM32F10x芯片的外设</td>
</tr>
<tr>
<td>core_cm3.h</td>
<td>Cortex-M3处理器的寄存器映射以及内联函数，是CMSIS（Cortex Microcontroller Software Interface Standard）标准的一部分，用来提供对Cortex-M3的访问和控制</td>
</tr>
<tr>
<td>system_stm32f10x.h</td>
<td>STM32F10x芯片的系统配置函数，初始化时钟系统，设置系统时钟源和时钟频率</td>
</tr>
<tr>
<td>stdint.h</td>
<td>定义了int8_t、uint32_t等</td>
</tr>
<tr>
<td>stm32f10x_conf.h</td>
<td>包含所有外设的头文件，例如GPIO、TIM、USART等，使用标准外设库时必须包含此文件</td>
</tr>
<tr>
<td>stm32f10x_exti.h</td>
<td>与外部中断相关的寄存器和函数定义，使用标准外设库时必须包含此文件</td>
</tr>
<tr>
<td>stm32f10x_fsmc.h</td>
<td>连接并管理外部存储，例如NOR、NAND、SRAM等</td>
</tr>
<tr>
<td>stm32f10x_gpio.h</td>
<td>定义GPIO（通用输入输出）的数据结构和函数，使用GPIO可以控制LED灯、输出音频等</td>
</tr>
<tr>
<td>stm32f10x_rcc.h</td>
<td>定义时钟控制与复位相关的数据结构和函数</td>
</tr>
<tr>
<td>stm32f10x_tim.h</td>
<td>定义测量时间间隔的数据结构和函数</td>
</tr>
<tr>
<td>stm32f10x_usart.h</td>
<td>定义USART的数据结构和函数；USART（通用同步异步收发器）是一种用于串行数据传输的外设</td>
</tr>
<tr>
<td>misc.h</td>
<td>定义操作内核组件的函数与结构体</td>
</tr>
</tbody>
</table>
</div>
<p><img src="/images/camera-experiment/image-20230602150936740.png" alt="image-20230602150936740" style="zoom:67%;" /></p>
<p>补充：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">NOR：可像随机存取存储器一样进行随机访问，存储程序代码，写入和擦除速度较慢。</span><br><span class="line">NAND：不能随机访问，存储数据，写入和擦除速度较快。</span><br><span class="line">SRAM：静态随机存取存储器，适用于高速缓存。</span><br></pre></td></tr></table></figure>
<h2 id="0x02-初始化操作"><a href="#0x02-初始化操作" class="headerlink" title="0x02 初始化操作"></a>0x02 初始化操作</h2><h3 id="延时函数初始化"><a href="#延时函数初始化" class="headerlink" title="延时函数初始化"></a>延时函数初始化</h3><p>&emsp;方便调用延时函数。首先设置SysTick定时器，它可以用来实现延时，当计数到0时，会从重装载寄存器中自动重装载定时初值，并触发中断；之后，设置fac_us与fac_ms，设置fac_us为系统时钟的1/8，STM32 F103xxxx的频率为72MHz。</p>
<p>&emsp;函数代码：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// delay.c</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">delay_init</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">SysTick_CLKSourceConfig</span>(SysTick_CLKSource_HCLK_Div8);	</span><br><span class="line">	fac_us=SystemCoreClock/<span class="number">8000000</span>;				           <span class="comment">//设置fac_us为系统时钟的1/8  </span></span><br><span class="line">	fac_ms=(u16)fac_us*<span class="number">1000</span>;					            </span><br><span class="line">&#125;								    </span><br></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// misc.c</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">SysTick_CLKSourceConfig</span><span class="params">(<span class="type">uint32_t</span> SysTick_CLKSource)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">if</span> (SysTick_CLKSource == SysTick_CLKSource_HCLK) &#123;</span><br><span class="line">    	SysTick-&gt;CTRL |= SysTick_CLKSource_HCLK;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">    	SysTick-&gt;CTRL &amp;= SysTick_CLKSource_HCLK_Div8;      <span class="comment">//设置SysTick定时器</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// misc.h</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SysTick_CLKSource_HCLK_Div8    ((uint32_t)0xFFFFFFFB)</span></span><br></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// system_stm32f10x.c</span></span><br><span class="line"><span class="type">uint32_t</span> SystemCoreClock = SYSCLK_FREQ_72MHz;             <span class="comment">//STM32 F103xxxx的频率</span></span><br></pre></td></tr></table></figure>
<h3 id="串口初始化"><a href="#串口初始化" class="headerlink" title="串口初始化"></a>串口初始化</h3><p>&emsp;初始化USART1串口。其作用是实现与外部设备的全双工通用同步/异步串行通信。USART1可以支持多种数据帧格式、波特率、校验方式、流控制和中断方式，可以用于发送和接收数据，USART1可以通过GPIOA的9和10引脚分别作为TX和RX与外部设备连接。</p>
<p>&emsp;函数逻辑：（1）使能USART1与GPIOA的时钟；（2）配置GPIOA的9和10引脚分别作为USART1的TX和RX，使用复用推挽输出和浮空输入；（3）之后，配置NVIC，设置中断优先级为抢占优先级3和子优先级3，并使能中断；（4）配置USART1的波特率、数据位、停止位、奇偶校验等参数；（5）使能USART1的中断和串口。</p>
<p>&emsp;补充：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1. GPIOA是STM32的一组通用输入/输出端口，共有16个引脚，可以通过软件配置成输入/输出模式</span><br><span class="line">2. 复用推挽输出：GPIO引脚可以输出来自其他外设的数据，比如定时器、DAC等，而不是输出数据寄存器中的数据。复用推挽输出既可以输出高电平，又可以输出低电平，速度快，损耗小。</span><br><span class="line">3. 浮空输入：GPIO引脚可以接收数字信号，但是没有上拉或下拉电阻，所以当没有信号输入时，电压不确定，容易受到干扰。浮空输入可以检测到微弱的信号。</span><br><span class="line">4. NVIC：中断控制器，用于控制和管理中断的优先级、使能、挂起。</span><br><span class="line">5. 抢占优先级：中断能够打断其他中断的属性，抢占优先级高（数值小）的中断可以打断抢占优先级低（数值大）的中断。</span><br><span class="line">6. 子优先级：指在抢占优先级相同的情况下，哪个中断先被响应的属性，子优先级高（数值小）的中断先被响应。</span><br></pre></td></tr></table></figure>
<p>&emsp;函数定义如下：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// usart.c</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">uart_init</span><span class="params">(u32 bound)</span></span>&#123;</span><br><span class="line">	... </span><br><span class="line">    </span><br><span class="line">    <span class="comment">//使能USART1，GPIOA时钟</span></span><br><span class="line">    <span class="built_in">RCC_APB2PeriphClockCmd</span>(RCC_APB2Periph_USART1|RCC_APB2Periph_GPIOA, ENABLE);	</span><br><span class="line">  </span><br><span class="line">	<span class="comment">//配置GPIOA的9和10引脚</span></span><br><span class="line">	GPIO_InitStructure.GPIO_Pin = GPIO_Pin_9;</span><br><span class="line">	GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;</span><br><span class="line">	GPIO_InitStructure.GPIO_Mode = GPIO_Mode_AF_PP;	<span class="comment">//复用推挽输出</span></span><br><span class="line">	<span class="built_in">GPIO_Init</span>(GPIOA, &amp;GPIO_InitStructure);</span><br><span class="line">	GPIO_InitStructure.GPIO_Pin = GPIO_Pin_10;</span><br><span class="line">	GPIO_InitStructure.GPIO_Mode = GPIO_Mode_IN_FLOATING;<span class="comment">//浮空输入</span></span><br><span class="line">	<span class="built_in">GPIO_Init</span>(GPIOA, &amp;GPIO_InitStructure);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//配置终端控制器NVIC</span></span><br><span class="line">	NVIC_InitStructure.NVIC_IRQChannel = USART1_IRQn;</span><br><span class="line">	NVIC_InitStructure.NVIC_IRQChannelPreemptionPriority=<span class="number">3</span> ;</span><br><span class="line">	NVIC_InitStructure.NVIC_IRQChannelSubPriority = <span class="number">3</span>;	</span><br><span class="line">	NVIC_InitStructure.NVIC_IRQChannelCmd = ENABLE;		</span><br><span class="line">	<span class="built_in">NVIC_Init</span>(&amp;NVIC_InitStructure);</span><br><span class="line">  </span><br><span class="line">	<span class="comment">//配置USART1的参数</span></span><br><span class="line">	USART_InitStructure.USART_BaudRate = bound;</span><br><span class="line">	USART_InitStructure.USART_WordLength = USART_WordLength_8b;</span><br><span class="line">	USART_InitStructure.USART_StopBits = USART_StopBits_1;</span><br><span class="line">	USART_InitStructure.USART_Parity = USART_Parity_No;</span><br><span class="line">	USART_InitStructure.USART_HardwareFlowControl = USART_HardwareFlowControl_None;</span><br><span class="line">	USART_InitStructure.USART_Mode = USART_Mode_Rx | USART_Mode_Tx;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">USART_Init</span>(USART1, &amp;USART_InitStructure);</span><br><span class="line">	<span class="built_in">USART_ITConfig</span>(USART1, USART_IT_RXNE, ENABLE);</span><br><span class="line">	<span class="built_in">USART_Cmd</span>(USART1, ENABLE);               </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&emsp;波特率（每秒传输的位数）设置为115200。115200是一种常用的波特率，可以实现较高的传输效率和较低的误码率。</p>
<h3 id="按键与屏幕初始化"><a href="#按键与屏幕初始化" class="headerlink" title="按键与屏幕初始化"></a>按键与屏幕初始化</h3><p>&emsp;对于按键而言，我们要初始化KEY0与KEY1，其中KEY0负责转换画面风格，KEY1负责进入摄像头页面：（1）使能GPIOA和GPIOE的时钟，这样才能对端口进行配置；（2）设置GPIO_InitStructure.GPIO_Pin为GPIO_Pin_4|GPIO_Pin_3，表示要配置的是GPIOE的第4和第3引脚，也就是KEY0和KEY1；（3）设置GPIO_InitStructure.GPIO_Mode为GPIO_Mode_IPU，表示：没有按键按下时，引脚的电平为高，当按键抬起时，电平为低，并进行输入。（4）调用GPIO_Init函数，将GPIO_InitStructure的参数传递给GPIOE，完成对KEY0和KEY1的初始化。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// key.c</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">KEY_Init</span><span class="params">(<span class="type">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123; </span><br><span class="line">    ...</span><br><span class="line"> 	<span class="built_in">RCC_APB2PeriphClockCmd</span>(RCC_APB2Periph_GPIOA|RCC_APB2Periph_GPIOE,ENABLE);</span><br><span class="line">	GPIO_InitStructure.GPIO_Pin  = GPIO_Pin_4|GPIO_Pin_3;</span><br><span class="line">	GPIO_InitStructure.GPIO_Mode = GPIO_Mode_IPU;</span><br><span class="line"> 	<span class="built_in">GPIO_Init</span>(GPIOE, &amp;GPIO_InitStructure);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&emsp;对于LCD屏幕的初始化，其逻辑如下：（1）使能FSMC时钟，因为LCD屏幕要通过FSMC接口与STM32通信；（2）使能GPIOB、GPIOD、GPIOE、GPIOG的时钟，因为LCD屏幕的数据线和控制线要用到这些端口；（3）配置PB0为推挽输出，用于控制LCD屏幕的背光；（4）配置PD0、PD1、PD4、PD5、PD8、PD9、PD10、PD14、PD15为复用推挽输出，用于连接FSMC的数据线和地址线；配置PE7~PE15为复用推挽输出，用于连接FSMC的数据线；配置PG0和PG12为复用推挽输出，用于连接FSMC的RS和NE4信号；（5）配置FSMC的各种参数，例如读写时序、存储器类型等。（6）初始化FSMC。</p>
<p>&emsp;之后，使用FSMC接口向LCD屏幕发送初始化指令和数据。例如，0x11是退出睡眠模式的指令，0x36是设置内存访问控制的指令，0x3A是设置像素格式的指令等。初始化代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line">LCD_WR_REG(0x11);</span><br><span class="line"></span><br><span class="line">delay_ms(120);</span><br><span class="line"></span><br><span class="line">LCD_WR_REG(0x36);</span><br><span class="line">LCD_WR_DATA(0x00);</span><br><span class="line"></span><br><span class="line">LCD_WR_REG(0x3A);</span><br><span class="line">LCD_WR_DATA(0X05);</span><br><span class="line"></span><br><span class="line">LCD_WR_REG(0xB2);</span><br><span class="line">LCD_WR_DATA(0x0C);</span><br><span class="line">LCD_WR_DATA(0x0C);</span><br><span class="line">LCD_WR_DATA(0x00);</span><br><span class="line">LCD_WR_DATA(0x33);</span><br><span class="line">LCD_WR_DATA(0x33);</span><br><span class="line"></span><br><span class="line">LCD_WR_REG(0xB7);</span><br><span class="line">LCD_WR_DATA(0x35);</span><br><span class="line"></span><br><span class="line">LCD_WR_REG(0xBB);       //vcom</span><br><span class="line">LCD_WR_DATA(0x32);      //30</span><br><span class="line"></span><br><span class="line">LCD_WR_REG(0xC0);</span><br><span class="line">LCD_WR_DATA(0x0C);</span><br><span class="line"></span><br><span class="line">LCD_WR_REG(0xC2);</span><br><span class="line">LCD_WR_DATA(0x01);</span><br><span class="line"></span><br><span class="line">LCD_WR_REG(0xC3);       //vrh</span><br><span class="line">LCD_WR_DATA(0x10);      //17 0D</span><br><span class="line"></span><br><span class="line">LCD_WR_REG(0xC4);       //vdv</span><br><span class="line">LCD_WR_DATA(0x20);      //20</span><br><span class="line"></span><br><span class="line">LCD_WR_REG(0xC6);</span><br><span class="line">LCD_WR_DATA(0x0f);</span><br><span class="line"></span><br><span class="line">LCD_WR_REG(0xD0);</span><br><span class="line">LCD_WR_DATA(0xA4);</span><br><span class="line">LCD_WR_DATA(0xA1);</span><br><span class="line"></span><br><span class="line">LCD_WR_REG(0xE0);       //Set Gamma</span><br><span class="line">LCD_WR_DATA(0xd0);</span><br><span class="line">LCD_WR_DATA(0x00);</span><br><span class="line">LCD_WR_DATA(0x02);</span><br><span class="line">LCD_WR_DATA(0x07);</span><br><span class="line">LCD_WR_DATA(0x0a);</span><br><span class="line">LCD_WR_DATA(0x28);</span><br><span class="line">LCD_WR_DATA(0x32);</span><br><span class="line">LCD_WR_DATA(0X44);</span><br><span class="line">LCD_WR_DATA(0x42);</span><br><span class="line">LCD_WR_DATA(0x06);</span><br><span class="line">LCD_WR_DATA(0x0e);</span><br><span class="line">LCD_WR_DATA(0x12);</span><br><span class="line">LCD_WR_DATA(0x14);</span><br><span class="line">LCD_WR_DATA(0x17);</span><br><span class="line"></span><br><span class="line">LCD_WR_REG(0XE1);       //Set Gamma</span><br><span class="line">LCD_WR_DATA(0xd0);</span><br><span class="line">LCD_WR_DATA(0x00);</span><br><span class="line">LCD_WR_DATA(0x02);</span><br><span class="line">LCD_WR_DATA(0x07);</span><br><span class="line">LCD_WR_DATA(0x0a);</span><br><span class="line">LCD_WR_DATA(0x28);</span><br><span class="line">LCD_WR_DATA(0x31);</span><br><span class="line">LCD_WR_DATA(0x54);</span><br><span class="line">LCD_WR_DATA(0x47);</span><br><span class="line">LCD_WR_DATA(0x0e);</span><br><span class="line">LCD_WR_DATA(0x1c);</span><br><span class="line">LCD_WR_DATA(0x17);</span><br><span class="line">LCD_WR_DATA(0x1b);</span><br><span class="line">LCD_WR_DATA(0x1e);</span><br><span class="line"></span><br><span class="line">LCD_WR_REG(0x2A);</span><br><span class="line">LCD_WR_DATA(0x00);</span><br><span class="line">LCD_WR_DATA(0x00);</span><br><span class="line">LCD_WR_DATA(0x00);</span><br><span class="line">LCD_WR_DATA(0xef);</span><br><span class="line"></span><br><span class="line">LCD_WR_REG(0x2B);</span><br><span class="line">LCD_WR_DATA(0x00);</span><br><span class="line">LCD_WR_DATA(0x00);</span><br><span class="line">LCD_WR_DATA(0x01);</span><br><span class="line">LCD_WR_DATA(0x3f);</span><br><span class="line"></span><br><span class="line">LCD_WR_REG(0x29);       //display on</span><br></pre></td></tr></table></figure>
<p>&emsp;补充：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1. FSMC（灵活静态存储器控制器：Flexible Static Memory Controller）是STM32的一个外设，可以让STM32通过FSMC与SRAM、ROM等存储器相连，从而进行数据的交换。</span><br><span class="line">2. PB0是STM32的一个GPIO引脚，可以用于控制LCD屏幕的背光。LCD屏幕的背光是指LCD屏幕后面的一层发光材料，可以提高LCD屏幕的亮度和对比度。</span><br><span class="line">3. RS是一个控制信号，用于选择命令或数据。NE4是一个片选信号，用于选择第4个NOR/PSRAM设备。这样，就可以通过不同的地址来控制LCD的读写操作。NOR/PSRAM设备是指使用FSMC接口的NOR Flash或PSRAM存储器。NOR Flash是一种非易失性的闪存存储器，可以随机访问任意地址的数据，适合用于存储程序代码。PSRAM是一种伪静态随机存取器，可以实现较大的存储容量和较低的功耗。</span><br></pre></td></tr></table></figure>
<h3 id="摄像头初始化"><a href="#摄像头初始化" class="headerlink" title="摄像头初始化"></a>摄像头初始化</h3><p>&emsp;初始化步骤如下：（1）配置GPIO的时钟、模式等相关的端口时钟，设置PA8为输入上拉，PB3和PB4为推挽输出，PC0~7为输入上拉，PD6、PG14和PG15为推挽输出，禁用JTAG功能；（2）调用SCCB_Init函数初始化SCCB的IO口；（3）调用SCCB_Init函数初始化SCCB的IO口，SCCB是一种串行通信协议，用于控制摄像头的寄存器；（4）判断摄像头ID；（5）遍历camera_init_reg_tb1数组，向摄像头写入一系列的初始化指令和数据。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">u8 <span class="title">CAMERA_Init</span><span class="params">(<span class="type">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	...</span><br><span class="line">    <span class="comment">//使能相关端口时钟</span></span><br><span class="line">    <span class="built_in">RCC_APB2PeriphClockCmd</span>(RCC_APB2Periph_GPIOA|...|RCC_APB2Periph_AFIO, ENABLE);</span><br><span class="line">    <span class="comment">//设置PA8为输入上拉</span></span><br><span class="line">	GPIO_InitStructure.GPIO_Pin  = GPIO_Pin_8;</span><br><span class="line">	GPIO_InitStructure.GPIO_Mode = GPIO_Mode_IPU;</span><br><span class="line">	GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;</span><br><span class="line"> 	<span class="built_in">GPIO_Init</span>(GPIOA, &amp;GPIO_InitStructure);</span><br><span class="line">	<span class="built_in">GPIO_SetBits</span>(GPIOA,GPIO_Pin_8);</span><br><span class="line">	<span class="comment">//设置PB3和PB4为推挽输出</span></span><br><span class="line"> 	GPIO_InitStructure.GPIO_Pin = GPIO_Pin_3|GPIO_Pin_4;</span><br><span class="line"> 	GPIO_InitStructure.GPIO_Mode = GPIO_Mode_Out_PP; </span><br><span class="line"> 	<span class="built_in">GPIO_Init</span>(GPIOB, &amp;GPIO_InitStructure);</span><br><span class="line"> 	<span class="built_in">GPIO_SetBits</span>(GPIOB,GPIO_Pin_3|GPIO_Pin_4);	</span><br><span class="line">	<span class="comment">//设置PC0~7为输入上拉</span></span><br><span class="line">	GPIO_InitStructure.GPIO_Pin  = <span class="number">0xff</span>; </span><br><span class="line">	GPIO_InitStructure.GPIO_Mode = GPIO_Mode_IPU;</span><br><span class="line"> 	<span class="built_in">GPIO_Init</span>(GPIOC, &amp;GPIO_InitStructure);</span><br><span class="line">	<span class="comment">//设置PD6、PG14和PG15为推挽输出</span></span><br><span class="line">	GPIO_InitStructure.GPIO_Pin  = GPIO_Pin_6;  </span><br><span class="line">	GPIO_InitStructure.GPIO_Mode = GPIO_Mode_Out_PP;</span><br><span class="line"> 	<span class="built_in">GPIO_Init</span>(GPIOD, &amp;GPIO_InitStructure);</span><br><span class="line">	<span class="built_in">GPIO_SetBits</span>(GPIOD,GPIO_Pin_6);</span><br><span class="line">	GPIO_InitStructure.GPIO_Pin  = GPIO_Pin_14|GPIO_Pin_15;  </span><br><span class="line">	GPIO_InitStructure.GPIO_Mode = GPIO_Mode_Out_PP;</span><br><span class="line"> 	<span class="built_in">GPIO_Init</span>(GPIOG, &amp;GPIO_InitStructure);</span><br><span class="line">	<span class="built_in">GPIO_SetBits</span>(GPIOG,GPIO_Pin_14|GPIO_Pin_15);</span><br><span class="line">	<span class="comment">//禁用JTAG</span></span><br><span class="line">	<span class="built_in">GPIO_PinRemapConfig</span>(GPIO_Remap_SWJ_JTAGDisable,ENABLE);</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//初始化SCCB的IO口	</span></span><br><span class="line">	<span class="built_in">SCCB_Init</span>();      </span><br><span class="line">    <span class="comment">//软复位</span></span><br><span class="line"> 	<span class="keyword">if</span>(<span class="built_in">SCCB_WR_Reg</span>(<span class="number">0x12</span>,<span class="number">0x80</span>))</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">	<span class="built_in">delay_ms</span>(<span class="number">50</span>); </span><br><span class="line">    <span class="comment">//判断制造商ID：MID</span></span><br><span class="line">	reg=<span class="built_in">SCCB_RD_Reg</span>(<span class="number">0X1c</span>);</span><br><span class="line">	reg&lt;&lt;=<span class="number">8</span>;</span><br><span class="line">	reg|=<span class="built_in">SCCB_RD_Reg</span>(<span class="number">0X1d</span>);</span><br><span class="line">	<span class="keyword">if</span>(reg!=CAMERA_MID)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;MID:%d\r\n&quot;</span>,reg);</span><br><span class="line">		<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">    <span class="comment">//判断产品ID：PID</span></span><br><span class="line">	reg=<span class="built_in">SCCB_RD_Reg</span>(<span class="number">0X0a</span>);</span><br><span class="line">	reg&lt;&lt;=<span class="number">8</span>;</span><br><span class="line">	reg|=<span class="built_in">SCCB_RD_Reg</span>(<span class="number">0X0b</span>);</span><br><span class="line">	<span class="keyword">if</span>(reg!=CAMERA_PID)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;HID:%d\r\n&quot;</span>,reg);</span><br><span class="line">		<span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">	&#125;   </span><br><span class="line"> 	<span class="comment">//初始化摄像头</span></span><br><span class="line">	<span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="built_in">sizeof</span>(camera_init_reg_tb1)/<span class="built_in">sizeof</span>(camera_init_reg_tb1[<span class="number">0</span>]);i++)</span><br><span class="line">	&#123;								</span><br><span class="line">	   	<span class="built_in">SCCB_WR_Reg</span>(camera_init_reg_tb1[i][<span class="number">0</span>],camera_init_reg_tb1[i][<span class="number">1</span>]);</span><br><span class="line"> 	&#125; </span><br><span class="line">  	<span class="keyword">return</span> <span class="number">0x00</span>;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<p>补充：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1. JTAG|SWD是调试嵌入式系统的接口协议：</span><br><span class="line">	a. JTAG（Joint Test Action Group）需要至少四根信号线：TMS（模式选择）、TCK（时钟）、TDI（数据输入）和TDO（数据输出）。JTAG接口的优点是兼容性好，支持多种设备和协议，缺点是占用的引脚较多，速度较慢。</span><br><span class="line">	b. SWD（Serial Wire Debugging）是为了简化和优化JTAG接口而设计的，只需要两根信号线：SWDIO（数据输入输出）和SWCLK（时钟）。</span><br><span class="line">2. SCCB是一种串行通信协议，用于控制摄像头的寄存器。</span><br><span class="line">3. 寄存器版本与HAL库版本：</span><br><span class="line">	a. 直接操作STM32的寄存器，需要对寄存器的地址、位域、功能等有较深入的了解，编程难度较高，但是性能较好，代码量较小，可移植性较差。</span><br><span class="line">	b. HAL库版本是使用ST提供的硬件抽象层库，对寄存器进行了封装，提供了统一的API接口，编程难度较低，但是性能较差，代码量较大，可移植性较好。</span><br></pre></td></tr></table></figure>
<h2 id="0x03-摄像头相关函数"><a href="#0x03-摄像头相关函数" class="headerlink" title="0x03 摄像头相关函数"></a>0x03 摄像头相关函数</h2><h4 id="设置Camera，以VGA模式输出图像："><a href="#设置Camera，以VGA模式输出图像：" class="headerlink" title="设置Camera，以VGA模式输出图像："></a>设置Camera，以VGA模式输出图像：</h4><p>&emsp;设置摄像头的窗口大小和位置，并以VGA模式（640x480）输出图像。函数逻辑为：（1）设置摄像头为VGA模式，并设置水平和垂直的起始位置和尺寸为640x480；（2）根据width和height的值，计算窗口的水平和垂直的偏移量sx和sy；（3）修改摄像头的寄存器HSTART、HSIZE、VSTRT、VSIZE、HREF、HOutSize、VOutSize、EXHCH，将窗口的位置和尺寸写入寄存器中。相关代码如下：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// camera.c</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">camera_Window_Set</span><span class="params">(u16 width,u16 height)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	...</span><br><span class="line">    sx=(<span class="number">640</span>-width)/<span class="number">2</span>;</span><br><span class="line">    sy=(<span class="number">480</span>-height)/<span class="number">2</span>;</span><br><span class="line">    <span class="built_in">SCCB_WR_Reg</span>(COM7,<span class="number">0x06</span>);		<span class="comment">//设置为VGA模式</span></span><br><span class="line">    <span class="built_in">SCCB_WR_Reg</span>(HSTART,<span class="number">0x23</span>); 	<span class="comment">//水平起始位置</span></span><br><span class="line">    <span class="built_in">SCCB_WR_Reg</span>(HSIZE,<span class="number">0xA0</span>); 	<span class="comment">//水平尺寸</span></span><br><span class="line">    <span class="built_in">SCCB_WR_Reg</span>(VSTRT,<span class="number">0x07</span>); 	<span class="comment">//垂直起始位置</span></span><br><span class="line">    <span class="built_in">SCCB_WR_Reg</span>(VSIZE,<span class="number">0xF0</span>); 	<span class="comment">//垂直尺寸</span></span><br><span class="line">    <span class="built_in">SCCB_WR_Reg</span>(HREF,<span class="number">0x00</span>);</span><br><span class="line">    <span class="built_in">SCCB_WR_Reg</span>(HOutSize,<span class="number">0xA0</span>); <span class="comment">//输出尺寸</span></span><br><span class="line">    <span class="built_in">SCCB_WR_Reg</span>(VOutSize,<span class="number">0xF0</span>); <span class="comment">//输出尺寸</span></span><br><span class="line">	<span class="comment">//设置HSTART、VSTRT、HREF、HOutSize、VOutSize、EXHCH寄存器</span></span><br><span class="line">	raw=<span class="built_in">SCCB_RD_Reg</span>(HSTART);</span><br><span class="line">	temp=raw+(sx&gt;&gt;<span class="number">2</span>);</span><br><span class="line">	<span class="built_in">SCCB_WR_Reg</span>(HSTART,temp);</span><br><span class="line">	<span class="built_in">SCCB_WR_Reg</span>(HSIZE,width&gt;&gt;<span class="number">2</span>);</span><br><span class="line">	raw=<span class="built_in">SCCB_RD_Reg</span>(VSTRT);</span><br><span class="line">	temp=raw+(sy&gt;&gt;<span class="number">1</span>);</span><br><span class="line">	<span class="built_in">SCCB_WR_Reg</span>(VSTRT,temp);</span><br><span class="line">	<span class="built_in">SCCB_WR_Reg</span>(VSIZE,height&gt;&gt;<span class="number">1</span>);</span><br><span class="line">	raw=<span class="built_in">SCCB_RD_Reg</span>(HREF);</span><br><span class="line">	temp=((sy&amp;<span class="number">0x01</span>)&lt;&lt;<span class="number">6</span>)|((sx&amp;<span class="number">0x03</span>)&lt;&lt;<span class="number">4</span>)|((height&amp;<span class="number">0x01</span>)&lt;&lt;<span class="number">2</span>)|(width&amp;<span class="number">0x03</span>)|raw;</span><br><span class="line">	<span class="built_in">SCCB_WR_Reg</span>(HREF,temp);</span><br><span class="line">	<span class="built_in">SCCB_WR_Reg</span>(HOutSize,width&gt;&gt;<span class="number">2</span>);</span><br><span class="line">	<span class="built_in">SCCB_WR_Reg</span>(VOutSize,height&gt;&gt;<span class="number">1</span>);</span><br><span class="line">	<span class="built_in">SCCB_RD_Reg</span>(EXHCH);	</span><br><span class="line">	temp = (raw|(width&amp;<span class="number">0x03</span>)|((height&amp;<span class="number">0x01</span>)&lt;&lt;<span class="number">2</span>));	</span><br><span class="line">	<span class="built_in">SCCB_WR_Reg</span>(EXHCH,temp);	</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// sccb.c</span></span><br><span class="line"><span class="comment">// 写寄存器</span></span><br><span class="line"><span class="function">u8 <span class="title">SCCB_WR_Reg</span><span class="params">(u8 reg,u8 data)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	u8 res=<span class="number">0</span>;</span><br><span class="line">	<span class="built_in">SCCB_Start</span>(); 				</span><br><span class="line">	<span class="keyword">if</span>(<span class="built_in">SCCB_WR_Byte</span>(SCCB_ID))res=<span class="number">1</span>;</span><br><span class="line">	<span class="built_in">delay_us</span>(<span class="number">100</span>);</span><br><span class="line">  	<span class="keyword">if</span>(<span class="built_in">SCCB_WR_Byte</span>(reg))res=<span class="number">1</span>;		  </span><br><span class="line">	<span class="built_in">delay_us</span>(<span class="number">100</span>);</span><br><span class="line">  	<span class="keyword">if</span>(<span class="built_in">SCCB_WR_Byte</span>(data))res=<span class="number">1</span>; 	 </span><br><span class="line">  	<span class="built_in">SCCB_Stop</span>();	  </span><br><span class="line">  	<span class="keyword">return</span>	res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 读寄存器</span></span><br><span class="line"><span class="function">u8 <span class="title">SCCB_RD_Reg</span><span class="params">(u8 reg)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	u8 val=<span class="number">0</span>;</span><br><span class="line">	<span class="built_in">SCCB_Start</span>(); 		</span><br><span class="line">	<span class="built_in">SCCB_WR_Byte</span>(SCCB_ID);	 </span><br><span class="line">	<span class="built_in">delay_us</span>(<span class="number">100</span>);	 </span><br><span class="line">  	<span class="built_in">SCCB_WR_Byte</span>(reg);	  </span><br><span class="line">	<span class="built_in">delay_us</span>(<span class="number">100</span>);	  </span><br><span class="line">	<span class="built_in">SCCB_Stop</span>();   </span><br><span class="line">	<span class="built_in">delay_us</span>(<span class="number">100</span>);	   </span><br><span class="line"></span><br><span class="line">	<span class="built_in">SCCB_Start</span>();</span><br><span class="line">	<span class="built_in">SCCB_WR_Byte</span>(SCCB_ID|<span class="number">0X01</span>);</span><br><span class="line">	<span class="built_in">delay_us</span>(<span class="number">100</span>);</span><br><span class="line">  	val=<span class="built_in">SCCB_RD_Byte</span>();	</span><br><span class="line">  	<span class="built_in">SCCB_No_Ack</span>();</span><br><span class="line">  	<span class="built_in">SCCB_Stop</span>();</span><br><span class="line">  	<span class="keyword">return</span> val;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="设置Camera画面风格"><a href="#设置Camera画面风格" class="headerlink" title="设置Camera画面风格"></a>设置Camera画面风格</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">camera_Light_Mode</span><span class="params">(u8 mode)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">switch</span>(mode)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">0</span>:	<span class="comment">//Auto，自动模式</span></span><br><span class="line">			<span class="built_in">SCCB_WR_Reg</span>(<span class="number">0x13</span>, <span class="number">0xff</span>);</span><br><span class="line">			<span class="built_in">SCCB_WR_Reg</span>(<span class="number">0x0e</span>, <span class="number">0x65</span>);</span><br><span class="line">			<span class="built_in">SCCB_WR_Reg</span>(<span class="number">0x2d</span>, <span class="number">0x00</span>);</span><br><span class="line">			<span class="built_in">SCCB_WR_Reg</span>(<span class="number">0x2e</span>, <span class="number">0x00</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">1</span>:<span class="comment">//sunny，晴天</span></span><br><span class="line">			<span class="built_in">SCCB_WR_Reg</span>(<span class="number">0x13</span>, <span class="number">0xfd</span>);</span><br><span class="line">			<span class="built_in">SCCB_WR_Reg</span>(<span class="number">0x01</span>, <span class="number">0x5a</span>);</span><br><span class="line">			<span class="built_in">SCCB_WR_Reg</span>(<span class="number">0x02</span>, <span class="number">0x5c</span>);</span><br><span class="line">			<span class="built_in">SCCB_WR_Reg</span>(<span class="number">0x0e</span>, <span class="number">0x65</span>);</span><br><span class="line">			<span class="built_in">SCCB_WR_Reg</span>(<span class="number">0x2d</span>, <span class="number">0x00</span>);</span><br><span class="line">			<span class="built_in">SCCB_WR_Reg</span>(<span class="number">0x2e</span>, <span class="number">0x00</span>);</span><br><span class="line">			<span class="keyword">break</span>;	</span><br><span class="line">		<span class="keyword">case</span> <span class="number">2</span>:<span class="comment">//cloudy，多云</span></span><br><span class="line">			<span class="built_in">SCCB_WR_Reg</span>(<span class="number">0x13</span>, <span class="number">0xfd</span>);</span><br><span class="line">			<span class="built_in">SCCB_WR_Reg</span>(<span class="number">0x01</span>, <span class="number">0x58</span>);</span><br><span class="line">			<span class="built_in">SCCB_WR_Reg</span>(<span class="number">0x02</span>, <span class="number">0x60</span>);</span><br><span class="line">			<span class="built_in">SCCB_WR_Reg</span>(<span class="number">0x0e</span>, <span class="number">0x65</span>);</span><br><span class="line">			<span class="built_in">SCCB_WR_Reg</span>(<span class="number">0x2d</span>, <span class="number">0x00</span>);</span><br><span class="line">			<span class="built_in">SCCB_WR_Reg</span>(<span class="number">0x2e</span>, <span class="number">0x00</span>);</span><br><span class="line">			<span class="keyword">break</span>;	</span><br><span class="line">		<span class="keyword">case</span> <span class="number">3</span>:<span class="comment">//office，办公室</span></span><br><span class="line">			<span class="built_in">SCCB_WR_Reg</span>(<span class="number">0x13</span>, <span class="number">0xfd</span>);</span><br><span class="line">			<span class="built_in">SCCB_WR_Reg</span>(<span class="number">0x01</span>, <span class="number">0x84</span>);</span><br><span class="line">			<span class="built_in">SCCB_WR_Reg</span>(<span class="number">0x02</span>, <span class="number">0x4c</span>);</span><br><span class="line">			<span class="built_in">SCCB_WR_Reg</span>(<span class="number">0x0e</span>, <span class="number">0x65</span>);</span><br><span class="line">			<span class="built_in">SCCB_WR_Reg</span>(<span class="number">0x2d</span>, <span class="number">0x00</span>);</span><br><span class="line">			<span class="built_in">SCCB_WR_Reg</span>(<span class="number">0x2e</span>, <span class="number">0x00</span>);</span><br><span class="line">			<span class="keyword">break</span>;	</span><br><span class="line">		<span class="keyword">case</span> <span class="number">4</span>:<span class="comment">//home，家里</span></span><br><span class="line">			<span class="built_in">SCCB_WR_Reg</span>(<span class="number">0x13</span>, <span class="number">0xfd</span>);</span><br><span class="line">			<span class="built_in">SCCB_WR_Reg</span>(<span class="number">0x01</span>, <span class="number">0x96</span>);</span><br><span class="line">			<span class="built_in">SCCB_WR_Reg</span>(<span class="number">0x02</span>, <span class="number">0x40</span>);</span><br><span class="line">			<span class="built_in">SCCB_WR_Reg</span>(<span class="number">0x0e</span>, <span class="number">0x65</span>);</span><br><span class="line">			<span class="built_in">SCCB_WR_Reg</span>(<span class="number">0x2d</span>, <span class="number">0x00</span>);</span><br><span class="line">			<span class="built_in">SCCB_WR_Reg</span>(<span class="number">0x2e</span>, <span class="number">0x00</span>);</span><br><span class="line">			<span class="keyword">break</span>;	</span><br><span class="line"></span><br><span class="line">		<span class="keyword">case</span> <span class="number">5</span>:<span class="comment">//night，夜晚</span></span><br><span class="line">			<span class="built_in">SCCB_WR_Reg</span>(<span class="number">0x13</span>, <span class="number">0xff</span>);</span><br><span class="line">			<span class="built_in">SCCB_WR_Reg</span>(<span class="number">0x0e</span>, <span class="number">0xe5</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="0x04-LCD相关函数"><a href="#0x04-LCD相关函数" class="headerlink" title="0x04 LCD相关函数"></a>0x04 LCD相关函数</h2><h4 id="LCD输出字符串："><a href="#LCD输出字符串：" class="headerlink" title="LCD输出字符串："></a>LCD输出字符串：</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// lcd.c</span></span><br><span class="line"><span class="comment">// 参数介绍：</span></span><br><span class="line"><span class="comment">// （1）x,y:起点坐标</span></span><br><span class="line"><span class="comment">// （2）width,height:区域大小</span></span><br><span class="line"><span class="comment">// （3）size:字体大小</span></span><br><span class="line"><span class="comment">// （4）*p:字符串起始地址</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">LCD_ShowString</span><span class="params">(u16 x, u16 y, u16 width, u16 height, u8 size, u8 *p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    u8 x0 = x;</span><br><span class="line">    width += x;</span><br><span class="line">    height += y;</span><br><span class="line">    <span class="keyword">while</span> True:</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (x &gt;= width)</span><br><span class="line">        &#123;</span><br><span class="line">            x = x0;</span><br><span class="line">            y += size;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (y &gt;= height)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="built_in">LCD_ShowChar</span>(x, y, *p, size, <span class="number">0</span>);</span><br><span class="line">        x += size / <span class="number">2</span>;</span><br><span class="line">        p++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 画字符</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">LCD_ShowChar</span><span class="params">(u16 x, u16 y, u8 num, u8 size, u8 mode)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    u8 temp, t1, t;</span><br><span class="line">    u16 y0 = y;</span><br><span class="line">    u8 csize = (size / <span class="number">8</span> + ((size % <span class="number">8</span>) ? <span class="number">1</span> : <span class="number">0</span>)) * (size / <span class="number">2</span>);  <span class="comment">//得到字体一个字符对应点阵集所占的字节数</span></span><br><span class="line">    num = num - <span class="string">&#x27; &#x27;</span>;    <span class="comment">//得到偏移后的值（ASCII字库是从空格开始取模，所以-&#x27; &#x27;就是对应字符的字库）</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (t = <span class="number">0</span>; t &lt; csize; t++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (size == <span class="number">16</span>)</span><br><span class="line">            temp = asc2_1608[num][t];   <span class="comment">//调用1608字体</span></span><br><span class="line">        <span class="keyword">else</span> </span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (t1 = <span class="number">0</span>; t1 &lt; <span class="number">8</span>; t1++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (temp &amp; <span class="number">0x80</span>)</span><br><span class="line">                <span class="built_in">LCD_Fast_DrawPoint</span>(x, y, POINT_COLOR);</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (mode == <span class="number">0</span>)</span><br><span class="line">                <span class="built_in">LCD_Fast_DrawPoint</span>(x, y, BACK_COLOR);</span><br><span class="line">            temp &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">            y++;</span><br><span class="line">            <span class="keyword">if</span> ((y - y0) == size)</span><br><span class="line">            &#123;</span><br><span class="line">                y = y0;</span><br><span class="line">                x++;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 画点</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">LCD_Fast_DrawPoint</span><span class="params">(u16 x, u16 y, u16 color)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">LCD_WR_REG</span>(lcddev.setxcmd);</span><br><span class="line">    <span class="built_in">LCD_WR_DATA</span>(x &gt;&gt; <span class="number">8</span>);</span><br><span class="line">    <span class="built_in">LCD_WR_DATA</span>(x &amp; <span class="number">0XFF</span>);</span><br><span class="line">    <span class="built_in">LCD_WR_REG</span>(lcddev.setycmd);</span><br><span class="line">    <span class="built_in">LCD_WR_DATA</span>(y &gt;&gt; <span class="number">8</span>);</span><br><span class="line">    <span class="built_in">LCD_WR_DATA</span>(y &amp; <span class="number">0XFF</span>);</span><br><span class="line"></span><br><span class="line">    LCD-&gt;LCD_REG=lcddev.wramcmd; </span><br><span class="line">    LCD-&gt;LCD_RAM=color; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="LCD屏幕填充颜色："><a href="#LCD屏幕填充颜色：" class="headerlink" title="LCD屏幕填充颜色："></a>LCD屏幕填充颜色：</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//lcd.c</span></span><br><span class="line"><span class="comment">// 参数介绍：</span></span><br><span class="line"><span class="comment">//（1）区域大小:(ex-sx+1)*(ey-sy+1)</span></span><br><span class="line"><span class="comment">//（2）color:要填充的颜色</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">LCD_Fill</span><span class="params">(u16 sx, u16 sy, u16 ex, u16 ey, u16 color)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    u16 i, j;</span><br><span class="line">    u16 xlen = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    xlen = ex - sx + <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (i = sy; i &lt;= ey; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">LCD_SetCursor</span>(sx, i);       <span class="comment">//设置光标位置</span></span><br><span class="line">        <span class="built_in">LCD_WriteRAM_Prepare</span>();     <span class="comment">//开始写入GRAM</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; xlen; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            LCD-&gt;LCD_RAM=color;     <span class="comment">//设置光标位置</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="0x05-按键相关函数"><a href="#0x05-按键相关函数" class="headerlink" title="0x05 按键相关函数"></a>0x05 按键相关函数</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//key.c</span></span><br><span class="line"><span class="comment">//按键处理函数</span></span><br><span class="line"><span class="comment">//0.没有任何按键按下</span></span><br><span class="line"><span class="comment">//1.KEY0按下</span></span><br><span class="line"><span class="comment">//2.KEY1按下</span></span><br><span class="line"><span class="function">u8 <span class="title">KEY_Scan</span><span class="params">(u8 mode)</span></span></span><br><span class="line"><span class="function"></span>&#123;	 </span><br><span class="line">	<span class="type">static</span> u8 key_up=<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">if</span>(mode)</span><br><span class="line">        key_up=<span class="number">1</span>;	  </span><br><span class="line">	<span class="keyword">if</span>(key_up&amp;&amp;(KEY0==<span class="number">0</span>||KEY1==<span class="number">0</span>))&#123;</span><br><span class="line">		key_up=<span class="number">0</span>;</span><br><span class="line">		<span class="keyword">if</span>(KEY0==<span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> KEY0_PRES;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span>(KEY1==<span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> KEY1_PRES;</span><br><span class="line">	&#125;<span class="keyword">else</span> <span class="keyword">if</span>(KEY0==<span class="number">1</span>&amp;&amp;KEY1==<span class="number">1</span>)</span><br><span class="line">        key_up=<span class="number">1</span>;</span><br><span class="line"> 	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="0x06-main函数"><a href="#0x06-main函数" class="headerlink" title="0x06 main函数"></a>0x06 main函数</h2><p>&emsp;其中，camera_refresh的逻辑为：（1）判断ov_sta变量是否为真，如果为真，表示有帧中断发生，即摄像头采集到了一帧图像；（2）设置LCD的扫描方向为从上到下，从左到右；（3）设置LCD的显示窗口为屏幕中央的一块区域，大小为CAMARA_WINDOW_WIDTH x CAMARA_WINDOW_HEIGHT；（4）准备写入LCD的GRAM（图形存储器）；（5）复位摄像头的读指针，使其指向第一个像素数据；（6）用双层循环遍历摄像头的每个像素，每次读取两个字节（16位）的数据，即一个像素的颜色值；（7）将读取到的颜色值写入LCD的GRAM中，显示在对应的位置上；（8）清零ov_sta变量，表示帧中断已经处理完毕；（9）恢复LCD的默认扫描方向。</p>
<p>&emsp;最终实验的展示效果为：</p>
<p>（1）屏幕首先输出”wd2711’s camera exp”。</p>
<p>（2）如果摄像头正常进行初始化，那么输出”camera init success”，并闪烁输出”press key1 to start”。</p>
<p>（3）按下key1按键，之后进入摄像头画面，画面为VGA格式。</p>
<p>（4）按下key0，可以改变画面风格，一共有6种风格。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;delay.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;key.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;sys.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;lcd.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;usart.h&quot;</span>	 </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;string.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;camera.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;timer.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;exti.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;usmart.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>  CAMERA 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义高度与宽度</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>  CAMARA_WINDOW_WIDTH		320 <span class="comment">// &lt;=320</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>  CAMARA_WINDOW_HEIGHT		240 <span class="comment">// &lt;=240</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">u8 *LMODE_TBL[<span class="number">6</span>]=&#123;<span class="string">&quot;Auto&quot;</span>,<span class="string">&quot;Sunny&quot;</span>,<span class="string">&quot;Cloudy&quot;</span>,<span class="string">&quot;Office&quot;</span>,<span class="string">&quot;Home&quot;</span>,<span class="string">&quot;Night&quot;</span>&#125;;<span class="comment">//6种画面风格    </span></span><br><span class="line"><span class="keyword">extern</span> u8 ov_sta;	<span class="comment">//在exit.c里定义</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//更新LCD显示</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">camera_refresh</span><span class="params">(<span class="type">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	u32 i,j;</span><br><span class="line"> 	u16 color;	 </span><br><span class="line">	<span class="keyword">if</span>(ov_sta) <span class="comment">//有帧中断</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">LCD_Scan_Dir</span>(U2D_L2R);		<span class="comment">//从上到下,从左到右</span></span><br><span class="line">		<span class="built_in">LCD_Set_Window</span>((lcddev.width-CAMARA_WINDOW_WIDTH)/<span class="number">2</span>,(lcddev.height-CAMARA_WINDOW_HEIGHT)/<span class="number">2</span>,CAMARA_WINDOW_WIDTH,CAMARA_WINDOW_HEIGHT);<span class="comment">//将显示区域设置到屏幕中央</span></span><br><span class="line">		<span class="built_in">LCD_WriteRAM_Prepare</span>();      <span class="comment">//开始写入GRAM	</span></span><br><span class="line">		CAMERA_RRST=<span class="number">0</span>;				<span class="comment">//开始复位读指针 </span></span><br><span class="line">		CAMERA_RCK_L;</span><br><span class="line">		CAMERA_RCK_H;</span><br><span class="line">		CAMERA_RCK_L;</span><br><span class="line">		CAMERA_RRST=<span class="number">1</span>;				<span class="comment">//复位读指针结束 </span></span><br><span class="line">		CAMERA_RCK_H; </span><br><span class="line">		<span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;CAMARA_WINDOW_HEIGHT;i++)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">for</span>(j=<span class="number">0</span>;j&lt;CAMARA_WINDOW_WIDTH;j++)</span><br><span class="line">			&#123;</span><br><span class="line">				CAMERA_RCK_L;</span><br><span class="line">				color=GPIOC-&gt;IDR&amp;<span class="number">0XFF</span>;	<span class="comment">//读数据</span></span><br><span class="line">				CAMERA_RCK_H; </span><br><span class="line">				color&lt;&lt;=<span class="number">8</span>;  </span><br><span class="line">				CAMERA_RCK_L;</span><br><span class="line">				color|=GPIOC-&gt;IDR&amp;<span class="number">0XFF</span>;	<span class="comment">//读数据</span></span><br><span class="line">				CAMERA_RCK_H; </span><br><span class="line">				LCD-&gt;LCD_RAM=color;  </span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"> 		ov_sta=<span class="number">0</span>;				   <span class="comment">//清零帧中断标记</span></span><br><span class="line">		<span class="built_in">LCD_Scan_Dir</span>(DFT_SCAN_DIR);	<span class="comment">//恢复默认扫描方向 </span></span><br><span class="line">	&#125; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	u8 key;  </span><br><span class="line">	u8 i=<span class="number">0</span>;</span><br><span class="line">	u8 lightmode=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">delay_init</span>();	    	 <span class="comment">//延时函数初始化	  </span></span><br><span class="line">	<span class="built_in">uart_init</span>(<span class="number">115200</span>);	 	 <span class="comment">//串口初始化</span></span><br><span class="line">	<span class="built_in">KEY_Init</span>();				<span class="comment">//按键初始化</span></span><br><span class="line">	<span class="built_in">LCD_Init</span>();			   	<span class="comment">//LCD初始化  </span></span><br><span class="line">	<span class="built_in">LCD_ShowString</span>(<span class="number">30</span>,<span class="number">50</span>,<span class="number">200</span>,<span class="number">16</span>,<span class="number">16</span>,<span class="string">&quot;wd2711&#x27;s camera exp&quot;</span>);	</span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span>(<span class="built_in">CAMERA_Init</span>()==<span class="number">0</span>)<span class="comment">//摄像头初始化</span></span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">LCD_ShowString</span>(<span class="number">30</span>,<span class="number">210</span>,<span class="number">200</span>,<span class="number">16</span>,<span class="number">16</span>,<span class="string">&quot;camera init success&quot;</span>);</span><br><span class="line">			<span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				key=<span class="built_in">KEY_Scan</span>(<span class="number">0</span>);</span><br><span class="line">				<span class="keyword">if</span>(key==KEY1_PRES) <span class="comment">// 按下key1就进入画面</span></span><br><span class="line">				&#123;</span><br><span class="line">					<span class="built_in">CAMERA_Window_Set</span>(OV7725_WINDOW_WIDTH,OV7725_WINDOW_HEIGHT,<span class="number">1</span>);</span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line">				&#125;</span><br><span class="line">				i++;</span><br><span class="line">				<span class="keyword">if</span>(i==<span class="number">100</span>)</span><br><span class="line">                    <span class="built_in">LCD_ShowString</span>(<span class="number">30</span>,<span class="number">230</span>,<span class="number">210</span>,<span class="number">16</span>,<span class="number">16</span>,<span class="string">&quot;press key1 to start&quot;</span>); <span class="comment">//闪烁显示提示信息</span></span><br><span class="line">				<span class="keyword">if</span>(i==<span class="number">200</span>)</span><br><span class="line">				&#123;	</span><br><span class="line">					<span class="built_in">LCD_Fill</span>(<span class="number">30</span>,<span class="number">230</span>,<span class="number">210</span>,<span class="number">250</span>+<span class="number">16</span>,WHITE);</span><br><span class="line">					i=<span class="number">0</span>; </span><br><span class="line">				&#125;</span><br><span class="line">				<span class="built_in">delay_ms</span>(<span class="number">5</span>);</span><br><span class="line">			&#125;				</span><br><span class="line">			CAMERA_CS=<span class="number">0</span>; <span class="comment">// 用来表示摄像头的片选信号（CS）的引脚。它的意思是将PG15引脚作为输出，并用PGout(15)来控制它的高低电平。当PGout(15)为0时，表示选中摄像头，当为1时，表示不选中摄像头。</span></span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">EXTI8_Init</span>(); <span class="comment">//使能外部中断，捕获帧中断			</span></span><br><span class="line"> 	<span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">	&#123;	</span><br><span class="line">		<span class="built_in">LCD_ShowString</span>(<span class="number">30</span>,<span class="number">250</span>,<span class="number">210</span>,<span class="number">16</span>,<span class="number">16</span>,<span class="string">&quot;press key0 to change mode&quot;</span>);</span><br><span class="line">		<span class="built_in">LCD_ShowString</span>(<span class="number">30</span>,<span class="number">270</span>,<span class="number">210</span>,<span class="number">16</span>,<span class="number">16</span>,<span class="string">&quot;now mode is &quot;</span>);</span><br><span class="line">		<span class="built_in">LCD_ShowString</span>(<span class="number">30</span>,<span class="number">290</span>,<span class="number">210</span>,<span class="number">16</span>,<span class="number">16</span>,LMODE_TBL[lightmode]);</span><br><span class="line">		<span class="keyword">if</span>(key)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">switch</span>(key)</span><br><span class="line">			&#123;				    </span><br><span class="line">				<span class="keyword">case</span> KEY0_PRES:</span><br><span class="line">					lightmode++;</span><br><span class="line">					<span class="keyword">if</span>(lightmode&gt;<span class="number">5</span>)</span><br><span class="line">						lightmode=<span class="number">0</span>;</span><br><span class="line">					<span class="built_in">camera_Light_Mode</span>(lightmode);</span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;	 </span><br><span class="line">		<span class="built_in">camera_refresh</span>();<span class="comment">//更新显示</span></span><br><span class="line">	&#125;	   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="0x07-最终展示效果"><a href="#0x07-最终展示效果" class="headerlink" title="0x07 最终展示效果"></a>0x07 最终展示效果</h2><p>&emsp;初始界面：</p>
<p><img src="/images/camera-experiment/image-20230603175046004.png" alt="image-20230603175046004" style="zoom:67%;" /></p>
<p>&emsp;进入摄像头画面：</p>
<p><img src="/images/camera-experiment/image-20230603175211044.png" alt="image-20230603175211044" style="zoom:67%;" /></p>
<p>&emsp;更改画面风格：</p>
<p><img src="/images/camera-experiment/image-20230603175347165.png" alt="image-20230603175347165" style="zoom:67%;" /></p>
<h4 id="代码地址："><a href="#代码地址：" class="headerlink" title="代码地址："></a>代码地址：</h4><p><a target="_blank" rel="noopener" href="https://github.com/WD-2711/stm32-IOT">https://github.com/WD-2711/stm32-IOT</a></p>

  
	</div>

	<div>
  	<center>
	<div class="pagination">

    
    
    <a href="/2023/06/04/PIR-Blockchain/" type="button" class="btn btn-default"><i
                class="fa fa-arrow-circle-o-left"></i> 上一页</a>
    

    <a href="/" type="button" class="btn btn-default"><i class="fa fa-home"></i>Home</a>
    
    <a href="/2023/06/01/fragmented-knowledge/" type="button" class="btn btn-default ">下一页<i
                class="fa fa-arrow-circle-o-right"></i></a>
    

    
</div>

    </center>
	</div>


	<!-- comment -->
	
<section id="comment">
    <h2 class="title">留言</h2>

    <!-- 
    <div id="disqus_thread" class="ds-thread">
        <script type="text/javascript">
            /**
             * RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
             * LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
             */
                /*
                 var disqus_config = function () {
                 this.page.url = PAGE_URL; // Replace PAGE_URL with your page's canonical URL variable
                 this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
                 };
                 */
            (function() { // DON'T EDIT BELOW THIS LINE
                var d = document, s = d.createElement('script');

                s.src = 'https://https-wd-2711-tech.disqus.com/embed.js';

                s.setAttribute('data-timestamp', +new Date());
                (d.head || d.body).appendChild(s);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by
                Disqus.</a></noscript>
    </div> -->
    <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
    <div id="vcomments"></div>
    <script>
        new Valine({
            el: '#vcomments',
            appId: 'wLIJ70s3fPvW8WJPgVVAuWVR-gzGzoHsz',
            appKey: 'NVGqxhUkqtFv2CbwmXXWjCdR'
        })
    </script>

    
</section>


	</div> <!-- col-md-9/col-md-12 -->
		
	
	<div id="side_meta">
		<div class="col-md-3" id="post_meta"> 

	<!-- date -->
	
	<div class="meta-widget">
	<i class="fa fa-clock-o"></i>
	2023-06-02 
	</div>
	

	<!-- categories -->
    
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#categorys"><i class="fa fa-folder"></i></a>	
    <ul id="categorys" class="tag_box list-unstyled collapse in">
          
  <li>
    <li><a href="/categories/IOT/">IOT<span>4</span></a></li>
  </li>

    </ul>
	</div>
	

	<!-- tags -->
		

	<!-- toc -->
	<div class="meta-widget">
	
	   <a data-toggle="collapse" data-target="#toc"><i class="fa fa-bars"></i></a>
	   <div id="toc" class="toc collapse in">
		   <span class="toc-title">Contents</span>
			<ol class="toc-article"><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#%E6%91%84%E5%83%8F%E5%A4%B4%E5%AE%9E%E9%AA%8C"><span class="toc-article-text">摄像头实验</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#%E6%91%98%E8%A6%81%EF%BC%9A"><span class="toc-article-text">## 摘要：</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#0x00-%E5%AE%9E%E9%AA%8C%E8%AE%BE%E5%A4%87-amp-%E8%BD%AF%E4%BB%B6"><span class="toc-article-text">0x00 实验设备&amp;软件</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#0x01-%E5%A4%B4%E6%96%87%E4%BB%B6%E4%BB%8B%E7%BB%8D"><span class="toc-article-text">0x01 头文件介绍</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#0x02-%E5%88%9D%E5%A7%8B%E5%8C%96%E6%93%8D%E4%BD%9C"><span class="toc-article-text">0x02 初始化操作</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#%E5%BB%B6%E6%97%B6%E5%87%BD%E6%95%B0%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-article-text">延时函数初始化</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#%E4%B8%B2%E5%8F%A3%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-article-text">串口初始化</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#%E6%8C%89%E9%94%AE%E4%B8%8E%E5%B1%8F%E5%B9%95%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-article-text">按键与屏幕初始化</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#%E6%91%84%E5%83%8F%E5%A4%B4%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-article-text">摄像头初始化</span></a></li></ol></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#0x03-%E6%91%84%E5%83%8F%E5%A4%B4%E7%9B%B8%E5%85%B3%E5%87%BD%E6%95%B0"><span class="toc-article-text">0x03 摄像头相关函数</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-4"><a class="toc-article-link" href="#%E8%AE%BE%E7%BD%AECamera%EF%BC%8C%E4%BB%A5VGA%E6%A8%A1%E5%BC%8F%E8%BE%93%E5%87%BA%E5%9B%BE%E5%83%8F%EF%BC%9A"><span class="toc-article-text">设置Camera，以VGA模式输出图像：</span></a></li><li class="toc-article-item toc-article-level-4"><a class="toc-article-link" href="#%E8%AE%BE%E7%BD%AECamera%E7%94%BB%E9%9D%A2%E9%A3%8E%E6%A0%BC"><span class="toc-article-text">设置Camera画面风格</span></a></li></ol></li></ol></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#0x04-LCD%E7%9B%B8%E5%85%B3%E5%87%BD%E6%95%B0"><span class="toc-article-text">0x04 LCD相关函数</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-4"><a class="toc-article-link" href="#LCD%E8%BE%93%E5%87%BA%E5%AD%97%E7%AC%A6%E4%B8%B2%EF%BC%9A"><span class="toc-article-text">LCD输出字符串：</span></a></li><li class="toc-article-item toc-article-level-4"><a class="toc-article-link" href="#LCD%E5%B1%8F%E5%B9%95%E5%A1%AB%E5%85%85%E9%A2%9C%E8%89%B2%EF%BC%9A"><span class="toc-article-text">LCD屏幕填充颜色：</span></a></li></ol></li></ol></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#0x05-%E6%8C%89%E9%94%AE%E7%9B%B8%E5%85%B3%E5%87%BD%E6%95%B0"><span class="toc-article-text">0x05 按键相关函数</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#0x06-main%E5%87%BD%E6%95%B0"><span class="toc-article-text">0x06 main函数</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#0x07-%E6%9C%80%E7%BB%88%E5%B1%95%E7%A4%BA%E6%95%88%E6%9E%9C"><span class="toc-article-text">0x07 最终展示效果</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-4"><a class="toc-article-link" href="#%E4%BB%A3%E7%A0%81%E5%9C%B0%E5%9D%80%EF%BC%9A"><span class="toc-article-text">代码地址：</span></a></li></ol></li></ol></li></ol></li></ol>
		</div>
	
	</div>
	
    <hr>
	
</div><!-- col-md-3 -->

	</div>

	<!-- copyright -->
	<div>
    <ul class="post-copyright">
      <li class="post-copyright-author">
      <strong>作者:  </strong>wd-z711</a>
      </li>
      <li class="post-copyright-link">
      <strong>文章链接:  </strong>
      <a href="/" target="_blank" title="">https://wd-2711.tech/</a>
      </li>
      <li class="post-copyright-license">
        <strong>版权声明:   </strong>
        本博客所有文章除特别声明外，均采用 <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">CC BY-NC-ND 4.0</a>
        许可协议。转载请注明出处!
      </li>
    </ul>
  <div>
 	

		


</div><!-- row -->




	</div>
  </div>
  <div class="container-narrow">
  <footer> <p>
  &copy; 2024 wd-z711
  
      <!-- with help from <a href="http://hexo.io/" target="_blank">Hexo</a>,<a target="_blank" rel="noopener" href="http://github.com/wzpan/hexo-theme-freemind/">Freemind</a>,<a href="http://getbootstrap.com/" target="_blank">Twitter Bootstrap</a> and <a href="http://getbootstrap.com/" target="_blank">BOOTSTRA.386</a>. 
     <br> Theme by <a target="_blank" rel="noopener" href="http://github.com/wzpan/hexo-theme-freemind/">Freemind.386</a>.     -->

     <!-- <script type="text/javascript">
      (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
      (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
      e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
      })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');
      
      _st('install','aB-vgeB8gEDrnRJuhceL','2.0.0');
    </script> -->
    </p>
 </footer>
</div> <!-- container-narrow -->
  


  
<a id="gotop" href="#">   
  <span>⬆︎TOP</span>
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/search.js"></script> 


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



   <script type="text/javascript">      
     var search_path = "search.xml";
	 if (search_path.length == 0) {
	 	search_path = "search.xml";
	 }
	 var path = "/" + search_path;
     searchFunc(path, 'local-search-input', 'local-search-result');
   </script>

</body>
   </html>
