<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="pragma" content="no-cache">
  <meta http-equiv="cache-control" content="no-cache">
  <meta http-equiv="expires" content="0">
  
  <title>SCTF-2023 | wd-z711&#39;s B10g</title>
  <meta name="author" content="wd-z711">
  
  <meta name="description" content="SCTF2023 about wp in the reverse direction.">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="SCTF-2023"/>
  <meta property="og:site_name" content="wd-z711&#39;s B10g"/>

  
    <meta property="og:image" content=""/>
  

  
  
    <link href="/favicon.png" rel="icon">
  
  
  <link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>

  <!-- analytics -->
  
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'G-YHJSKZDC3Y', 'auto');
  ga('send', 'pageview');
</script>




<meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="wd-z711's B10g" type="application/atom+xml">
</head>

 <body>  
  <nav id="main-nav" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
      <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
		<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
	  <a class="navbar-brand" href="/">wd-z711&#39;s B10g</a>
      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		  
		  <li>
			<a href="/archives" title="All the articles.">
			  <i class="fa fa-archive"></i>Archives
			</a>
		  </li>
		  
		  <li>
			<a href="/categories" title="All the categories.">
			  <i class="fa fa-folder"></i>Categories
			</a>
		  </li>
		  
		  <li>
			<a href="/about" title="About me.">
			  <i class="fa fa-user"></i>About
			</a>
		  </li>
		  
		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
  	<div class="content">
    	 


	
		<div class="page-header">
			<h1> SCTF-2023</h1>
		</div>
	



<div class="row post">

	<!-- cols -->
	
	<div id="top_meta"></div>
	<div class="col-md-9">
	

	<!-- content -->
	<div class="mypage">		
	  
		 <div class="alert alert-success description">
			<i class="fa fa-info-circle"></i> SCTF2023 about wp in the reverse direction.
		 </div> <!-- alert -->
	  		

	  <p>复现文件保存在<a target="_blank" rel="noopener" href="https://github.com/WD-2711/re_files/tree/main/SCTF2023-re">链接</a>。</p>
<h1 id="SycLang"><a href="#SycLang" class="headerlink" title="SycLang"></a>SycLang</h1><p>&emsp;64位trans_IR。主要是看那个txt文件。经过化简，可以得到：</p>
<span id="more"></span>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">var15&lt;+56&gt;   -&gt; aa</span><br><span class="line">var16&lt;+64&gt;   -&gt; bb</span><br><span class="line">var17&lt;+72&gt;   -&gt; cc</span><br><span class="line">var18&lt;+80&gt;   -&gt; dd</span><br><span class="line">var19&lt;+88&gt;   -&gt; ee</span><br><span class="line">var20&lt;+96&gt;   -&gt; ff</span><br><span class="line">var21&lt;+104&gt;  -&gt; gg</span><br><span class="line">var12&lt;+32&gt;   -&gt; hh</span><br><span class="line">var13&lt;+40&gt;   -&gt; kk</span><br><span class="line">var11        -&gt; arr1</span><br><span class="line">var22        -&gt; cp1</span><br><span class="line">var23        -&gt; cp2</span><br><span class="line">var24        -&gt; cp3</span><br><span class="line">var25        -&gt; cp4</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br></pre></td><td class="code"><pre><span class="line">STRUCT exp :</span><br><span class="line">  ARRAY .key(int)[24]&lt;+0&gt;</span><br><span class="line">  ARRAY .L(int)[8]&lt;+192&gt;</span><br><span class="line">  ARRAY .R(int)[8]&lt;+256&gt;</span><br><span class="line">  ARRAY .X(int)[8]&lt;+320&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">FUNCTION read - 8 :</span><br><span class="line">  PARAM var2&lt;+8&gt;</span><br><span class="line">LABEL Flabelread :</span><br><span class="line"></span><br><span class="line">FUNCTION writes - 0 :</span><br><span class="line">LABEL Flabelwrites :</span><br><span class="line"></span><br><span class="line">FUNCTION writef - 0 :</span><br><span class="line">LABEL Flabelwritef :</span><br><span class="line"></span><br><span class="line">FUNCTION exit - 0 :</span><br><span class="line">LABEL Flabelexit :</span><br><span class="line"></span><br><span class="line">FUNCTION main - 1640 :</span><br><span class="line">  ARRAY arr1(char)[24]&lt;+0&gt;</span><br><span class="line">  STRUCT cp1(exp)&lt;+488&gt;</span><br><span class="line">  STRUCT cp2(exp)&lt;+872&gt;</span><br><span class="line">  STRUCT cp3(exp)&lt;+1256&gt;</span><br><span class="line">  STRUCT cp4(exp)&lt;+1640&gt;</span><br><span class="line">  ARG arr1&lt;+24&gt;                        // 输入</span><br><span class="line">  CALL read</span><br><span class="line">  aa := 0</span><br><span class="line">LABEL label4 :</span><br><span class="line">  IF aa &lt; 24 </span><br><span class="line">	GOTO label3</span><br><span class="line">  GOTO label2</span><br><span class="line">LABEL label3 :</span><br><span class="line">  hh := 0</span><br><span class="line">  bb := aa</span><br><span class="line">  hh ::= arr1&lt;1+bb&gt;</span><br><span class="line">  dd := 23 - aa</span><br><span class="line">  cp1.key[8+8*dd] = hh                 // 输入的倒序给cp1.key, aa=输入长度</span><br><span class="line">  aa := aa + 1</span><br><span class="line">  GOTO label4</span><br><span class="line">LABEL label2 :</span><br><span class="line">  aa := 23</span><br><span class="line">LABEL label11 :</span><br><span class="line">  IF aa &gt; 0 </span><br><span class="line">	GOTO label10</span><br><span class="line">  GOTO label9</span><br><span class="line">LABEL label10 :</span><br><span class="line">  dd := aa</span><br><span class="line">  ee = cp1.key[8+8*dd]                // 输入的第1个值给ee</span><br><span class="line">  bb := aa - 1</span><br><span class="line">  cc = cp1.key[8+8*bb]                // 输入的第2个值给cc</span><br><span class="line">  gg := ee - cc                </span><br><span class="line">  cp1.key[8+8*aa] = gg                // cp1.key[aa] = cp1.key[aa]-cp1.key[aa-1]，见草稿纸（1）</span><br><span class="line">  aa := aa - 1</span><br><span class="line">  GOTO label11</span><br><span class="line">LABEL label9 :</span><br><span class="line">  cp1(@exp.L[0])&lt;+200&gt;&lt;+488&gt; := 0     // cp1.L = [0,15,2,10,6,9,1,4]</span><br><span class="line">  cp1(@exp.R[0])&lt;+264&gt;&lt;+488&gt; := 8     // cp1.R = [8,23,11,20,13,21,19,17]</span><br><span class="line">  cp1(@exp.X[0])&lt;+328&gt;&lt;+488&gt; := 11    // cp1.X = [11,-13,17,-19,23,-29,31,-37]</span><br><span class="line">  cp1(@exp.L[1])&lt;+208&gt;&lt;+488&gt; := 15</span><br><span class="line">  cp1(@exp.R[1])&lt;+272&gt;&lt;+488&gt; := 23</span><br><span class="line">  cp1(@exp.X[1])&lt;+336&gt;&lt;+488&gt; := -13</span><br><span class="line">  cp1(@exp.L[2])&lt;+216&gt;&lt;+488&gt; := 2</span><br><span class="line">  cp1(@exp.R[2])&lt;+280&gt;&lt;+488&gt; := 11</span><br><span class="line">  cp1(@exp.X[2])&lt;+344&gt;&lt;+488&gt; := 17</span><br><span class="line">  cp1(@exp.L[3])&lt;+224&gt;&lt;+488&gt; := 10</span><br><span class="line">  cp1(@exp.R[3])&lt;+288&gt;&lt;+488&gt; := 20</span><br><span class="line">  cp1(@exp.X[3])&lt;+352&gt;&lt;+488&gt; := -19</span><br><span class="line">  cp1(@exp.L[4])&lt;+232&gt;&lt;+488&gt; := 6</span><br><span class="line">  cp1(@exp.R[4])&lt;+296&gt;&lt;+488&gt; := 13</span><br><span class="line">  cp1(@exp.X[4])&lt;+360&gt;&lt;+488&gt; := 23</span><br><span class="line">  cp1(@exp.L[5])&lt;+240&gt;&lt;+488&gt; := 9</span><br><span class="line">  cp1(@exp.R[5])&lt;+304&gt;&lt;+488&gt; := 21</span><br><span class="line">  cp1(@exp.X[5])&lt;+368&gt;&lt;+488&gt; := -29</span><br><span class="line">  cp1(@exp.L[6])&lt;+248&gt;&lt;+488&gt; := 1</span><br><span class="line">  cp1(@exp.R[6])&lt;+312&gt;&lt;+488&gt; := 19</span><br><span class="line">  cp1(@exp.X[6])&lt;+376&gt;&lt;+488&gt; := 31</span><br><span class="line">  cp1(@exp.L[7])&lt;+256&gt;&lt;+488&gt; := 4</span><br><span class="line">  cp1(@exp.R[7])&lt;+320&gt;&lt;+488&gt; := 17</span><br><span class="line">  cp1(@exp.X[7])&lt;+384&gt;&lt;+488&gt; := -37</span><br><span class="line">  aa := 0</span><br><span class="line">LABEL label43 :</span><br><span class="line">  IF aa &lt; 8</span><br><span class="line">	GOTO label42</span><br><span class="line">  GOTO label41</span><br><span class="line">LABEL label42 :</span><br><span class="line">  bb = cp1.L[200+8*aa]</span><br><span class="line">  dd = cp1.R[264+8*aa]</span><br><span class="line">  ff = cp1.X[328+8*aa]</span><br><span class="line">  cc = cp1.key[8+8*bb]               // cc = cp1.key[cp1.L[aa]]  </span><br><span class="line">  ee = cp1.key[8+8*dd]               // ee = cp1.key[cp1.R[aa]] </span><br><span class="line">  cc := cc + ff                      </span><br><span class="line">  ee := ee - ff</span><br><span class="line">  cp1.key[8+8*bb] = cc               // cp1.key[cp1.L[aa]] = cp1.key[cp1.L[aa]]  + cp1.X[aa]</span><br><span class="line">  cp1.key[8+8*dd] = ee               // cp1.key[cp1.R[aa]] = cp1.key[cp1.R[aa]] - cp1.X[aa]</span><br><span class="line">  aa := aa + 1</span><br><span class="line">  GOTO label43                       // 见草稿纸（2）</span><br><span class="line">LABEL label41 :</span><br><span class="line">  aa := 1</span><br><span class="line">LABEL label54 :</span><br><span class="line">  IF aa &lt; 24</span><br><span class="line">	GOTO label53</span><br><span class="line">  GOTO label52</span><br><span class="line">LABEL label53 :</span><br><span class="line">  cc = cp1.key[8+8*aa]</span><br><span class="line">  bb := aa - 1</span><br><span class="line">  ff = cp1.key[8+8*bb]</span><br><span class="line">  cc := cc + ff</span><br><span class="line">  cp1.key[8+8*aa] = cc               // cp1.key[aa] = cp1.key[aa] + cp1.key[aa-1]</span><br><span class="line">  aa := aa + 1                       // 见草稿纸（3）</span><br><span class="line">  GOTO label54</span><br><span class="line">LABEL label52 :</span><br><span class="line">  aa := 0</span><br><span class="line">LABEL label61 :</span><br><span class="line">  IF aa &lt; 23</span><br><span class="line">	GOTO label60</span><br><span class="line">  GOTO label59</span><br><span class="line">LABEL label60 :</span><br><span class="line">  bb := aa</span><br><span class="line">  hh := cp1.key[bb]</span><br><span class="line">  dd := aa + 1</span><br><span class="line">  kk := cp1.key[dd]</span><br><span class="line">  kk := 0</span><br><span class="line">  cp1.key[bb] = hh ^ kk              // cp1.key[aa] = cp1.key[aa] ^ cp1.key[aa+1] or cp1.key[aa] = cp1.key[aa]</span><br><span class="line">  aa := aa + 1                       // 见草稿纸（4）</span><br><span class="line">  GOTO label61              </span><br><span class="line">LABEL label59 :</span><br><span class="line">  cp3(@exp.L[0])&lt;+200&gt;&lt;+1256&gt; := 0   // cp3.L = [0,9,9,8,10,9,1,0]</span><br><span class="line">  cp3(@exp.R[0])&lt;+264&gt;&lt;+1256&gt; := 12  // cp3.R = [12,10,12,19,12,13,22,23]</span><br><span class="line">  cp3(@exp.X[0])&lt;+328&gt;&lt;+1256&gt; := -19 // cp3.X = [-19,-10,3,-11,-9,3,-19,7]</span><br><span class="line">  cp3(@exp.L[1])&lt;+208&gt;&lt;+1256&gt; := 9   // cp3.key = [12,31,31,31,31,31,31,31,42,46,45,45,20,23,23,23,23,23,23,12,12,12,-7,0]</span><br><span class="line">  cp3(@exp.R[1])&lt;+272&gt;&lt;+1256&gt; := 10</span><br><span class="line">  cp3(@exp.X[1])&lt;+336&gt;&lt;+1256&gt; := -10</span><br><span class="line">  cp3(@exp.L[2])&lt;+216&gt;&lt;+1256&gt; := 9</span><br><span class="line">  cp3(@exp.R[2])&lt;+280&gt;&lt;+1256&gt; := 12</span><br><span class="line">  cp3(@exp.X[2])&lt;+344&gt;&lt;+1256&gt; := 3</span><br><span class="line">  cp3(@exp.L[3])&lt;+224&gt;&lt;+1256&gt; := 8</span><br><span class="line">  cp3(@exp.R[3])&lt;+288&gt;&lt;+1256&gt; := 19</span><br><span class="line">  cp3(@exp.X[3])&lt;+352&gt;&lt;+1256&gt; := -11</span><br><span class="line">  cp3(@exp.L[4])&lt;+232&gt;&lt;+1256&gt; := 10</span><br><span class="line">  cp3(@exp.R[4])&lt;+296&gt;&lt;+1256&gt; := 12</span><br><span class="line">  cp3(@exp.X[4])&lt;+360&gt;&lt;+1256&gt; := -9</span><br><span class="line">  cp3(@exp.L[5])&lt;+240&gt;&lt;+1256&gt; := 9</span><br><span class="line">  cp3(@exp.R[5])&lt;+304&gt;&lt;+1256&gt; := 13</span><br><span class="line">  cp3(@exp.X[5])&lt;+368&gt;&lt;+1256&gt; := 3</span><br><span class="line">  cp3(@exp.L[6])&lt;+248&gt;&lt;+1256&gt; := 1</span><br><span class="line">  cp3(@exp.R[6])&lt;+312&gt;&lt;+1256&gt; := 22</span><br><span class="line">  cp3(@exp.X[6])&lt;+376&gt;&lt;+1256&gt; := -19</span><br><span class="line">  cp3(@exp.L[7])&lt;+256&gt;&lt;+1256&gt; := 0</span><br><span class="line">  cp3(@exp.R[7])&lt;+320&gt;&lt;+1256&gt; := 23</span><br><span class="line">  cp3(@exp.X[7])&lt;+384&gt;&lt;+1256&gt; := 7</span><br><span class="line">  cp3(@exp.key[0])&lt;+8&gt;&lt;+1256&gt; := 12</span><br><span class="line">  cp3(@exp.key[1])&lt;+16&gt;&lt;+1256&gt; := 31</span><br><span class="line">  cp3(@exp.key[2])&lt;+24&gt;&lt;+1256&gt; := 31</span><br><span class="line">  cp3(@exp.key[3])&lt;+32&gt;&lt;+1256&gt; := 31</span><br><span class="line">  cp3(@exp.key[4])&lt;+40&gt;&lt;+1256&gt; := 31</span><br><span class="line">  cp3(@exp.key[5])&lt;+48&gt;&lt;+1256&gt; := 31</span><br><span class="line">  cp3(@exp.key[6])&lt;+56&gt;&lt;+1256&gt; := 31</span><br><span class="line">  cp3(@exp.key[7])&lt;+64&gt;&lt;+1256&gt; := 31</span><br><span class="line">  cp3(@exp.key[8])&lt;+72&gt;&lt;+1256&gt; := 42</span><br><span class="line">  cp3(@exp.key[9])&lt;+80&gt;&lt;+1256&gt; := 46</span><br><span class="line">  cp3(@exp.key[10])&lt;+88&gt;&lt;+1256&gt; := 45</span><br><span class="line">  cp3(@exp.key[11])&lt;+96&gt;&lt;+1256&gt; := 45</span><br><span class="line">  cp3(@exp.key[12])&lt;+104&gt;&lt;+1256&gt; := 20</span><br><span class="line">  cp3(@exp.key[13])&lt;+112&gt;&lt;+1256&gt; := 23</span><br><span class="line">  cp3(@exp.key[14])&lt;+120&gt;&lt;+1256&gt; := 23</span><br><span class="line">  cp3(@exp.key[15])&lt;+128&gt;&lt;+1256&gt; := 23</span><br><span class="line">  cp3(@exp.key[16])&lt;+136&gt;&lt;+1256&gt; := 23</span><br><span class="line">  cp3(@exp.key[17])&lt;+144&gt;&lt;+1256&gt; := 23</span><br><span class="line">  cp3(@exp.key[18])&lt;+152&gt;&lt;+1256&gt; := 23</span><br><span class="line">  cp3(@exp.key[19])&lt;+160&gt;&lt;+1256&gt; := 12</span><br><span class="line">  cp3(@exp.key[20])&lt;+168&gt;&lt;+1256&gt; := 12</span><br><span class="line">  cp3(@exp.key[21])&lt;+176&gt;&lt;+1256&gt; := 12</span><br><span class="line">  cp3(@exp.key[22])&lt;+184&gt;&lt;+1256&gt; := -7</span><br><span class="line">  cp3(@exp.key[23])&lt;+192&gt;&lt;+1256&gt; := 0</span><br><span class="line">  aa := 23</span><br><span class="line">LABEL label118 :</span><br><span class="line">  IF aa &gt; 0 </span><br><span class="line">	GOTO label117</span><br><span class="line">  GOTO label116</span><br><span class="line">LABEL label117 :</span><br><span class="line">  dd := aa</span><br><span class="line">  ee = cp3.key[8+8*dd]</span><br><span class="line">  bb := aa - 1</span><br><span class="line">  cc = cp3.key[8+8*bb]</span><br><span class="line">  gg := ee - cc</span><br><span class="line">  cp3.key[8+8*aa] = gg              // cp3.key[aa] = cp3.key[aa] - cp3.key[aa-1]</span><br><span class="line">  aa := aa - 1                      // 见草稿纸（5）</span><br><span class="line">  GOTO label118</span><br><span class="line">LABEL label116 :</span><br><span class="line">  aa := 0</span><br><span class="line">LABEL label126 :</span><br><span class="line">  IF aa &lt; 8 </span><br><span class="line">	GOTO label125</span><br><span class="line">  GOTO label124</span><br><span class="line">LABEL label125 :</span><br><span class="line">  bb = cp3.L[200+8*aa]</span><br><span class="line">  dd = cp3.R[264+8*aa]</span><br><span class="line">  ff = cp3.X[328+8*aa]</span><br><span class="line">  cc = cp3.key[8+8*bb]</span><br><span class="line">  ee = cp3.key[8+8*dd]</span><br><span class="line">  cc := cc + ff</span><br><span class="line">  ee := ee - ff</span><br><span class="line">  cp3.key[8+8*bb] = cc            // cp3.key[cp3.L[aa]] = cp3.key[cp3.L[aa]] + cp3.X[aa]</span><br><span class="line">  cp3.key[8+8*dd] = ee            // cp3.key[cp3.R[aa]] = cp3.key[cp3.R[aa]] - cp3.X[aa]</span><br><span class="line">  aa := aa + 1                    // 见草稿纸（6）</span><br><span class="line">  GOTO label126</span><br><span class="line">LABEL label124 :</span><br><span class="line">  aa := 1</span><br><span class="line">LABEL label137 :</span><br><span class="line">  IF aa &lt; 24</span><br><span class="line">	GOTO label136</span><br><span class="line">  GOTO label135</span><br><span class="line">LABEL label136 :</span><br><span class="line">  cc = cp3.key[8+8*aa]           </span><br><span class="line">  bb := aa - 1</span><br><span class="line">  ff = cp3.key[8+8*bb]</span><br><span class="line">  cc := cc + ff</span><br><span class="line">  cp3.key[8+8*aa] = cc            // cp3.key[aa] = cp3.key[aa] + cp3.key[aa-1]</span><br><span class="line">  aa := aa + 1                    // 见（7）</span><br><span class="line">  GOTO label137</span><br><span class="line">LABEL label135 :</span><br><span class="line">  cp2(@exp.key[0])&lt;+8&gt;&lt;+872&gt; := 252    // cp2.key = [252,352,484,470,496,487,539,585,447,474,577,454,466,345,344,486,501,423,490,375,257,203,265,125]</span><br><span class="line">  cp2(@exp.key[1])&lt;+16&gt;&lt;+872&gt; := 352</span><br><span class="line">  cp2(@exp.key[2])&lt;+24&gt;&lt;+872&gt; := 484</span><br><span class="line">  cp2(@exp.key[3])&lt;+32&gt;&lt;+872&gt; := 470</span><br><span class="line">  cp2(@exp.key[4])&lt;+40&gt;&lt;+872&gt; := 496</span><br><span class="line">  cp2(@exp.key[5])&lt;+48&gt;&lt;+872&gt; := 487</span><br><span class="line">  cp2(@exp.key[6])&lt;+56&gt;&lt;+872&gt; := 539</span><br><span class="line">  cp2(@exp.key[7])&lt;+64&gt;&lt;+872&gt; := 585</span><br><span class="line">  cp2(@exp.key[8])&lt;+72&gt;&lt;+872&gt; := 447</span><br><span class="line">  cp2(@exp.key[9])&lt;+80&gt;&lt;+872&gt; := 474</span><br><span class="line">  cp2(@exp.key[10])&lt;+88&gt;&lt;+872&gt; := 577</span><br><span class="line">  cp2(@exp.key[11])&lt;+96&gt;&lt;+872&gt; := 454</span><br><span class="line">  cp2(@exp.key[12])&lt;+104&gt;&lt;+872&gt; := 466</span><br><span class="line">  cp2(@exp.key[13])&lt;+112&gt;&lt;+872&gt; := 345</span><br><span class="line">  cp2(@exp.key[14])&lt;+120&gt;&lt;+872&gt; := 344</span><br><span class="line">  cp2(@exp.key[15])&lt;+128&gt;&lt;+872&gt; := 486</span><br><span class="line">  cp2(@exp.key[16])&lt;+136&gt;&lt;+872&gt; := 501</span><br><span class="line">  cp2(@exp.key[17])&lt;+144&gt;&lt;+872&gt; := 423</span><br><span class="line">  cp2(@exp.key[18])&lt;+152&gt;&lt;+872&gt; := 490</span><br><span class="line">  cp2(@exp.key[19])&lt;+160&gt;&lt;+872&gt; := 375</span><br><span class="line">  cp2(@exp.key[20])&lt;+168&gt;&lt;+872&gt; := 257</span><br><span class="line">  cp2(@exp.key[21])&lt;+176&gt;&lt;+872&gt; := 203</span><br><span class="line">  cp2(@exp.key[22])&lt;+184&gt;&lt;+872&gt; := 265</span><br><span class="line">  cp2(@exp.key[23])&lt;+192&gt;&lt;+872&gt; := 125</span><br><span class="line">  aa := 0</span><br><span class="line">LABEL label168 :</span><br><span class="line">  IF aa &lt; 24 </span><br><span class="line">	GOTO label167</span><br><span class="line">  GOTO label166</span><br><span class="line">LABEL label167 :</span><br><span class="line">  bb := aa</span><br><span class="line">  cc = cp2.key[8+8*bb]</span><br><span class="line">  dd := aa</span><br><span class="line">  ee = cp3.key[8+8*dd]</span><br><span class="line">  gg := cc ^ ee</span><br><span class="line">  cp2.key[8+8*aa] = gg                // cp2.key[aa] = cp2.key[aa] ^ cp3.key[aa]</span><br><span class="line">  aa := aa + 1                        // 见（8）</span><br><span class="line">  GOTO label168</span><br><span class="line">LABEL label166 :</span><br><span class="line">  aa := 0</span><br><span class="line">LABEL label176 :                      </span><br><span class="line">  IF aa &lt; 8 </span><br><span class="line">	GOTO label175</span><br><span class="line">  GOTO label174</span><br><span class="line">LABEL label175 :</span><br><span class="line">  bb := aa * 3</span><br><span class="line">  cc = cp1.key[8+8*bb]</span><br><span class="line">  cp2.X[328+8*aa] = cc                // cp2.X[aa] = cp1.key[aa*3]</span><br><span class="line">  aa := aa + 1                        // 见（9）</span><br><span class="line">  GOTO label176</span><br><span class="line">LABEL label174 :</span><br><span class="line">  aa := 23</span><br><span class="line">LABEL label181 :</span><br><span class="line">  IF aa &gt; 0 </span><br><span class="line">	GOTO label180</span><br><span class="line">  GOTO label179</span><br><span class="line">LABEL label180 :</span><br><span class="line">  dd := aa</span><br><span class="line">  ee = cp2.key[8+8*dd]</span><br><span class="line">  bb := aa</span><br><span class="line">  bb := bb - 1</span><br><span class="line">  cc = cp2.key[8+8*bb]</span><br><span class="line">  gg := ee - cc</span><br><span class="line">  cp2.key[8+8*aa] = gg               // cp2.key[aa] = cp2.key[aa] - cp2.key[aa-1]</span><br><span class="line">  aa := aa - 1                       // 见（10）</span><br><span class="line">  GOTO label181</span><br><span class="line">LABEL label179 :</span><br><span class="line">  aa := 0</span><br><span class="line">LABEL label190 :</span><br><span class="line">  IF aa &lt; 8</span><br><span class="line">	GOTO label189</span><br><span class="line">  GOTO label188</span><br><span class="line">LABEL label189 :</span><br><span class="line">  bb = cp1.L[200+8*aa]  </span><br><span class="line">  dd = cp1.R[264+8*aa]</span><br><span class="line">  ff = cp2.X[328+8*aa]</span><br><span class="line">  cc = cp2.key[8+8*bb]</span><br><span class="line">  ee = cp2.key[8+8*dd]</span><br><span class="line">  cc := cc - ff</span><br><span class="line">  ee := ee + ff</span><br><span class="line">  cp2.key[8+8*bb] = cc              // cp2.key[cp1.L[aa]] = cp2.key[cp1.L[aa]] - cp2.X[aa]</span><br><span class="line">  cp2.key[8+8*dd] = ee              // cp2.key[cp1.R[aa]] = cp2.key[cp1.R[aa]] + cp2.X[aa]</span><br><span class="line">  aa := aa + 1                      // 见（11）</span><br><span class="line">  GOTO label190</span><br><span class="line">LABEL label188 :</span><br><span class="line">  aa := 1</span><br><span class="line">LABEL label201 :</span><br><span class="line">  IF aa &lt; 24</span><br><span class="line">	GOTO label200</span><br><span class="line">  GOTO label199</span><br><span class="line">LABEL label200 :</span><br><span class="line">  cc = cp2.key[8+8*aa]</span><br><span class="line">  bb := aa - 1</span><br><span class="line">  ff = cp2.key[8+8*bb]</span><br><span class="line">  cc := cc + ff</span><br><span class="line">  cp2.key[8+8*aa] = cc              // cp2.key[aa] = cp2.key[aa] + cp2.key[aa-1]</span><br><span class="line">  aa := aa + 1                      // 见（12）</span><br><span class="line">  GOTO label201</span><br><span class="line">LABEL label199 :</span><br><span class="line">  aa := 0</span><br><span class="line">LABEL label208 :</span><br><span class="line">  IF aa &lt; 7</span><br><span class="line">	GOTO label207</span><br><span class="line">  GOTO label206</span><br><span class="line">LABEL label207 :</span><br><span class="line">  bb := aa</span><br><span class="line">  cc = cp1.L[200+8*bb]</span><br><span class="line">  dd := aa + 1</span><br><span class="line">  ee = cp1.L[200+8*dd]</span><br><span class="line">  gg := cc ^ ee                    // gg = cp1.L[aa] ^ cp1.L[aa+1]</span><br><span class="line">  IF gg &gt; 23</span><br><span class="line">	GOTO label215</span><br><span class="line">  GOTO label214</span><br><span class="line">LABEL label215 :</span><br><span class="line">  gg := 23</span><br><span class="line">LABEL label214 :</span><br><span class="line">  cp4.L[200+8*aa] = gg             // cp4.L[aa] = gg</span><br><span class="line">  aa := aa + 1                     </span><br><span class="line">  GOTO label208</span><br><span class="line">LABEL label206 :                   // cp4.L[7] = 0</span><br><span class="line">  cp4.L[256+7*8] = 0               // 见（13）</span><br><span class="line">  aa := 0</span><br><span class="line">LABEL label219 :</span><br><span class="line">  IF aa &lt; 7 </span><br><span class="line">	GOTO label218</span><br><span class="line">  GOTO label217</span><br><span class="line">LABEL label218 :</span><br><span class="line">  bb := aa</span><br><span class="line">  cc = cp1.R[264+8*bb]</span><br><span class="line">  dd := aa + 1</span><br><span class="line">  ee = cp1.R[264+8*dd]</span><br><span class="line">  gg := cc ^ ee                    // gg = cp1.R[aa] ^ cp1.R[aa+1]</span><br><span class="line">  IF gg &gt; 23</span><br><span class="line">	GOTO label226</span><br><span class="line">  GOTO label225</span><br><span class="line">LABEL label226 :</span><br><span class="line">  gg := 23</span><br><span class="line">LABEL label225 :</span><br><span class="line">  cp4.R[264+8*aa] = gg             // cp4.R[aa] = gg</span><br><span class="line">  aa := aa + 1</span><br><span class="line">  GOTO label219</span><br><span class="line">LABEL label217 :</span><br><span class="line">  cp4.R[320+8*7] = 23              // cp4.R[7] = 23</span><br><span class="line">  aa := 0                          // 见（14）</span><br><span class="line">LABEL label230 :</span><br><span class="line">  IF aa &lt; 7</span><br><span class="line">	GOTO label229</span><br><span class="line">  GOTO label228</span><br><span class="line">LABEL label229 :</span><br><span class="line">  bb := aa</span><br><span class="line">  cc = cp1.X[328+8*bb]</span><br><span class="line">  dd := aa + 1</span><br><span class="line">  ee = cp1.X[328+8*dd]</span><br><span class="line">  gg := cc ^ ee</span><br><span class="line">  cp4.X[328+8*aa] = gg             // cp4.X[aa] = cp1.X[aa] ^ cp1.X[aa+1]</span><br><span class="line">  aa := aa + 1                     // 见（15）</span><br><span class="line">  GOTO label230</span><br><span class="line">LABEL label228 :</span><br><span class="line">  cp4(@exp.X[7])&lt;+384&gt;&lt;+1640&gt; := 12</span><br><span class="line">  cp4(@exp.key[0])&lt;+8&gt;&lt;+1640&gt; := 127  // cp4.key = [127,111,188,174,195,128,88,121,123,103,57,123,97,74,37,59,21,47,54,28,49,55,??,125]</span><br><span class="line">  cp4(@exp.key[1])&lt;+16&gt;&lt;+1640&gt; := 111</span><br><span class="line">  cp4(@exp.key[2])&lt;+24&gt;&lt;+1640&gt; := 188</span><br><span class="line">  cp4(@exp.key[3])&lt;+32&gt;&lt;+1640&gt; := 174</span><br><span class="line">  cp4(@exp.key[4])&lt;+40&gt;&lt;+1640&gt; := 195</span><br><span class="line">  cp4(@exp.key[5])&lt;+48&gt;&lt;+1640&gt; := 128</span><br><span class="line">  cp4(@exp.key[6])&lt;+56&gt;&lt;+1640&gt; := 88</span><br><span class="line">  cp4(@exp.key[7])&lt;+64&gt;&lt;+1640&gt; := 121</span><br><span class="line">  cp4(@exp.key[8])&lt;+72&gt;&lt;+1640&gt; := 123</span><br><span class="line">  cp4(@exp.key[9])&lt;+80&gt;&lt;+1640&gt; := 103</span><br><span class="line">  cp4(@exp.key[10])&lt;+88&gt;&lt;+1640&gt; := 57</span><br><span class="line">  cp4(@exp.key[11])&lt;+96&gt;&lt;+1640&gt; := 123</span><br><span class="line">  cp4(@exp.key[12])&lt;+104&gt;&lt;+1640&gt; := 97</span><br><span class="line">  cp4(@exp.key[13])&lt;+112&gt;&lt;+1640&gt; := 74</span><br><span class="line">  cp4(@exp.key[14])&lt;+120&gt;&lt;+1640&gt; := 37</span><br><span class="line">  cp4(@exp.key[15])&lt;+128&gt;&lt;+1640&gt; := 59</span><br><span class="line">  cp4(@exp.key[16])&lt;+136&gt;&lt;+1640&gt; := 21</span><br><span class="line">  cp4(@exp.key[17])&lt;+144&gt;&lt;+1640&gt; := 47</span><br><span class="line">  cp4(@exp.key[18])&lt;+152&gt;&lt;+1640&gt; := 54</span><br><span class="line">  cp4(@exp.key[19])&lt;+160&gt;&lt;+1640&gt; := 28</span><br><span class="line">  cp4(@exp.key[20])&lt;+168&gt;&lt;+1640&gt; := 49</span><br><span class="line">  cp4(@exp.key[21])&lt;+176&gt;&lt;+1640&gt; := 55</span><br><span class="line">  cp4(@exp.key[22])&lt;+184&gt;&lt;+1640&gt; := var1&lt;+8&gt;</span><br><span class="line">  cp4(@exp.key[23])&lt;+192&gt;&lt;+1640&gt; := 125</span><br><span class="line">  aa := 23</span><br><span class="line">LABEL label263 :</span><br><span class="line">  IF aa &gt; 0 </span><br><span class="line">	GOTO label262</span><br><span class="line">  GOTO label261</span><br><span class="line">LABEL label262 :</span><br><span class="line">  dd := aa</span><br><span class="line">  ee = cp4.key[8+8*dd]</span><br><span class="line">  bb := aa</span><br><span class="line">  bb := bb - 1</span><br><span class="line">  cc = cp4.key[8+8*bb]</span><br><span class="line">  gg := ee - cc</span><br><span class="line">  cp4.key[8+8*aa] = gg             // cp4.key[aa] = cp4.key[aa] - cp4.key[aa-1]</span><br><span class="line">  aa := aa - 1                     // 见（16）</span><br><span class="line">  GOTO label263</span><br><span class="line">LABEL label261 :</span><br><span class="line">  aa := 0</span><br><span class="line">LABEL label272 :</span><br><span class="line">  IF aa &lt; 8</span><br><span class="line">	GOTO label271</span><br><span class="line">  GOTO label270</span><br><span class="line">LABEL label271 :</span><br><span class="line">  bb = cp4.L[200+8*aa]</span><br><span class="line">  dd = cp4.R[264+8*aa]</span><br><span class="line">  ff = cp4.X[328+8*aa]</span><br><span class="line">  cc = cp4.key[8+8*bb]</span><br><span class="line">  ee = cp4.key[8+8*dd]</span><br><span class="line">  cc := cc - ff</span><br><span class="line">  ee := ee + ff</span><br><span class="line">  cp4.key[8+8*bb] = cc            // cp4.key[cp4.L[aa]] = cp4.key[cp4.L[aa]] - cp4.X[aa]</span><br><span class="line">  cp4.key[8+8*dd] = ee            // cp4.key[cp4.R[aa]] = cp4.key[cp4.R[aa]] + cp4.X[aa]</span><br><span class="line">  aa := aa + 1                    // 见（17）</span><br><span class="line">  GOTO label272</span><br><span class="line">LABEL label270 :</span><br><span class="line">  aa := 1</span><br><span class="line">LABEL label283 :</span><br><span class="line">  IF aa &lt; 24 </span><br><span class="line">	GOTO label282</span><br><span class="line">  GOTO label281</span><br><span class="line">LABEL label282 :</span><br><span class="line">  cc = cp4.key[8+8*aa]</span><br><span class="line">  bb := aa - 1</span><br><span class="line">  ff = cp4.key[8+8*bb]</span><br><span class="line">  cc := cc + ff</span><br><span class="line">  cp4.key[8+8*aa] = cc            // cp4.key[aa] = cp4.key[aa] + cp4.key[aa-1]</span><br><span class="line">  aa := aa + 1                    // 见（18）</span><br><span class="line">  GOTO label283</span><br><span class="line">LABEL label281 :</span><br><span class="line">  hh := 0</span><br><span class="line">  kk := 0</span><br><span class="line">  aa := 0</span><br><span class="line">LABEL label292 :</span><br><span class="line">  IF aa &lt; 24 </span><br><span class="line">	GOTO label291</span><br><span class="line">  GOTO label290</span><br><span class="line">LABEL label291 :                           // 比较cp1的key与cp2的key是否相等</span><br><span class="line">  bb := aa</span><br><span class="line">  hh = cp1.key[8+8*aa]</span><br><span class="line">  dd := aa</span><br><span class="line">  kk = cp2.key[8+8*aa]</span><br><span class="line">  IF kk != hh </span><br><span class="line">	GOTO label298</span><br><span class="line">  GOTO label297</span><br><span class="line">LABEL label298 :</span><br><span class="line">  CALL writef</span><br><span class="line">  CALL exit</span><br><span class="line">LABEL label297 :</span><br><span class="line">  aa := aa + 1</span><br><span class="line">  GOTO label292</span><br><span class="line">LABEL label290 :</span><br><span class="line">  CALL writes</span><br><span class="line">  CALL exit</span><br><span class="line">LABEL Flabelmain :</span><br></pre></td></tr></table></figure>
<p>&emsp;使用z3约束器求解即可。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- encoding: utf-8 -*-</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string"># @Time  : 2023/06/17 17:52:54</span></span><br><span class="line"><span class="string"># @Author: wd-2711</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    cp1_key = [Int((<span class="string">&#x27;key_%d&#x27;</span> % i)) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">24</span>)]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 1</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">23</span>):</span><br><span class="line">        i = <span class="number">23</span> - i</span><br><span class="line">        cp1_key[i] -= cp1_key[i-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">    cp1_L = [<span class="number">0</span>,<span class="number">15</span>,<span class="number">2</span>,<span class="number">10</span>,<span class="number">6</span>,<span class="number">9</span>,<span class="number">1</span>,<span class="number">4</span>]</span><br><span class="line">    cp1_R = [<span class="number">8</span>,<span class="number">23</span>,<span class="number">11</span>,<span class="number">20</span>,<span class="number">13</span>,<span class="number">21</span>,<span class="number">19</span>,<span class="number">17</span>]</span><br><span class="line">    cp1_X = [<span class="number">11</span>,-<span class="number">13</span>,<span class="number">17</span>,-<span class="number">19</span>,<span class="number">23</span>,-<span class="number">29</span>,<span class="number">31</span>,-<span class="number">37</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">        cp1_key[cp1_L[i]] += cp1_X[i]</span><br><span class="line">        cp1_key[cp1_R[i]] -= cp1_X[i]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 3</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">23</span>):</span><br><span class="line">        i = i + <span class="number">1</span></span><br><span class="line">        cp1_key[i] += cp1_key[i-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">    cp2_key = [<span class="number">252</span>,<span class="number">352</span>,<span class="number">484</span>,<span class="number">470</span>,<span class="number">496</span>,<span class="number">487</span>,<span class="number">539</span>,<span class="number">585</span>,<span class="number">447</span>,<span class="number">474</span>,<span class="number">577</span>,<span class="number">454</span>,<span class="number">466</span>,<span class="number">345</span>,<span class="number">344</span>,<span class="number">486</span>,<span class="number">501</span>,<span class="number">423</span>,<span class="number">490</span>,<span class="number">375</span>,<span class="number">257</span>,<span class="number">203</span>,<span class="number">265</span>,<span class="number">125</span>]</span><br><span class="line">    cp2_X = [<span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>)]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 9</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">        cp2_X[i] = cp1_key[i*<span class="number">3</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 10</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">23</span>):</span><br><span class="line">        i = <span class="number">23</span> - i</span><br><span class="line">        cp2_key[i] -= cp2_key[i-<span class="number">1</span>]</span><br><span class="line">    <span class="comment"># 11</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">        cp2_key[cp1_L[i]] -= cp2_X[i]</span><br><span class="line">        cp2_key[cp1_R[i]] += cp2_X[i]</span><br><span class="line">    <span class="comment"># 12</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">24</span>):</span><br><span class="line">        cp2_key[i] += cp2_key[i-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 最后要cp1与cp2的key相等</span></span><br><span class="line">    solver = Solver()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">24</span>):</span><br><span class="line">        solver.add(cp1_key[i] == cp2_key[i])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> sat == solver.check():</span><br><span class="line">        m = solver.model()</span><br><span class="line">        res = &#123;&#125;</span><br><span class="line">        <span class="keyword">for</span> d <span class="keyword">in</span> m.decls():</span><br><span class="line">            res[d.name()] = <span class="built_in">int</span>(<span class="built_in">str</span>(m[d]), <span class="number">10</span>)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">24</span>):</span><br><span class="line">            <span class="built_in">print</span>(<span class="built_in">chr</span>(res[<span class="string">&quot;key_&quot;</span> + <span class="built_in">str</span>(i)]), end = <span class="string">&quot;&quot;</span>)</span><br><span class="line"><span class="comment"># sctf&#123;r5cbsumyqpjy0stc7u&#125;</span></span><br></pre></td></tr></table></figure>
<p>&emsp;让s0rry师傅先做出来了，呜呜呜，其实主要是没及时更新协作文档，以后注意！！！今天打了一天，感觉和平时做题的感觉还不一样，就很紧张，之后的stm32也没精力看了。</p>
<h1 id="Digital-circuit-learning"><a href="#Digital-circuit-learning" class="headerlink" title="Digital_circuit_learning"></a>Digital_circuit_learning</h1><p><a target="_blank" rel="noopener" href="https://www.hyun.tech/archives/mcu%E5%8D%95%E7%89%87%E6%9C%BA%E5%9B%BA%E4%BB%B6%E9%80%86%E5%90%91%E5%88%86%E6%9E%90%E5%85%A5%E9%97%A8">参考链接1</a></p>
<p><a target="_blank" rel="noopener" href="https://bbs.kanxue.com/thread-272811.htm">参考链接2</a></p>
<p>&emsp;首先，题目没告诉板子型号，所以直接按最常见的（<code>STM32F103ZET6</code>）进行设置：</p>
<p><img src="/images/SCTF-2023/image-20230621185217510.png" alt="image-20230621185217510" style="zoom:67%;" /></p>
<p><img src="/images/SCTF-2023/image-20230621185255446.png" alt="image-20230621185255446" style="zoom:50%;" /></p>
<p>&emsp;之后，对<code>0x08000000-0x080000EC</code>转为四字节，因为这是中断向量表。且第二个中断向量默认为入口函数。如下所示：</p>
<p><img src="/images/SCTF-2023/image-20230621185524585.png" alt="image-20230621185524585" style="zoom:50%;" /></p>
<p>&emsp;跟进<code>0x8000101</code>，并对<code>0x8000100</code>进行反编译处理，得到：</p>
<p><img src="/images/SCTF-2023/image-20230621185610030.png" alt="image-20230621185610030" style="zoom:67%;" /></p>
<p>&emsp;根据之前的<code>stm-re</code>文章，跟进<code>unk_80000EC</code>。一直跟进，可以找到主函数<code>sub_8001AA0</code>。</p>
<p><img src="/images/SCTF-2023/image-20230621185841369.png" alt="image-20230621185841369" style="zoom:67%;" /></p>
<p><img src="/images/SCTF-2023/image-20230621190016702.png" alt="image-20230621190016702" style="zoom:67%;" /></p>
<p><img src="/images/SCTF-2023/image-20230621190108049.png" alt="image-20230621190108049" style="zoom:67%;" /></p>
<p>&emsp;首先，有很多标红的，例如：</p>
<p><img src="/images/SCTF-2023/image-20230621203458512.png" alt="image-20230621203458512" style="zoom:67%;" /></p>
<p>&emsp;因此，我们要添加SRAM段与Peripherals段（<code>stm-re</code>一文中叙述，用于程序运算时存放变量）。</p>
<p>&emsp;但是没有调试符号，所以按照参考链接2，直接打开正点原子的某个项目（尽可能包含各种库函数）。我打开的是<code>内存分配</code>项目，编译并拿到axf文件，用ida打开，就会得到对应的idb文件。之后用bindiff导入符号（技能Get），但是相似度都不是特别高。打算手动瞅瞅（<code>stm-re</code>一文中叙述，用手册恢复符号）。手动恢复后大概长这样：</p>
<p><img src="/images/SCTF-2023/image-20230622104722404.png" alt="image-20230622104722404" style="zoom:67%;" /></p>
<p>&emsp;接下来就是查看中断函数：</p>
<p><img src="/images/SCTF-2023/image-20230622104651175.png" alt="image-20230622104651175" style="zoom:67%;" /></p>
<p>&emsp;下图为验证代码，其中重点关注<code>0x200000E0</code>中的数据是如何来的。</p>
<p><img src="/images/SCTF-2023/image-20230703121636608.png" alt="image-20230703121636608" style="zoom:67%;" /></p>
<p>&emsp;发现<code>0x200000E0</code>的赋值语句：</p>
<p><img src="/images/SCTF-2023/image-20230703122446627.png" alt="image-20230703122446627" style="zoom:67%;" /></p>
<p>&emsp;其中<code>0x200000BF</code>的来源如下，是来源于输入：</p>
<p><img src="/images/SCTF-2023/image-20230703122558000.png" alt="image-20230703122558000" style="zoom:67%;" /></p>
<p>&emsp;下面看<code>arr2(0x20000024)</code>的来源，可以查找到：</p>
<p><img src="/images/SCTF-2023/image-20230703122907697.png" alt="image-20230703122907697" style="zoom:67%;" /></p>
<p><img src="/images/SCTF-2023/image-20230703123054736.png" alt="image-20230703123054736" style="zoom:67%;" /></p>
<p>&emsp;可以看出，<code>arr2</code>的值是来源于<code>0x8001F68</code>，跟踪一下：</p>
<p><img src="/images/SCTF-2023/image-20230703123857374.png" alt="image-20230703123857374" style="zoom:67%;" /></p>
<p>&emsp;OK，程序大体运行流搞清楚了。</p>
<p>（1）<code>sub_800112C</code>函数给<code>arr2</code>赋值，最终，<code>arr2</code>如下：</p>
<p><code>[0x8001CC1,0x8001D81,0x8001DB5,0x8001DE9,0x8001E1D,0x8001E55,0x8001E95,0x8001ED1,0x8001F0D,0x8001C8D]</code>。</p>
<p>（2）<code>dword_200000E0[2*i] = arr2[i]</code>。</p>
<p>（3）输入为<code>SCTF&#123;xxx&#125;</code>，长度为26，并将中间的<code>xxx</code>赋值给<code>0x2000013A</code>。</p>
<p>（4）对<code>0x2000013A</code>进行如下操作，并将结果赋值给<code>0x20000130</code>。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">for i in range(0, 20, 2):</span><br><span class="line">	if src[i] &lt; &#x27;0&#x27; or src[i] &gt; &#x27;9&#x27;:</span><br><span class="line">		if src[i] &lt; &#x27;a&#x27; or src[i] &gt; &#x27;f&#x27;:</span><br><span class="line">			v5 = 3</span><br><span class="line">		else:</span><br><span class="line">			v5 = src[i] - &#x27;W&#x27;</span><br><span class="line">	else:</span><br><span class="line">		v5 = src[i] - &#x27;0&#x27;</span><br><span class="line">	if src[i+1] &lt; &#x27;0&#x27; or src[i+1] &gt; &#x27;9&#x27;:</span><br><span class="line">		if src[i+1] &lt; &#x27;a&#x27; or src[i+1] &gt; &#x27;f&#x27;:</span><br><span class="line">			v6 = 0</span><br><span class="line">		else:</span><br><span class="line">			v6 = src[i+1] - &#x27;0&#x27;	</span><br><span class="line">	det[i//2] = v6 + 16 * 5</span><br></pre></td></tr></table></figure>
<p>（5）<code>0x20000130</code>赋给<code>0x200000BF</code>，<code>var_4 = &#39;w&#39;</code>，<code>var_2 = 0</code>，<code>var_3=0</code>。</p>
<p>（6）<code>dword_200000E0[2*i+1] = 0x200000BF[i]</code>。</p>
<p>（7）进行如下操作：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">var_3 += 1</span><br><span class="line">for i in range(10):</span><br><span class="line">	assert var_4 == dword_200000E0[2*i+1]</span><br><span class="line">	dword_200000E0[2*i](0x200000BF, 10)</span><br><span class="line">	var_4 = (((var_4 &gt;&gt; 6) &amp; (var_4 &gt;&gt; 2) &amp; 1) == 0) | ((2 * var_4) &amp; 0x7f)</span><br><span class="line">	var_2 += 1</span><br></pre></td></tr></table></figure>
<p>&emsp;如果<code>var_4 == dword_200000E0[2*i+1]</code>一直成立，则输入正确。</p>
<p>&emsp;<code>arr2</code>每个函数的功能如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">sub_8001CC0(a1):</span><br><span class="line">    byte_200000B4[var_2 % 11] = &#x27;a&#x27;</span><br><span class="line">    byte_200000B4[++var_2 % 11] = 0</span><br><span class="line">    if var_2 == 10:</span><br><span class="line">        if sub_8000156(byte_200000B4, &quot;bdgfciejha&quot;):</span><br><span class="line">        	fail</span><br><span class="line">        else:</span><br><span class="line">        	sub_80019E8(0x200000C9, a1, 10)</span><br><span class="line">        	0x200000C9 is flag</span><br><span class="line">sub_8000156(a1, a2):</span><br><span class="line">	i = 0</span><br><span class="line">	while True:</span><br><span class="line">		if a1[i] != a2[i] or !a1[i]:</span><br><span class="line">			break</span><br><span class="line">		i += 1</span><br><span class="line">	return a1[i-1] - a2[i-1]</span><br><span class="line"></span><br><span class="line">sub_8001D80(a1, a2):</span><br><span class="line">    byte_200000B4[var_2 % 11] = &#x27;b&#x27;;</span><br><span class="line">    for i in range(a2):</span><br><span class="line">    	a1[i] -= 1</span><br><span class="line">    	</span><br><span class="line">sub_8001DB4(a1, a2):</span><br><span class="line">    byte_200000B4[var_2 % 11] = &#x27;c&#x27;;</span><br><span class="line">    for i in range(a2):</span><br><span class="line">    	a1[i] += 1</span><br><span class="line">    </span><br><span class="line">sub_8001DE8(a1, a2):</span><br><span class="line">    byte_200000B4[var_2 % 11] = &#x27;d&#x27;;</span><br><span class="line">    for i in range(a2):</span><br><span class="line">    	a1[i] ^= &#x27;5&#x27;</span><br><span class="line">    	</span><br><span class="line">sub_8001E1C(a1, a2):</span><br><span class="line">    byte_200000B4[var_2 % 11] = &#x27;e&#x27;;</span><br><span class="line">    for i in range(a2):</span><br><span class="line">    	a1[i] ^= a1[9-i]</span><br><span class="line"></span><br><span class="line">sub_8001E54(a1, a2):</span><br><span class="line">    byte_200000B4[var_2 % 11] = &#x27;f&#x27;;</span><br><span class="line">    for i in range(a2):</span><br><span class="line">    	a1[i] ^= a1[i+1-a2*((i+1)//a2)]</span><br><span class="line">    	</span><br><span class="line">sub_8001E94(a1, a2)：</span><br><span class="line">    byte_200000B4[var_2 % 11] = &#x27;g&#x27;;</span><br><span class="line">    for i in range(a2):</span><br><span class="line">    	a1[i] = (16 * a1[i]) | (a1[i] &gt;&gt; 4)</span><br><span class="line">    	</span><br><span class="line">sub_8001ED0(a1, a2):</span><br><span class="line">    byte_200000B4[var_2 % 11] = &#x27;h&#x27;;</span><br><span class="line">    for i in range(a2):</span><br><span class="line">    	a1[i] = (a1[i] &lt;&lt; 6) | (a1[i] &gt;&gt; 2)</span><br><span class="line"></span><br><span class="line">sub_8001F0C(a1, a2):</span><br><span class="line">    byte_200000B4[var_2 % 11] = &#x27;i&#x27;;</span><br><span class="line">    for i in range(a2):</span><br><span class="line">    	a1[i] = (a1[i] * 32) | (a1[i] &gt;&gt; 3)</span><br><span class="line">    	</span><br><span class="line">sub_8001C8DA(a1, a2):</span><br><span class="line">    byte_200000B4[var_2 % 11] = &#x27;j&#x27;;</span><br><span class="line">    for i in range(a2):</span><br><span class="line">    	a1[i] ^= 0xF7</span><br></pre></td></tr></table></figure>
<p>&emsp;最后写脚本如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- encoding: utf-8 -*-</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string"># @Time  : 2023/07/03 15:46:03</span></span><br><span class="line"><span class="string"># @Author: wd-2711</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sub_8001CC0</span>(<span class="params">a2</span>):</span><br><span class="line">    res = [<span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">25</span>)]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">20</span>, <span class="number">2</span>):</span><br><span class="line">        <span class="keyword">if</span> (a2[i//<span class="number">2</span>] &amp; <span class="number">0xF</span>) &gt; <span class="number">9</span>:</span><br><span class="line">            res[i+<span class="number">1</span>] = (a2[i//<span class="number">2</span>] &amp; <span class="number">0xF</span>) + <span class="number">87</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            res[i+<span class="number">1</span>] = (a2[i//<span class="number">2</span>] &amp; <span class="number">0xF</span>) + <span class="number">48</span></span><br><span class="line">        <span class="keyword">if</span> (a2[i//<span class="number">2</span>] &gt;&gt; <span class="number">4</span>) &gt; <span class="number">9</span>:</span><br><span class="line">            res[i] = (a2[i//<span class="number">2</span>] &gt;&gt; <span class="number">4</span>) + <span class="number">87</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            res[i] = (a2[i//<span class="number">2</span>] &gt;&gt; <span class="number">4</span>) + <span class="number">48</span></span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sub_8001D80</span>(<span class="params">a1, a2</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(a2):</span><br><span class="line">        a1[i] -= <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> a1</span><br><span class="line">    	</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sub_8001DB4</span>(<span class="params">a1, a2</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(a2):</span><br><span class="line">        a1[i] += <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> a1</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sub_8001DE8</span>(<span class="params">a1, a2</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(a2):</span><br><span class="line">        a1[i] ^= <span class="built_in">ord</span>(<span class="string">&#x27;5&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> a1</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sub_8001E1C</span>(<span class="params">a1, a2</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(a2):</span><br><span class="line">        a1[i] ^= a1[<span class="number">9</span>-i]</span><br><span class="line">    <span class="keyword">return</span> a1</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sub_8001E54</span>(<span class="params">a1, a2</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(a2):</span><br><span class="line">        a1[i] ^= a1[i+<span class="number">1</span>-a2*((i+<span class="number">1</span>)//a2)]</span><br><span class="line">    <span class="keyword">return</span> a1</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sub_8001E94</span>(<span class="params">a1, a2</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(a2):</span><br><span class="line">        a1[i] = (<span class="number">16</span> * a1[i]) | (a1[i] &gt;&gt; <span class="number">4</span>)</span><br><span class="line">        a1[i] = a1[i] &amp; <span class="number">0xff</span></span><br><span class="line">    <span class="keyword">return</span> a1</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sub_8001ED0</span>(<span class="params">a1, a2</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(a2):</span><br><span class="line">        a1[i] = (a1[i] &lt;&lt; <span class="number">6</span>) | (a1[i] &gt;&gt; <span class="number">2</span>)</span><br><span class="line">        a1[i] = a1[i] &amp; <span class="number">0xff</span></span><br><span class="line">    <span class="keyword">return</span> a1</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sub_8001F0C</span>(<span class="params">a1, a2</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(a2):</span><br><span class="line">        a1[i] = (a1[i] * <span class="number">32</span>) | (a1[i] &gt;&gt; <span class="number">3</span>)</span><br><span class="line">        a1[i] &amp;= <span class="number">0xff</span></span><br><span class="line">    <span class="keyword">return</span> a1</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sub_8001C8A</span>(<span class="params">a1, a2</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(a2):</span><br><span class="line">        a1[i] ^= <span class="number">0xF7</span></span><br><span class="line">    <span class="keyword">return</span> a1</span><br><span class="line"></span><br><span class="line">var_4 = [<span class="built_in">ord</span>(<span class="string">&#x27;w&#x27;</span>)]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">10</span>):</span><br><span class="line">    tmp = (((var_4[i-<span class="number">1</span>] &gt;&gt; <span class="number">6</span>) &amp; (var_4[i-<span class="number">1</span>] &gt;&gt; <span class="number">2</span>) &amp; <span class="number">1</span>) == <span class="number">0</span>) | ((<span class="number">2</span> * var_4[i-<span class="number">1</span>]) &amp; <span class="number">0xff</span>)</span><br><span class="line">    var_4.append(tmp)</span><br><span class="line"></span><br><span class="line">origin_200000BF = [<span class="number">0</span>] * <span class="built_in">len</span>(var_4)</span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> <span class="string">&quot;bdgfciejha&quot;</span>:</span><br><span class="line">    origin_200000BF[<span class="built_in">ord</span>(c) - <span class="built_in">ord</span>(<span class="string">&#x27;a&#x27;</span>)] = var_4[i]</span><br><span class="line">    i += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">arr_200000BF = sub_8001D80(origin_200000BF, <span class="number">10</span>)</span><br><span class="line">arr_200000BF = sub_8001DE8(arr_200000BF, <span class="number">10</span>)</span><br><span class="line">arr_200000BF = sub_8001E94(arr_200000BF, <span class="number">10</span>)</span><br><span class="line">arr_200000BF = sub_8001E54(arr_200000BF, <span class="number">10</span>)</span><br><span class="line">arr_200000BF = sub_8001DB4(arr_200000BF, <span class="number">10</span>)</span><br><span class="line">arr_200000BF = sub_8001F0C(arr_200000BF, <span class="number">10</span>)</span><br><span class="line">arr_200000BF = sub_8001E1C(arr_200000BF, <span class="number">10</span>)</span><br><span class="line">arr_200000BF = sub_8001C8A(arr_200000BF, <span class="number">10</span>)</span><br><span class="line">arr_200000BF = sub_8001ED0(arr_200000BF, <span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">res = sub_8001CC0(arr_200000BF)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;SCTF&#123;&quot;</span>, end = <span class="string">&quot;&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> res[:<span class="number">20</span>]:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(i), end = <span class="string">&quot;&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># SCTF&#123;5149ac8b033d602bf6d3&#125;</span></span><br></pre></td></tr></table></figure>
<h1 id="hidden-in-the-network"><a href="#hidden-in-the-network" class="headerlink" title="hidden_in_the_network"></a>hidden_in_the_network</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">你能帮助Sophia找到Christopher吗?</span><br><span class="line">Tips：压缩包中的三个附件几乎是一样的，只是略有不同，只需解决一个就可以了</span><br></pre></td></tr></table></figure>
<p>&emsp;发现是Go语言的64位程序。使用<a target="_blank" rel="noopener" href="https://github.com/0xjiayu/go_parser">Go_parser</a>处理一下（使用的话是<code>alt+F7</code>执行<code>go_parser.py</code>脚本）。报异常<code>Exception: Failed to find firstmoduledata address!</code>，找不到第一个模块的地址。对<code>main_1-&gt;main_4</code>都是这样，且使用<code>bindiff</code>发现函数都是一样的，猜测<code>bindiff</code>只比较两个库的函数，四个文件中在某些代码或数据并不同。使用010editor进行比较，大多都相同。打算先从<code>main_1</code>入手。</p>
<p>&emsp;换了个<code>golang_loader_assist</code>插件，找不到函数。打算先看看<a target="_blank" rel="noopener" href="https://jiayu0x.com/2020/09/28/go-binary-reverse-engineering-tips-and-example/">Go二进制文件逆向分析从基础到进阶(完结篇)</a>。</p>
<p>&emsp;<strong>换成ida7.7，妈的竟然有作用了，也不知道为啥。</strong></p>
<p>&emsp;将<code>main_main_func1</code>与<code>main_main_func2</code>的<code>call runtime_morestack</code>给<code>nop</code>掉，这样就不会反汇编错误了。<code>call runtime_morestack</code>是为了扩展堆栈的，因为被调用函数的堆栈由调用者维护，所以要时常扩展。静态分析中没啥用，所以<code>nop</code>掉了。</p>
<h2 id="0x00-main-1的分析"><a href="#0x00-main-1的分析" class="headerlink" title="0x00 main_1的分析"></a>0x00 main_1的分析</h2><h3 id="main-init-0"><a href="#main-init-0" class="headerlink" title="main_init_0"></a>main_init_0</h3><p>&emsp;首先分析<code>main_init_0</code>：</p>
<p><img src="/images/SCTF-2023/image-20230705104012664.png" alt="image-20230705104012664" style="zoom:67%;" /></p>
<p>&emsp;此函数大概流程如下：</p>
<p>（1）设置命令行参数<code>p</code>、<code>id</code>、<code>username</code>、<code>addrbook</code>、<code>info</code>，并分别赋值给变量<code>var_passwd</code>、<code>var_id</code>、<code>var_username</code>、<code>var_addrbook</code>、<code>var_info</code>。</p>
<h3 id="main-main"><a href="#main-main" class="headerlink" title="main_main"></a>main_main</h3><p>&emsp;之后，分析<code>main_main</code>函数：</p>
<p>（1）对命令行参数使用<code>flag__FlagSet_Parse</code>进行分割，并将参数个数赋值给变量<code>zero</code>（猜测），若参数个数小于5，则直接退出程序。</p>
<p><img src="/images/SCTF-2023/image-20230705104400792.png" alt="image-20230705104400792" style="zoom:67%;" /></p>
<p>（2）使用<code>main_decodeStr</code>对<code>off_8B3B80</code>处长度为<code>0x35</code>的数据使用<code>rc4</code>解密。注意，<code>main_decodeStr</code>默认密钥为：<code>[0xFF, 0xEE, 0xDD, 0xCC, 0xBB, 0xAA, 0x99, 0x88, 0x77, 0x66, 0x55, 0x44, 0x33, 0x22, 0x11, 0]</code>。并使用<code>net_http__Client_Get</code>函数对<code>url=off_8B3B80_decode||var_username</code>进行访问。</p>
<p><img src="/images/SCTF-2023/image-20230705104531996.png" alt="image-20230705104531996" style="zoom:67%;" /></p>
<p>（3）若返回值<code>resp</code>的状态码不为200，则直接进入解析<code>addrbook</code>环节。否则，则进入<code>main_handleInfoOK</code>函数，解析<code>resp.body</code>。</p>
<p><img src="/images/SCTF-2023/image-20230705104910177.png" alt="image-20230705104910177" style="zoom:67%;" /></p>
<p>（4）判断是否有<code>var_addrbook</code>这个参数，如果没有，则进入（8）；否则，进入（5），以解析<code>addrbook</code>参数。</p>
<p><img src="/images/SCTF-2023/image-20230705110745033.png" alt="image-20230705110745033" style="zoom:67%;" /></p>
<p>（5）使用<code>main_decodeStr</code>，对<code>off_8B3B20</code>的<code>0x45</code>个字节解密。这是一个格式字符串，在其中添加<code>var_id</code>与<code>var_passwd</code>（<code>var_passwd</code>取前5位），并将其作为一个<code>url</code>，使用<code>net_http_Client_Get</code>访问。</p>
<p><img src="/images/SCTF-2023/image-20230705111010789.png" alt="image-20230705111010789" style="zoom:67%;" /></p>
<p>（6）使用<code>main_handleAddrBookOK</code>函数对<code>resp.body</code>进行解析。</p>
<p>（7）运行<code>main_main_func2</code>函数，此函数运行逻辑如下：</p>
<p>&emsp;&emsp;（a）执行<code>resp_body_for_addrbook+18h</code>。</p>
<p>（8）运行<code>main_main_func1</code>函数。</p>
<p>&emsp;&emsp;（a）执行<code>resp_body_for_userInfo+18h</code>。</p>
<h3 id="main-handleInfoOK"><a href="#main-handleInfoOK" class="headerlink" title="main_handleInfoOK"></a>main_handleInfoOK</h3><p>&emsp;此函数逻辑如下：</p>
<p>（1）调用<code>main_decryptoJSONByte</code>对<code>resp.body</code>做解密。（下面子流程是<code>main_decryptoJSONByte</code>的步骤）</p>
<p>&emsp;&emsp;（a）使用<code>main_decodeStr</code>对<code>off_8B3BA0</code>处长度为<code>0x8</code>的数据使用<code>rc4</code>解密。</p>
<p>&emsp;&emsp;（b）将步骤（a）解密出的数据当作<code>rc4</code>密钥，对<code>resp.body</code>做解密。</p>
<p>（2）将<code>resp.body</code>结构化，最终可以获得：<code>&#123;ID:xx,Name:xx,Phone:xxx,Msg:xxx&#125;</code>。</p>
<p><img src="/images/SCTF-2023/image-20230705110121543.png" alt="image-20230705110121543" style="zoom:67%;" /></p>
<p>（3）使用<code>main_decodeStr</code>，分别对<code>off_8B3BC0</code>、<code>off_8B3BE0</code>、<code>off_8B3C00</code>、<code>off_8B3B60</code>处长度为<code>8</code>、<code>10</code>、<code>11</code>、<code>14</code>的数据使用<code>rc4</code>解密，并将结果打印到终端。</p>
<h3 id="main-handleAddrBookOK"><a href="#main-handleAddrBookOK" class="headerlink" title="main_handleAddrBookOK"></a>main_handleAddrBookOK</h3><p>&emsp;此函数逻辑如下：</p>
<p>（1）与<code>main_handleInfoOK</code>的第1步相同。</p>
<p>（2）将<code>resp.body</code>结构化，最终可以获得：<code>&#123;Phones:xxx&#125;</code>。</p>
<p>（3）使用<code>main_decodeStr</code>，分别对<code>off_8B3B40</code>处长度为<code>0x20</code>的数据使用<code>rc4</code>解密，并将结果打印到终端。</p>
<h2 id="0x01-题目思路"><a href="#0x01-题目思路" class="headerlink" title="0x01 题目思路"></a>0x01 题目思路</h2><p>&emsp;可以通过A查到B，然后从B查到C。那么我们就能得到：A如何查找到C，即Sophia到Christopher。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 输出st-&gt;ed的字节数据</span></span><br><span class="line"><span class="keyword">import</span> idc</span><br><span class="line">st = <span class="number">0x883C80</span></span><br><span class="line">ed = <span class="number">0x883CB5</span></span><br><span class="line"><span class="keyword">for</span> addr <span class="keyword">in</span> <span class="built_in">range</span>(st, ed):</span><br><span class="line">    byte_data = idc.get_wide_byte(addr)</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">hex</span>(byte_data), end = <span class="string">&quot; &quot;</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- encoding: utf-8 -*-</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string"># @Time  : 2023/07/05 13:16:59</span></span><br><span class="line"><span class="string"># @Author: wd-2711</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">userinfo = [<span class="number">0xed</span>,<span class="number">0x2f</span>,<span class="number">0xd8</span>,<span class="number">0x27</span>,<span class="number">0xa8</span>,<span class="number">0x8</span>,<span class="number">0x4e</span>,<span class="number">0xb4</span>,<span class="number">0xc1</span>,<span class="number">0x69</span>,<span class="number">0x97</span>,<span class="number">0x2</span>,<span class="number">0xa7</span>,<span class="number">0x6b</span>,<span class="number">0x4f</span>,<span class="number">0xa7</span>,<span class="number">0x39</span>,<span class="number">0xeb</span>,<span class="number">0xa1</span>,<span class="number">0x63</span>,<span class="number">0x92</span>,<span class="number">0x2d</span>,<span class="number">0xb3</span>,<span class="number">0x1e</span>,<span class="number">0x58</span>,<span class="number">0x91</span>,<span class="number">0x24</span>,<span class="number">0x10</span>,<span class="number">0x3e</span>,<span class="number">0x91</span>,<span class="number">0x88</span>,<span class="number">0x7a</span>,<span class="number">0x2a</span>,<span class="number">0xf5</span>,<span class="number">0x9a</span>,<span class="number">0xdc</span>,<span class="number">0x75</span>,<span class="number">0x45</span>,<span class="number">0xe0</span>,<span class="number">0x43</span>,<span class="number">0xdf</span>,<span class="number">0x11</span>,<span class="number">0xf7</span>,<span class="number">0x7d</span>,<span class="number">0x58</span>,<span class="number">0x14</span>,<span class="number">0x19</span>,<span class="number">0x8c</span>,<span class="number">0x3a</span>,<span class="number">0x40</span>,<span class="number">0xd</span>,<span class="number">0x6e</span>,<span class="number">0x7e</span>]</span><br><span class="line">userinfo = <span class="built_in">bytes</span>(<span class="built_in">bytearray</span>(userinfo))</span><br><span class="line"></span><br><span class="line">addrbook = [<span class="number">0xed</span>,<span class="number">0x2f</span>,<span class="number">0xd8</span>,<span class="number">0x27</span>,<span class="number">0xa8</span>,<span class="number">0x8</span>,<span class="number">0x4e</span>,<span class="number">0xb4</span>,<span class="number">0xc1</span>,<span class="number">0x69</span>,<span class="number">0x97</span>,<span class="number">0x2</span>,<span class="number">0xa7</span>,<span class="number">0x6b</span>,<span class="number">0x4f</span>,<span class="number">0xa7</span>,<span class="number">0x39</span>,<span class="number">0xeb</span>,<span class="number">0xa1</span>,<span class="number">0x63</span>,<span class="number">0x92</span>,<span class="number">0x2d</span>,<span class="number">0xb3</span>,<span class="number">0x1e</span>,<span class="number">0x58</span>,<span class="number">0x91</span>,<span class="number">0x24</span>,<span class="number">0x1f</span>,<span class="number">0x24</span>,<span class="number">0x89</span>,<span class="number">0x8f</span>,<span class="number">0x32</span>,<span class="number">0x30</span>,<span class="number">0xf3</span>,<span class="number">0xda</span>,<span class="number">0xde</span>,<span class="number">0x67</span>,<span class="number">0x44</span>,<span class="number">0xf6</span>,<span class="number">0x58</span>,<span class="number">0xd4</span>,<span class="number">0x4</span>,<span class="number">0xeb</span>,<span class="number">0x20</span>,<span class="number">0x42</span>,<span class="number">0x8</span>,<span class="number">0x17</span>,<span class="number">0xc1</span>,<span class="number">0x21</span>,<span class="number">0x52</span>,<span class="number">0x5</span>,<span class="number">0x79</span>,<span class="number">0x2a</span>,<span class="number">0xdc</span>,<span class="number">0x95</span>,<span class="number">0x9d</span>,<span class="number">0xc5</span>,<span class="number">0x59</span>,<span class="number">0x20</span>,<span class="number">0xc0</span>,<span class="number">0xc2</span>,<span class="number">0xf4</span>,<span class="number">0x69</span>,<span class="number">0xaf</span>,<span class="number">0x60</span>,<span class="number">0x97</span>,<span class="number">0x9f</span>,<span class="number">0x76</span>,<span class="number">0x25</span>]</span><br><span class="line">addrbook = <span class="built_in">bytes</span>(<span class="built_in">bytearray</span>(addrbook))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main_decode_str</span>(<span class="params">data</span>):</span><br><span class="line">    key = [<span class="number">0xFF</span>, <span class="number">0xEE</span>, <span class="number">0xDD</span>, <span class="number">0xCC</span>, <span class="number">0xBB</span>, <span class="number">0xAA</span>, <span class="number">0x99</span>, <span class="number">0x88</span>, <span class="number">0x77</span>, <span class="number">0x66</span>, <span class="number">0x55</span>, <span class="number">0x44</span>, <span class="number">0x33</span>, <span class="number">0x22</span>, <span class="number">0x11</span>, <span class="number">0</span>]</span><br><span class="line">    key = key[::-<span class="number">1</span>]</span><br><span class="line">    key = <span class="built_in">bytearray</span>(key)</span><br><span class="line">    key = <span class="built_in">bytes</span>(key)</span><br><span class="line">    enc = ARC4.new(key)</span><br><span class="line">    res = enc.decrypt(data)</span><br><span class="line">    res = <span class="built_in">str</span>(res,<span class="string">&#x27;gbk&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(main_decode_str(userinfo))</span><br><span class="line"><span class="built_in">print</span>(main_decode_str(addrbook))</span><br><span class="line"></span><br><span class="line"><span class="comment"># http://190.92.230.233:8080/nologin/userinfo?username=</span></span><br><span class="line"><span class="comment"># http://190.92.230.233:8080/auth/showaddressbook?userid=%d&amp;password=%s</span></span><br></pre></td></tr></table></figure>
<p>&emsp;由于<code>http://190.92.230.233:8080</code>已无法访问，因此无法进行下去。考虑接下来的步骤：</p>
<p>（1）访问<code>http://190.92.230.233:8080/nologin/userinfo?username=sophia</code>，并解析，获得其<code>ID,name,phone,Msg</code>。之后，访问<code>http://190.92.230.233:8080/auth/showaddressbook?userid=sophia.id&amp;password=xxx</code>，由于<code>password</code>共5位，因此可以遍历获得密码，从而获得<code>sophia</code>的<code>addrbook</code>。</p>
<p>（2）类似（1）的方法，最终找到<code>christopher</code>，猜测在其<code>Msg</code>信息中就有其<code>flag</code>。</p>
<h2 id="0x02-Nu1L’s-WP"><a href="#0x02-Nu1L’s-WP" class="headerlink" title="0x02 Nu1L’s WP"></a>0x02 Nu1L’s WP</h2><p>&emsp;真实的解题步骤更加复杂。</p>
<p>（1）使用<code>sqlmap</code>可以发现<code>http://190.92.230.233:8080/nologin/userinfo?username=xx</code>存在<code>sql</code>注入，爆破得到所有用户的信息（共50个）。</p>
<p>（2）爆破所有用户的密码，从而获得所有用户的<code>addrbook</code>。</p>
<p>（3）使用<code>nx.Graph</code>，画出社交关系图。并使用<code>nx.dijkstra_path</code>找出最短路径。最终，<code>flag=sctf&#123;md5(path)&#125;</code>。<strong>但是我猜测，其实就是用<code>main1-4</code>一个一个找。</strong></p>
<h1 id="checkFlow"><a href="#checkFlow" class="headerlink" title="checkFlow"></a>checkFlow</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input the flow to test the channel.（输入流量以测试通道）</span><br><span class="line">flag format:sctf&#123;Caps MD5&#125;（flag格式：`sctf&#123;Caps MD5&#125;`）</span><br></pre></td></tr></table></figure>
<p>&emsp;64位ELF。显示为ABI。<strong>Linux ABI 4.4.0 定义了许多与操作系统交互的规则，包括系统调用（system call）的参数和返回值、函数调用的参数和返回值、异常处理、动态链接等方面的内容。它规定了二进制可执行文件应该如何与操作系统进行交互，从而实现二进制兼容性。</strong>猜测类似于一个linux的dll库（其实这种猜测是不准确的，具体看<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/386106883">什么是ABI</a>，简略说：ABI是一组规则，规定了数据类型占几个字节、函数调用传哪些参数等），运行之后则是一个真实程序（要求输入<code>Flow</code>，并作检查）。因此，猜测此文件与linux的交互都用api实现了，并静态编译到此文件中。</p>
<p>&emsp;经过好几天的分析，这个还挺麻烦的，主要是没有符号表，所有函数都得手动看。总结一下这个题目的流程：</p>
<p>（1）输入长度为<code>12</code>的整数倍的0/1字符串。字符串<code>c=&#39;000000000000&#39;</code>。</p>
<p>（2）每次取12位字符<code>str</code>，之后<code>check_1</code>检验，若函数返回<code>0</code>则失败。</p>
<p>（3）<code>v23 = -1 or func_2(c)</code>。</p>
<p>（4）若<code>v23 &gt;= func_2(str)</code>，则失败。</p>
<p>（5）再次做检验，重点函数为<code>sub_4070E1</code>和<code>check_1</code>。如下所示：</p>
<p><img src="/images/SCTF-2023/image-20230710204205159.png" alt="image-20230710204205159" style="zoom:67%;" /></p>
<p>（6）当马上到字符串结尾时，再次做检验，如下所示：</p>
<p><img src="/images/SCTF-2023/image-20230710204246862.png" alt="image-20230710204246862" style="zoom:67%;" /></p>
<p>&emsp;此题的逻辑不难，难的是函数的分析，其中<code>sub_4070E1</code>与<code>check_1</code>函数很难分析，里面层层嵌套，非常容易令人混乱。<code>wp</code>如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- encoding: utf-8 -*-</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string"># @Time  : 2023/07/10 20:34:43</span></span><br><span class="line"><span class="string"># @Author: wd-2711</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func_2</span>(<span class="params">str1</span>):</span><br><span class="line">    res = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0xC</span>, <span class="number">0</span>, -<span class="number">1</span>):</span><br><span class="line">        <span class="keyword">if</span> str1[<span class="number">0xC</span>-i] == <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">            res |= (<span class="number">1</span>&lt;&lt;((i-<span class="number">1</span>)&amp;<span class="number">0x3F</span>))</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sub_4070E1</span>(<span class="params">str1, j</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">count_head_zero</span>(<span class="params">j</span>):</span><br><span class="line">        <span class="keyword">if</span> j == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0xC</span></span><br><span class="line">        j = <span class="built_in">bin</span>(j)[::-<span class="number">1</span>]</span><br><span class="line">        cnt = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> jj <span class="keyword">in</span> j:</span><br><span class="line">            <span class="keyword">if</span> jj == <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">elif</span> jj == <span class="string">&#x27;0&#x27;</span>:</span><br><span class="line">                cnt += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> cnt</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">sub_4087C6</span>(<span class="params">j, i</span>):</span><br><span class="line">        <span class="keyword">if</span> i+<span class="number">1</span> &gt; <span class="number">0x3F</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0xC</span></span><br><span class="line">        <span class="keyword">if</span> j&gt;&gt;(i+<span class="number">1</span>) == <span class="number">0</span>: </span><br><span class="line">            <span class="keyword">return</span> <span class="number">0xC</span></span><br><span class="line">        <span class="keyword">return</span> count_head_zero(j&gt;&gt;(i+<span class="number">1</span>))+(i+<span class="number">1</span>)</span><br><span class="line">   </span><br><span class="line">    j = j &amp; <span class="number">0xfff</span></span><br><span class="line">    str1 = <span class="string">&quot;000000000000&quot;</span></span><br><span class="line">    result = count_head_zero(j)</span><br><span class="line">    i = result</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">if</span> i &gt; <span class="number">0xB</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        str1 = str1[:<span class="number">0xB</span>-i] + <span class="string">&#x27;1&#x27;</span> + str1[<span class="number">0xB</span>-i+<span class="number">1</span>:]</span><br><span class="line">        result = sub_4087C6(j, i)</span><br><span class="line">        i = result</span><br><span class="line">    <span class="keyword">return</span> str1</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_1</span>(<span class="params">inp</span>):</span><br><span class="line">    inp = [<span class="built_in">ord</span>(i) - <span class="number">48</span> <span class="keyword">for</span> i <span class="keyword">in</span> inp]</span><br><span class="line">    arr1 = [</span><br><span class="line">        [<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>,],</span><br><span class="line">        [<span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>,],</span><br><span class="line">        [<span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>,],</span><br><span class="line">        [<span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>,],</span><br><span class="line">        [<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>,],</span><br><span class="line">        [<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>,],</span><br><span class="line">        [<span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>,],</span><br><span class="line">        [<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>,],</span><br><span class="line">        [<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>,],</span><br><span class="line">        [<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>,],</span><br><span class="line">        [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>,],</span><br><span class="line">        [<span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>,], </span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    out = [<span class="number">0</span>] * <span class="number">6</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6</span>):</span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0xC</span>):</span><br><span class="line">            out[j] ^= (arr1[k][j]&amp;inp[k])</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">sum</span>(out) == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_inps</span>():</span><br><span class="line">    res = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0xfff</span>+<span class="number">1</span>):</span><br><span class="line">        binary_string = <span class="built_in">bin</span>(i)[<span class="number">2</span>:]</span><br><span class="line">        bit_array = [<span class="built_in">int</span>(bit) <span class="keyword">for</span> bit <span class="keyword">in</span> binary_string]</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(bit_array) &lt; <span class="number">0xC</span>:</span><br><span class="line">            bit_array = [<span class="number">0</span>]*(<span class="number">0xC</span>-<span class="built_in">len</span>(bit_array)) + bit_array</span><br><span class="line">        bit_array = <span class="string">&quot;&quot;</span>.join(<span class="built_in">str</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> bit_array)</span><br><span class="line">        res.append(bit_array)</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_length</span>(<span class="params">leng</span>):</span><br><span class="line">    res = <span class="string">&quot;&quot;</span></span><br><span class="line">    inps = generate_inps()</span><br><span class="line">    c = <span class="string">&quot;000000000000&quot;</span></span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">for</span> inp <span class="keyword">in</span> inps:</span><br><span class="line">            f = i</span><br><span class="line">            <span class="keyword">if</span> f &gt;= leng:</span><br><span class="line">                <span class="keyword">return</span> <span class="number">1</span>, res</span><br><span class="line">            a = inp</span><br><span class="line">            b = a</span><br><span class="line">            <span class="keyword">if</span> check_1(a) == <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">continue</span>   </span><br><span class="line">            <span class="keyword">if</span> i:</span><br><span class="line">                g = func_2(c)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                g = -<span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> g &gt;= func_2(a):</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            j = g + <span class="number">1</span></span><br><span class="line">            wrong = <span class="number">0</span></span><br><span class="line">            <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">                a = b</span><br><span class="line">                <span class="keyword">if</span> j &gt;= func_2(a):</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                a = sub_4070E1(a, j)</span><br><span class="line">                <span class="keyword">if</span> check_1(a):</span><br><span class="line">                    wrong = <span class="number">1</span></span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                j += <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> wrong == <span class="number">0</span>:</span><br><span class="line">                res += inp </span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">if</span> i + <span class="number">12</span> == leng:</span><br><span class="line">                a = b</span><br><span class="line">                e = func_2(a) + <span class="number">1</span></span><br><span class="line">                <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">                    a = <span class="string">&quot;111111111111&quot;</span></span><br><span class="line">                    <span class="keyword">if</span> func_2(a) &lt; e:</span><br><span class="line">                        <span class="keyword">break</span></span><br><span class="line">                    a = sub_4070E1(a, e)</span><br><span class="line">                    <span class="keyword">if</span> check_1(a):</span><br><span class="line">                        <span class="keyword">return</span> <span class="number">0</span>, <span class="literal">None</span></span><br><span class="line">                    e += <span class="number">1</span></span><br><span class="line">            c = b</span><br><span class="line">            i += <span class="number">12</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">1000</span>):</span><br><span class="line">        suc, res = test_length(<span class="number">12</span> * i)</span><br><span class="line">        <span class="keyword">if</span> suc == <span class="number">1</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;success length&quot;</span>, <span class="number">12</span> * i)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;res&quot;</span>, res)</span><br><span class="line">            m = hashlib.md5()</span><br><span class="line">            m.update(res.encode())</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;flag is&quot;</span>, m.hexdigest())</span><br><span class="line"><span class="comment"># success 768</span></span><br><span class="line"><span class="comment"># res 000000000000000001011111000010100011000011111100000100000111000101011000000110100100000111111011001000110010001001101101001010010001001011001110001100110101001101101010001110010110001111001001010000010101010001001010010010110110010011101001010100010010010101001101010110110001010111101110011000100111011001111000011010000100011011011011011100100000011101111111011110000011011111011100100000100011100001111100100010000000100011011111100100100100100101111011100110000111100111011000101000010001101001001110101010110010101011101101101100010110101101001001101110110101101111101010110000110110110001101001110010010101110011001010110100110001110101101110110110010010110111001101111000000100111001011011111010100111111011111000111100000011111101011100111110100000111111111111</span></span><br><span class="line"><span class="comment"># flag is 7bc821b13f8f9f7c043012b6a2a2ece0</span></span><br></pre></td></tr></table></figure>
<p>&emsp;<code>W&amp;M</code>没做出来，<code>Nu1L</code>是用<code>frida</code>做的，没太看懂。感觉是用<code>frida</code>动调，使用程序自己的函数。将字符串输入，检验<code>flag</code>是否正确：</p>
<p><img src="/images/SCTF-2023/image-20230710204725957.png" alt="image-20230710204725957" style="zoom:67%;" /></p>
<p>&emsp;可以发现，没有报错，因此0/1字符串正确。</p>
<h1 id="SycLock"><a href="#SycLock" class="headerlink" title="SycLock"></a>SycLock</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">题目flag为：flag&#123;password0+password1+password2&#125;</span><br><span class="line">这是一个恶意app，尽量跑在模拟器或调试机上(&gt;=Android5.0)，必要时通过adb uninstall packagename卸载。此app仅供本次比赛使用，不要随意转发给他人。</span><br><span class="line">点击后等待30s左右便会开始锁机，测过Android7模拟器，Android10 pixel2真机，均可正常运行。</span><br><span class="line">玩的愉快。</span><br></pre></td></tr></table></figure>
<h2 id="0x00-level0"><a href="#0x00-level0" class="headerlink" title="0x00 level0"></a>0x00 level0</h2><p>&emsp;审计代码，其重点如下：</p>
<p><img src="/images/SCTF-2023/image-20230712215309522.png" alt="image-20230712215309522" style="zoom:67%;" /></p>
<p>&emsp;此程序逻辑为：将原始<code>level0.jar</code>中的数据，使用<code>writeFileFromIS</code>函数处理，并重新写入到<code>level0.jar</code>中，之后调用<code>level0.jar</code>中的<code>Check.docheck</code>函数，参数为<code>password0=xxx</code>。<code>writeFileFromIS</code>函数逻辑如下：</p>
<p><img src="/images/SCTF-2023/image-20230712215558686.png" alt="image-20230712215558686" style="zoom:67%;" /></p>
<p>&emsp;是一个简单的异或，最终可以得到<code>level0_decode.jar</code>。其重要代码如下：</p>
<p><img src="/images/SCTF-2023/image-20230712215822726.png" alt="image-20230712215822726" style="zoom:67%;" /></p>
<p><img src="/images/SCTF-2023/image-20230712215859429.png" alt="image-20230712215859429" style="zoom:67%;" /></p>
<p>&emsp;不知道是什么加密算法（<code>RC4</code>？），反正最终遍历就可以得到<code>password0=good</code>。</p>
<h2 id="0x01-level1"><a href="#0x01-level1" class="headerlink" title="0x01 level1"></a>0x01 level1</h2><p><img src="/images/SCTF-2023/image-20230712220024834.png" alt="image-20230712220024834" style="zoom:67%;" /></p>
<p>&emsp;其中，<code>level1check</code>函数是从<code>liblevel1.so</code>中导入的。</p>
<p><img src="/images/SCTF-2023/image-20230712220306335.png" alt="image-20230712220306335" style="zoom:67%;" /></p>
<p>&emsp;<code>buildTree</code>函数是构建一个哈夫曼树，其逻辑如下：</p>
<p>（1）统计<code>reverseisfun</code>字符串出现频次，并按照26个英文字母先后顺序来排序。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">e:3</span><br><span class="line">f:1</span><br><span class="line">i:1</span><br><span class="line">n:1</span><br><span class="line">r:2</span><br><span class="line">s:2</span><br><span class="line">u:1</span><br><span class="line">v:1</span><br></pre></td></tr></table></figure>
<p>（2）之后将出现频次按顺序压入到一个<code>sortqueue</code>，最终可以得到：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">v:1 -&gt; u:1 -&gt; n:1 -&gt; i:1 -&gt; f:1 -&gt; s:2 -&gt; r:2 -&gt; e:3</span><br></pre></td></tr></table></figure>
<p>（3）每次取出<code>sortqueue</code>的头两个元素，第一个元素为左节点，第二个元素为右节点，把这两个节点合并，并重新压入<code>sortqueue</code>。</p>
<p>（4）最终可以得到哈夫曼树如下（其中<code>traversetree</code>用于给树的叶子节点添加诸如<code>00/0110</code>的路径符号）：</p>
<p><img src="/images/SCTF-2023/image-20230712221853222.png" alt="image-20230712221853222" style="zoom:67%;" /></p>
<p>&emsp;得到此树之后，由于要匹配<code>110111110001100</code>，因此可以得到<code>password1=userv</code></p>
<h2 id="0x02-level2"><a href="#0x02-level2" class="headerlink" title="0x02 level2"></a>0x02 level2</h2><p><img src="/images/SCTF-2023/image-20230712222253893.png" alt="image-20230712222253893" style="zoom:67%;" /></p>
<p><img src="/images/SCTF-2023/image-20230712222322098.png" alt="image-20230712222322098" style="zoom:67%;" /></p>
<p>&emsp;上述逻辑为：将输入写入到<code>/level2input</code>文件中，并通过<code>check</code>（并未体现），检查生成的<code>/judge</code>文件中是否包含<code>success</code>，若有则挑战成功。</p>
<p>&emsp;那<code>check()</code>体现在哪里呢？体现在<code>LoadLibrary(&quot;level2&quot;)</code>那里。在导入<code>liblevel2.so</code>库时，默认会自动运行<code>JNI_OnLoad</code>方法，如下图所示：</p>
<p><img src="/images/SCTF-2023/image-20230712222702441.png" alt="image-20230712222702441" style="zoom:67%;" /></p>
<p>&emsp;跟进<code>socketThread</code>，可以跟进到<code>extractLevel2</code>函数。</p>
<p><img src="/images/SCTF-2023/image-20230712222813332.png" alt="image-20230712222813332" style="zoom:67%;" /></p>
<p>&emsp;其中<code>extract</code>是提取<code>level2.jar</code>所用，跟进：</p>
<p><img src="/images/SCTF-2023/image-20230712223157860.png" alt="image-20230712223157860" style="zoom:67%;" /></p>
<p>&emsp;可以发现，此函数读取<code>liblevel2.so</code>的最后4个字节，作为长度<code>size</code>。读取最后20到最后4字节，作为<code>xxtea</code>解密的<code>key</code>。读取最后<code>[-52-size, -52]</code>的字节，作为要解密的数据。最终将解密后的数据存入到<code>level2.jar</code>中。</p>
<p>&emsp;按照上述流程进行操作，可以得到<code>level2.jar</code>，如下所示：</p>
<p><img src="/images/SCTF-2023/image-20230712223448237.png" alt="image-20230712223448237" style="zoom:67%;" /></p>
<p>&emsp;可以得到<code>password2=4ndroidisfun</code>。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- encoding: utf-8 -*-</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string"># @Time  : 2023/07/12 21:39:58</span></span><br><span class="line"><span class="string"># @Author: wd-2711</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line"><span class="keyword">from</span> ctypes <span class="keyword">import</span> c_uint32</span><br><span class="line"></span><br><span class="line"><span class="comment"># challenge0</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">challenge0</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">decode_level0</span>():</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;C:\\Users\\23957\\Desktop\\Syclock\\level0jar&quot;</span>, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            d = f.read()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;C:\\Users\\23957\\Desktop\\Syclock\\level0_decode.jar&quot;</span>, <span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            <span class="keyword">for</span> dd <span class="keyword">in</span> d:</span><br><span class="line">                inp = dd ^ <span class="number">52</span></span><br><span class="line">                f.write(inp.to_bytes(<span class="number">1</span>, <span class="string">&#x27;little&#x27;</span>))</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">change</span>(<span class="params">a1, a2</span>):</span><br><span class="line">        <span class="keyword">return</span> a2, a1</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_flag</span>():</span><br><span class="line">        plain = <span class="string">&quot;flag&#123;this_is_fake_flag&#125;&quot;</span></span><br><span class="line">        cipher = [<span class="number">24</span>, <span class="number">0xF8</span>, <span class="number">37</span>, <span class="number">0x86</span>, <span class="number">70</span>, <span class="number">16</span>, <span class="number">0x92</span>, <span class="number">0xDA</span>, <span class="number">0xD3</span>, <span class="number">0x89</span>, <span class="number">0xF4</span>, <span class="number">4</span>, <span class="number">0x7E</span>, <span class="number">0xB3</span>, <span class="number">0xF7</span>, <span class="number">92</span>, <span class="number">206</span>, <span class="number">77</span>, <span class="number">0xAF</span>, <span class="number">34</span>, <span class="number">0x7A</span>, <span class="number">14</span>, <span class="number">0x9E</span>]</span><br><span class="line">        v6 = [i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x100</span>)]</span><br><span class="line">        <span class="keyword">for</span> k0 <span class="keyword">in</span> tqdm(<span class="built_in">range</span>(<span class="number">32</span>,<span class="number">128</span>)):</span><br><span class="line">            <span class="keyword">for</span> k1 <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>,<span class="number">128</span>):</span><br><span class="line">                <span class="keyword">for</span> k2 <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>,<span class="number">128</span>):</span><br><span class="line">                    <span class="keyword">for</span> k3 <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>,<span class="number">128</span>):   </span><br><span class="line">                        k = [k0, k1, k2, k3]</span><br><span class="line">                        tmp = <span class="number">0</span></span><br><span class="line">                        v3 = [k[i%<span class="number">4</span>] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x100</span>)]</span><br><span class="line">                        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">                            tmp = (v6[i] + tmp + v3[i]) &amp; <span class="number">0xff</span></span><br><span class="line">                            v6[i], v6[tmp] = change(v6[i], v6[tmp])</span><br><span class="line">                        i = <span class="number">0</span></span><br><span class="line">                        out = [<span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">23</span>)]</span><br><span class="line">                        tmp = <span class="number">0</span></span><br><span class="line">                        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">23</span>):</span><br><span class="line">                            i = (i + <span class="number">1</span>) &amp; <span class="number">0xff</span></span><br><span class="line">                            tmp = (tmp + v6[i]) &amp; <span class="number">0xff</span></span><br><span class="line">                            v6[i], v6[tmp] = change(v6[i], v6[tmp])</span><br><span class="line">                            out[j] = <span class="built_in">ord</span>(plain[j])^v6[(v6[i]+v6[tmp])&amp;<span class="number">0xff</span>]^<span class="number">18</span></span><br><span class="line">                        eq = <span class="number">1</span></span><br><span class="line">                        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">23</span>):</span><br><span class="line">                            <span class="keyword">if</span> out[i] != cipher[i]:</span><br><span class="line">                                eq = <span class="number">0</span></span><br><span class="line">                                <span class="keyword">break</span></span><br><span class="line">                        <span class="keyword">if</span> eq == <span class="number">1</span>:</span><br><span class="line">                            <span class="built_in">print</span>(<span class="built_in">chr</span>(k), end = <span class="string">&quot;&quot;</span>)</span><br><span class="line">                        v6 = [i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x100</span>)]</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;challenge0_flag:&quot;</span>, end = <span class="string">&quot;&quot;</span>)</span><br><span class="line">    get_flag()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># challenge1</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">challenge1</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;challenge2_flag:&quot;</span>, end = <span class="string">&quot;&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;userv&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># challenge2</span></span><br><span class="line">DELTA = <span class="number">0x9E3779B9</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">v, n, k</span>):</span><br><span class="line">    rounds = <span class="number">6</span> + <span class="built_in">int</span>(<span class="number">52</span> / n)</span><br><span class="line">    <span class="built_in">sum</span> = c_uint32(<span class="number">0</span>)</span><br><span class="line">    z = v[n - <span class="number">1</span>].value</span><br><span class="line">    <span class="keyword">while</span> rounds &gt; <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">sum</span>.value += DELTA</span><br><span class="line">        e = (<span class="built_in">sum</span>.value &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span></span><br><span class="line">        p = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> p &lt; n - <span class="number">1</span>:</span><br><span class="line">            y = v[p + <span class="number">1</span>].value</span><br><span class="line">            v[p].value += (((z &gt;&gt; <span class="number">5</span> ^ y &lt;&lt; <span class="number">2</span>) + (y &gt;&gt; <span class="number">3</span> ^ z &lt;&lt; <span class="number">4</span>)) ^ ((<span class="built_in">sum</span>.value ^ y) + (k[(p &amp; <span class="number">3</span>) ^ e] ^ z)))</span><br><span class="line">            z = v[p].value</span><br><span class="line">            p += <span class="number">1</span></span><br><span class="line">        y = v[<span class="number">0</span>].value</span><br><span class="line">        v[n - <span class="number">1</span>].value += (((z &gt;&gt; <span class="number">5</span> ^ y &lt;&lt; <span class="number">2</span>) + (y &gt;&gt; <span class="number">3</span> ^ z &lt;&lt; <span class="number">4</span>)) ^ ((<span class="built_in">sum</span>.value ^ y) + (k[(p &amp; <span class="number">3</span>) ^ e] ^ z)))</span><br><span class="line">        z = v[n - <span class="number">1</span>].value</span><br><span class="line">        rounds -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">v, n, k</span>):</span><br><span class="line">    rounds = <span class="number">6</span> + <span class="built_in">int</span>(<span class="number">52</span> / n)</span><br><span class="line">    <span class="built_in">sum</span> = c_uint32(rounds * DELTA)</span><br><span class="line">    y = v[<span class="number">0</span>].value</span><br><span class="line">    <span class="keyword">while</span> rounds &gt; <span class="number">0</span>:</span><br><span class="line">        e = (<span class="built_in">sum</span>.value &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span></span><br><span class="line">        p = n - <span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span> p &gt; <span class="number">0</span>:</span><br><span class="line">            z = v[p - <span class="number">1</span>].value</span><br><span class="line">            v[p].value -= (((z &gt;&gt; <span class="number">5</span> ^ y &lt;&lt; <span class="number">2</span>) + (y &gt;&gt; <span class="number">3</span> ^ z &lt;&lt; <span class="number">4</span>)) ^ ((<span class="built_in">sum</span>.value ^ y) + (k[(p &amp; <span class="number">3</span>) ^ e] ^ z)))</span><br><span class="line">            y = v[p].value</span><br><span class="line">            p -= <span class="number">1</span></span><br><span class="line">        z = v[n - <span class="number">1</span>].value</span><br><span class="line">        v[<span class="number">0</span>].value -= (((z &gt;&gt; <span class="number">5</span> ^ y &lt;&lt; <span class="number">2</span>) + (y &gt;&gt; <span class="number">3</span> ^ z &lt;&lt; <span class="number">4</span>)) ^ ((<span class="built_in">sum</span>.value ^ y) + (k[(p &amp; <span class="number">3</span>) ^ e] ^ z)))</span><br><span class="line">        y = v[<span class="number">0</span>].value</span><br><span class="line">        <span class="built_in">sum</span>.value -= DELTA</span><br><span class="line">        rounds -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">challenge2</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_level2jar</span>():</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;C:\\Users\\23957\\Desktop\\Syclock\\liblevel2.so&quot;</span>, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            d = f.read()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># get size</span></span><br><span class="line">        size_tuple = (<span class="built_in">hex</span>(d[-<span class="number">4</span>]), <span class="built_in">hex</span>(d[-<span class="number">3</span>]), <span class="built_in">hex</span>(d[-<span class="number">2</span>]), <span class="built_in">hex</span>(d[-<span class="number">1</span>]))</span><br><span class="line">        size = <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="keyword">for</span> s <span class="keyword">in</span> size_tuple[::-<span class="number">1</span>]:</span><br><span class="line">            size += s[<span class="number">2</span>:]</span><br><span class="line">        size = <span class="built_in">int</span>(size, <span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># get md5</span></span><br><span class="line">        st = -<span class="number">20</span></span><br><span class="line">        md5 = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">            md5.append(d[st+i])</span><br><span class="line">        md5_to_arr4 = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">            tmp = md5[i*<span class="number">4</span>:i*<span class="number">4</span>+<span class="number">4</span>]</span><br><span class="line">            tmp = tmp[::-<span class="number">1</span>]</span><br><span class="line">            tmp = <span class="string">&quot;&quot;</span>.join(<span class="built_in">hex</span>(t)[<span class="number">2</span>:] <span class="keyword">for</span> t <span class="keyword">in</span> tmp)</span><br><span class="line">            md5_to_arr4.append(<span class="built_in">int</span>(tmp, <span class="number">16</span>))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># get key</span></span><br><span class="line">        st = -<span class="number">52</span></span><br><span class="line">        key = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x20</span>):</span><br><span class="line">            key.append(d[st+i])</span><br><span class="line"></span><br><span class="line">        <span class="comment"># get level2.jar</span></span><br><span class="line">        st = -<span class="number">52</span> - size</span><br><span class="line">        filedata = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(size):</span><br><span class="line">            filedata.append(d[st+i])</span><br><span class="line"></span><br><span class="line">        <span class="comment"># decrypt</span></span><br><span class="line">        cipher = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(filedata), <span class="number">4</span>):</span><br><span class="line">            dd = [<span class="built_in">hex</span>(filedata[i+j])[<span class="number">2</span>:].zfill(<span class="number">2</span>) <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>)]</span><br><span class="line">            dd = dd[::-<span class="number">1</span>]</span><br><span class="line">            n = <span class="string">&quot;&quot;</span>.join(dd)</span><br><span class="line">            n = <span class="built_in">int</span>(n, <span class="number">16</span>)</span><br><span class="line">            cipher.append(c_uint32(n))</span><br><span class="line">        decrypt(cipher, <span class="built_in">len</span>(cipher), md5_to_arr4)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># save to level2.jar</span></span><br><span class="line">        out = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(cipher)):</span><br><span class="line">            dd = <span class="built_in">hex</span>(cipher[i].value)[<span class="number">2</span>:].zfill(<span class="number">8</span>)</span><br><span class="line">            dd = [<span class="built_in">int</span>(dd[j*<span class="number">2</span>:j*<span class="number">2</span>+<span class="number">2</span>], <span class="number">16</span>) <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>)]</span><br><span class="line">            dd = dd[::-<span class="number">1</span>]</span><br><span class="line">            out += dd</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;C:\\Users\\23957\\Desktop\\Syclock\\level2.jar&quot;</span>, <span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            <span class="keyword">for</span> dd <span class="keyword">in</span> out:</span><br><span class="line">                f.write(dd.to_bytes(<span class="number">1</span>, <span class="string">&#x27;little&#x27;</span>))</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_flag</span>():</span><br><span class="line">        target = [<span class="number">90</span>, <span class="number">80</span>, <span class="number">70</span>, <span class="number">91</span>, <span class="number">93</span>, <span class="number">80</span>, <span class="number">93</span>, <span class="number">71</span>, <span class="number">82</span>, <span class="number">65</span>, <span class="number">90</span>, <span class="number">110</span>]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">11</span>, <span class="number">0</span>, -<span class="number">1</span>):</span><br><span class="line">            target[i] = target[i-<span class="number">1</span>] ^ target[i]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">11</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">            target[i] = target[(i+<span class="number">1</span>)%<span class="number">12</span>] ^ target[i]</span><br><span class="line">        <span class="keyword">for</span> t <span class="keyword">in</span> target:</span><br><span class="line">            <span class="built_in">print</span>(<span class="built_in">chr</span>(t), end = <span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line">    get_level2jar()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;challenge2_flag:&quot;</span>, end = <span class="string">&quot;&quot;</span>)</span><br><span class="line">    get_flag()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line">challenge0()</span><br><span class="line">challenge1()</span><br><span class="line">challenge2()</span><br><span class="line"><span class="comment"># flag&#123;gooduserv4ndroidisfun&#125;</span></span><br></pre></td></tr></table></figure>
<h1 id="SycGson"><a href="#SycGson" class="headerlink" title="SycGson"></a>SycGson</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Find the correct route</span><br><span class="line">找到正确的路由</span><br></pre></td></tr></table></figure>
<p>&emsp;Go-64。</p>
<p>&emsp;可以总结出如下3种数据结构：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">main_city(0x28):</span><br><span class="line">	name int 0x00</span><br><span class="line">	neighbours []main.neighbour_city 0x08</span><br><span class="line">	delta uint8 0x20</span><br><span class="line">main.neighbour_city():</span><br><span class="line">	name int 0x00</span><br><span class="line">	distance int 0x08</span><br><span class="line">	cost main.cost 0x10</span><br><span class="line">main.cost(0x18):</span><br><span class="line">	transportation int 0x00</span><br><span class="line">	time int 0x08</span><br><span class="line">	expense int 0x10</span><br></pre></td></tr></table></figure>
<p>&emsp;程序逻辑如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">valid_city_delta = 0</span><br><span class="line">valid_city_delta_1 = 0</span><br><span class="line">valid_city_index = 2</span><br><span class="line">tmp1 = 0</span><br><span class="line">tmp2 = 1</span><br><span class="line">tmp5 = 0</span><br><span class="line">target2 = 0x186A0</span><br><span class="line">target2_add_8 = 0</span><br><span class="line">str1 = &quot;“fedcba9876543210&quot;</span><br><span class="line"></span><br><span class="line">while True:</span><br><span class="line">    if flag_len &lt; valid_city_delta_1:</span><br><span class="line">        break</span><br><span class="line">    now_flag_char = flag[valid_city_delta_1]</span><br><span class="line">    valid_city_delta_add_1 = valid_city_delta_1 + 1</span><br><span class="line">    rax = tmp5&amp;0xF</span><br><span class="line">    if rax%2 == 1: </span><br><span class="line">        rcx = 1</span><br><span class="line">    else: </span><br><span class="line">        rcx = 0</span><br><span class="line">    newstr = str1[rcx:0x10-rax]+str1[:rax]</span><br><span class="line">    rax = newstr.index(now_flag_str) # rax &lt; 4</span><br><span class="line">    tmp1 ^= valid_city_index邻居列表的第rax个邻居的time</span><br><span class="line">    tmp2 = (tmp2*valid_city_index邻居列表的第rax个邻居的expense)&amp;0xFFFFFFFF</span><br><span class="line">    target2 -= valid_city_index邻居列表的第rax个邻居的transportation</span><br><span class="line">    target2_add_8 += valid_city_index邻居列表的第rax个邻居的distance</span><br><span class="line">    valid_city_delta += valid_city_index的delta</span><br><span class="line">    if valid_city_index的邻居列表的第rax个邻居的name == 0x7C2:</span><br><span class="line">        target1 = valid_city_delta*tmp1</span><br><span class="line">        if valid_city_delta==0x83 and target1==0x1F370 and tmp2==0x0AA00000 and target2==0xC4E0 and target2_add_8==0xD898 and flag_len==0x1F:</span><br><span class="line">        	print(&quot;good&quot;)</span><br><span class="line">    else:</span><br><span class="line">        tmp5 += valid_city_index的邻居数量</span><br><span class="line">        valid_city_index = valid_city_index邻居列表的第rax个邻居在main_citys中的索引</span><br><span class="line">        valid_city_delta_1 = valid_city_delta_add_1</span><br></pre></td></tr></table></figure>
<p>&emsp;总结以下程序逻辑：找出城市<code>2</code>到城市<code>0x7c2-1800</code>之间长度为32的路径，且<code>expense</code>、<code>transportation</code>、<code>distance</code>、<code>delta</code>都要满足一定条件。</p>
<p>&emsp;由于路径遍历复杂度太高，因此进行一些约束，从而可以对路径树进行剪枝。</p>
<p>（1）路径点数为32。</p>
<p>（2）路径无环。</p>
<p>（3）由于<code>transportation</code>单调递减，<code>distance</code>与<code>delta</code>单调递增，因此路径的<code>transportation</code>少于某个值则不再考虑，<code>distance</code>与<code>delta</code>大于某个值则不再考虑。</p>
<p>（4）最重要的点：由于计算出平均每条边的<code>transportation</code>为1600，且图中<code>transportation</code>最小为1600，因此路径每条边应为<code>transportation</code>。</p>
<p>&emsp;脚本如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- encoding: utf-8 -*-</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string"># @Time  : 2023/07/18 10:31:52</span></span><br><span class="line"><span class="string"># @Author: wd-2711</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">citys</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, data</span>):</span><br><span class="line">        self.data = data</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_neighbours_info_by_index</span>(<span class="params">self, index</span>):</span><br><span class="line">        info = self.data[index]</span><br><span class="line">        neighbours = info[<span class="number">1</span>]</span><br><span class="line">        neighbours_ind = []</span><br><span class="line">        neighbours_distance = []</span><br><span class="line">        neighbours_cost = []</span><br><span class="line">        <span class="keyword">for</span> n <span class="keyword">in</span> neighbours:</span><br><span class="line">            neighbours_ind.append(n[<span class="number">0</span>]-<span class="number">1800</span>)</span><br><span class="line">            neighbours_distance.append(n[<span class="number">1</span>])</span><br><span class="line">            neighbours_cost.append(&#123;</span><br><span class="line">                <span class="string">&quot;transportation&quot;</span>: n[<span class="number">2</span>][<span class="number">0</span>],</span><br><span class="line">                <span class="string">&quot;time&quot;</span>: n[<span class="number">2</span>][<span class="number">1</span>],</span><br><span class="line">                <span class="string">&quot;expense&quot;</span>: n[<span class="number">2</span>][<span class="number">2</span>],</span><br><span class="line">            &#125;)</span><br><span class="line">        <span class="keyword">return</span> neighbours_ind, neighbours_distance, neighbours_cost</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_delta_by_index</span>(<span class="params">self, index</span>):</span><br><span class="line">        info = self.data[index]</span><br><span class="line">        delta = info[<span class="number">2</span>]</span><br><span class="line">        <span class="keyword">return</span> delta</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__len__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">len</span>(self.data)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">parse_data</span>():</span><br><span class="line">    path = <span class="string">&quot;./gson/gson.json&quot;</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(path, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        lines = f.read().strip().replace(<span class="string">&quot; &quot;</span>, <span class="string">&quot;,&quot;</span>).replace(<span class="string">&quot;&#123;&quot;</span>, <span class="string">&quot;[&quot;</span>).replace(<span class="string">&quot;&#125;&quot;</span>, <span class="string">&quot;]&quot;</span>)</span><br><span class="line">    lines = <span class="built_in">eval</span>(lines)</span><br><span class="line">    <span class="keyword">return</span> citys(lines)    </span><br><span class="line"></span><br><span class="line">expense_gate = <span class="number">0x0AA000000</span></span><br><span class="line">target2_gate = <span class="number">0xC4E0</span></span><br><span class="line">target2_add_8_gate = <span class="number">0xD898</span></span><br><span class="line">valid_city_delta_gate = <span class="number">0x83</span></span><br><span class="line">st_index = <span class="number">2</span></span><br><span class="line">ed_index = <span class="number">0x7C2</span> - <span class="number">1800</span></span><br><span class="line">arr = <span class="string">&quot;fedcba9876543210&quot;</span></span><br><span class="line">citys_info = parse_data()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find_path</span>():</span><br><span class="line">    ret = &#123;&#125;</span><br><span class="line"></span><br><span class="line">    path_seq = [[st_index]]</span><br><span class="line">    expense_seq = [<span class="number">1</span>]</span><br><span class="line">    target2_seq = [<span class="number">0x186A0</span>]</span><br><span class="line">    target2_add_8_seq = [<span class="number">0</span>]</span><br><span class="line">    valid_city_delta_seq = [<span class="number">0</span>]</span><br><span class="line">    </span><br><span class="line">    st = time.time()</span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> i % <span class="number">10000</span> == <span class="number">0</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;path_seq:&#123;:&lt;10&#125;|time:&#123;:&lt;10&#125;|max_path_len:&#123;:&lt;10&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">len</span>(path_seq), <span class="built_in">int</span>(time.time()-st), <span class="built_in">len</span>(path_seq[-<span class="number">1</span>])))</span><br><span class="line"></span><br><span class="line">        head_path = path_seq[<span class="number">0</span>]</span><br><span class="line">        head_expense = expense_seq[<span class="number">0</span>]</span><br><span class="line">        head_target2 = target2_seq[<span class="number">0</span>]</span><br><span class="line">        head_target2_add_8 = target2_add_8_seq[<span class="number">0</span>]</span><br><span class="line">        head_valid_city_delta = valid_city_delta_seq[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(head_path) == <span class="number">32</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        now_index = head_path[-<span class="number">1</span>]</span><br><span class="line">        neighbours_ind, neighbours_distance, neighbours_cost = citys_info.get_neighbours_info_by_index(now_index)</span><br><span class="line">        delta = citys_info.get_delta_by_index(now_index)</span><br><span class="line">        neighbours_len = <span class="built_in">len</span>(neighbours_ind)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(neighbours_len):</span><br><span class="line">            new_path = head_path + [neighbours_ind[j]]</span><br><span class="line">            new_expense = (head_expense * neighbours_cost[j][<span class="string">&#x27;expense&#x27;</span>]) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">            new_target2 = head_target2 - neighbours_cost[j][<span class="string">&#x27;transportation&#x27;</span>]</span><br><span class="line">            new_target2_add_8 = head_target2_add_8 + neighbours_distance[j]</span><br><span class="line">            new_valid_city_delta = head_valid_city_delta + delta</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> neighbours_cost[j][<span class="string">&#x27;transportation&#x27;</span>] != <span class="number">1600</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">if</span> new_target2 &lt; target2_gate <span class="keyword">or</span> new_target2_add_8 &gt; target2_add_8_gate <span class="keyword">or</span> new_valid_city_delta &gt; valid_city_delta_gate:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">if</span> new_path[-<span class="number">1</span>] <span class="keyword">in</span> new_path[:-<span class="number">1</span>]:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">if</span> new_path[-<span class="number">1</span>] == ed_index <span class="keyword">and</span> <span class="built_in">len</span>(new_path) &lt; <span class="number">32</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(new_path) &gt; <span class="number">32</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">if</span> new_path[-<span class="number">1</span>] == ed_index <span class="keyword">and</span> <span class="built_in">len</span>(new_path) == <span class="number">32</span> <span class="keyword">and</span> new_target2 == target2_gate <span class="keyword">and</span> new_target2_add_8 == target2_add_8_gate <span class="keyword">and</span> new_valid_city_delta == valid_city_delta_gate:</span><br><span class="line">                <span class="keyword">if</span> new_expense == expense_gate:</span><br><span class="line">                    ret[<span class="string">&#x27;path&#x27;</span>] = new_path</span><br><span class="line">                    <span class="keyword">return</span> ret</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            </span><br><span class="line">            path_seq.append(new_path)</span><br><span class="line">            expense_seq.append(new_expense)</span><br><span class="line">            target2_seq.append(new_target2)</span><br><span class="line">            target2_add_8_seq.append(new_target2_add_8)</span><br><span class="line">            valid_city_delta_seq.append(new_valid_city_delta)</span><br><span class="line"></span><br><span class="line">        path_seq = path_seq[<span class="number">1</span>:]</span><br><span class="line">        expense_seq = expense_seq[<span class="number">1</span>:]</span><br><span class="line">        target2_seq = target2_seq[<span class="number">1</span>:]</span><br><span class="line">        target2_add_8_seq = target2_add_8_seq[<span class="number">1</span>:]</span><br><span class="line">        valid_city_delta_seq = valid_city_delta_seq[<span class="number">1</span>:]</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_flag</span>():</span><br><span class="line">    p = find_path()</span><br><span class="line">    path = p[<span class="string">&#x27;path&#x27;</span>]</span><br><span class="line">    tmp5 = <span class="number">0</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;SCTF&#123;&quot;</span>, end = <span class="string">&quot;&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(path)-<span class="number">1</span>):</span><br><span class="line">        node_index = path[i]</span><br><span class="line">        next_node_index = path[i+<span class="number">1</span>]</span><br><span class="line">        rax = tmp5 &amp; <span class="number">0xF</span></span><br><span class="line">        new_arr = arr[:<span class="number">0x10</span>-rax] + arr[:rax]</span><br><span class="line">        neighbours, _, _ = citys_info.get_neighbours_info_by_index(node_index)</span><br><span class="line">        tmp = neighbours.index(next_node_index)</span><br><span class="line">        flag_c = new_arr[tmp]</span><br><span class="line">        <span class="built_in">print</span>(flag_c, end = <span class="string">&quot;&quot;</span>)</span><br><span class="line">        tmp5 += <span class="number">4</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    get_flag()</span><br><span class="line"><span class="comment"># SCTF&#123;dfedfcdefdecdefdccffeddceddecdf&#125;</span></span><br></pre></td></tr></table></figure>
<p>&emsp;做出来才发现，<code>Nu1L</code>和<code>W&amp;M</code>都没做出来，嘿嘿嘿，官方题解也没给答案，我得出的<code>flag=SCTF&#123;dfedfcdefdecdefdccffeddceddecdf&#125;</code>。</p>
<h1 id="SycTee"><a href="#SycTee" class="headerlink" title="SycTee"></a>SycTee</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">study OP tee</span><br><span class="line">附件：链接：https://pan.baidu.com/s/1rPLyDrhzZJGilYgFQP6qoA?pwd=SCTF</span><br><span class="line">提取码：SCTF</span><br><span class="line">Google Drive：https://drive.google.com/file/d/1568TtX2DRrTg7jtIv3IaNd1MhVcEmhDS/view?usp=sharing</span><br></pre></td></tr></table></figure>
<h2 id="0x00-思路"><a href="#0x00-思路" class="headerlink" title="0x00 思路"></a>0x00 思路</h2><p>&emsp;今天看了一天OP-TEE，搭建好了OP-TEE的环境，也能运行hello_world等示例程序。但是还是看不出来，只能运行<code>bl1.bin</code>，其余的<code>bl2.bin/bl31.bin/bl32.bin/bl33.bin</code>无法运行。</p>
<p>&emsp;发现这是<code>realworld</code>的<a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/267183">题目</a>，直接打算看<code>wp</code>，复现一下，这样的话以后遇到了也可以解决（主要是浪费了3天时间了）。</p>
<h2 id="0x01-My-middle-WP"><a href="#0x01-My-middle-WP" class="headerlink" title="0x01 My middle WP"></a>0x01 My middle WP</h2><p>&emsp;找到了某<a target="_blank" rel="noopener" href="https://o0xmuhe.github.io/2022/08/24/optee%E5%AD%A6%E4%B9%A0/">链接</a>，可能是出题人学习<code>optee</code>的笔记。<code>rootfs.cpio.gz</code>是题目的文件系统，首先解压：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gzip -d root.cpio.gz</span><br><span class="line">sudo cpio -id -D ./rootfs &lt; rootfs.cpio</span><br></pre></td></tr></table></figure>
<p>&emsp;在其中，发现<code>optee</code>的相关示例文件：</p>
<p><img src="/images/SCTF-2023/image-20230714181339639.png" alt="image-20230714181339639" style="zoom:67%;" /></p>
<p>&emsp;重点关注<code>optee_example_bj666-888</code>，因为这是普通示例文件没有的。经过实验，<code>bj888</code>带参数输入会输出<code>wrong</code>，猜测可能<code>flag</code>检验文件。</p>
<p>&emsp;分析<code>bj888</code>文件：</p>
<p><img src="/images/SCTF-2023/image-20230714181902928.png" alt="image-20230714181902928" style="zoom:67%;" /></p>
<p>&emsp;在此需要补充，由于<code>optee</code>是一个可信执行环境，因此，有<code>TEE</code>（可信环境）与<code>REE</code>（不可信环境）两种环境，并且在程序加载时，<code>TEE</code>将根据<code>UUID</code>从内存中取出<code>UUID.ta</code>文件，将其作为<code>TEE</code>系统的镜像文件。从上图可以看出，输入长度为27。</p>
<p><img src="/images/SCTF-2023/image-20230714182157993.png" alt="image-20230714182157993" style="zoom:67%;" /></p>
<p>&emsp;<code>UUID</code>如上图红框所示，我们可以根据它找到此程序对应的<code>UUID.ta</code>文件。在本题中，<code>UUID.ta</code>文件存放在<code>/lib/optee_armtz</code>中，对应的具体文件为：<code>/lib/optee_armtz/045ccc45-ee83-43ec-b69f-121819c1ba6b.ta</code>。</p>
<p>&emsp;之后，由于<code>045ccc45-ee83-43ec-b69f-121819c1ba6b.ta</code>是加密的，因此，我就不知道该如何做了。</p>
<h2 id="0x02-W-amp-M’s-wp"><a href="#0x02-W-amp-M’s-wp" class="headerlink" title="0x02 W&amp;M’s wp"></a>0x02 W&amp;M’s wp</h2><p>&emsp;无论是官方的<code>wp</code>，还是<code>Nu1L</code>的<code>wp</code>，他们都没说一件事：<code>xxx.ta</code>文件并不是加密的，绝大部分情况下，将<code>xxx.ta</code>文件的头部字节删掉，即变成以<code>.ELF</code>字节开头，这样就可以直接使用<code>IDA</code>进行分析。因此，<code>045ccc45-ee83-43ec-b69f-121819c1ba6b.ta</code>不是加密的。</p>
<p>&emsp;补充：<code>.ta</code>文件的开头，也就是<code>.ta_head:0000000000000000</code>，一般是<code>uuid</code>。跟进<code>start</code>进入类似于下图的函数结构后，<code>optee</code>的<code>.ta</code>有一个固定的模式（看了两个文件都是这样的模式），记住下图红框中的函数一般是主函数即可。</p>
<p><img src="/images/SCTF-2023/image-20230715113707186.png" alt="image-20230715113707186" style="zoom:67%;" /></p>
<p>&emsp;跟进<code>sub_1DC</code>函数后，发现：</p>
<p><img src="/images/SCTF-2023/image-20230715114714266.png" alt="image-20230715114714266" style="zoom:67%;" /></p>
<p>&emsp;其中<code>sub_20</code>可以当作是<code>copy</code>函数，因此有：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">v21 = [0x25, 3, 0xA, 0x6C, 0xF8, 0xB1, 0xCE, 0x7F, 0xC9, 0x42, 0xC, 0xD, 0x68, 0xB3, 0x1C, 4, 0x64, 0xFA, 0xE5, 0xA4, 0x22, 0xD4, 0x2C, 0xFF, 0x4E, 0x36, 0x2A, 0]</span><br></pre></td></tr></table></figure>
<p>&emsp;下面跟进<code>v20</code>，在此，说明一下<code>.ta</code>文件的某些函数：</p>
<p><img src="/images/SCTF-2023/image-20230715120030289.png" alt="image-20230715120030289" style="zoom:67%;" /></p>
<p>&emsp;如上图所示，<code>sub_930</code>函数结构出现过多次，此函数的功能是：收取来自<code>CA</code>（不可信环境）中的参数。</p>
<p>&emsp;因此，<code>key</code>、<code>iv</code>、<code>密文</code>都是用户输入的。并且，可以发现字符串：<code>Example of TA using an AES sequence</code>，猜测是<code>AES</code>解密。在128位<code>AES</code>的情况下，<code>key</code>与<code>iv</code>都是16字节。再次看<code>bj888</code>，发现：</p>
<p><img src="/images/SCTF-2023/image-20230715120830295.png" alt="image-20230715120830295" style="zoom:67%;" /></p>
<p>&emsp;猜测<code>key=snbjklefsdcvfsyc</code>，<code>iv=snbjklefsdcvfsyc</code>。通过在线网站<code>CyberChief</code>可以获得<code>flag</code>：</p>
<p><img src="/images/SCTF-2023/image-20230715121516685.png" alt="image-20230715121516685" style="zoom:67%;" /></p>

  
	</div>

	<div>
  	<center>
	<div class="pagination">

    
    
    <a href="/2023/06/17/stm-re/" type="button" class="btn btn-default"><i
                class="fa fa-arrow-circle-o-left"></i> 上一页</a>
    

    <a href="/" type="button" class="btn btn-default"><i class="fa fa-home"></i>Home</a>
    
    <a href="/2023/06/16/tvm-analysis/" type="button" class="btn btn-default ">下一页<i
                class="fa fa-arrow-circle-o-right"></i></a>
    

    
</div>

    </center>
	</div>


	<!-- comment -->
	
<section id="comment">
    <h2 class="title">留言</h2>

    <!-- 
    <div id="disqus_thread" class="ds-thread">
        <script type="text/javascript">
            /**
             * RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
             * LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
             */
                /*
                 var disqus_config = function () {
                 this.page.url = PAGE_URL; // Replace PAGE_URL with your page's canonical URL variable
                 this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
                 };
                 */
            (function() { // DON'T EDIT BELOW THIS LINE
                var d = document, s = d.createElement('script');

                s.src = 'https://https-wd-2711-tech.disqus.com/embed.js';

                s.setAttribute('data-timestamp', +new Date());
                (d.head || d.body).appendChild(s);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by
                Disqus.</a></noscript>
    </div> -->
    <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
    <div id="vcomments"></div>
    <script>
        new Valine({
            el: '#vcomments',
            appId: 'wLIJ70s3fPvW8WJPgVVAuWVR-gzGzoHsz',
            appKey: 'NVGqxhUkqtFv2CbwmXXWjCdR'
        })
    </script>

    
</section>


	</div> <!-- col-md-9/col-md-12 -->
		
	
	<div id="side_meta">
		<div class="col-md-3" id="post_meta"> 

	<!-- date -->
	
	<div class="meta-widget">
	<i class="fa fa-clock-o"></i>
	2023-06-17 
	</div>
	

	<!-- categories -->
    
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#categorys"><i class="fa fa-folder"></i></a>	
    <ul id="categorys" class="tag_box list-unstyled collapse in">
          
  <li>
    <li><a href="/categories/re/">re<span>40</span></a></li>
  </li>

    </ul>
	</div>
	

	<!-- tags -->
		

	<!-- toc -->
	<div class="meta-widget">
	
	</div>
	
    <hr>
	
</div><!-- col-md-3 -->

	</div>

	<!-- copyright -->
	<div>
    <ul class="post-copyright">
      <li class="post-copyright-author">
      <strong>作者:  </strong>wd-z711</a>
      </li>
      <li class="post-copyright-link">
      <strong>文章链接:  </strong>
      <a href="/" target="_blank" title="">https://wd-2711.tech/</a>
      </li>
      <li class="post-copyright-license">
        <strong>版权声明:   </strong>
        本博客所有文章除特别声明外，均采用 <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">CC BY-NC-ND 4.0</a>
        许可协议。转载请注明出处!
      </li>
    </ul>
  <div>
 	

		


</div><!-- row -->




	</div>
  </div>
  <div class="container-narrow">
  <footer> <p>
  &copy; 2024 wd-z711
  
      <!-- with help from <a href="http://hexo.io/" target="_blank">Hexo</a>,<a target="_blank" rel="noopener" href="http://github.com/wzpan/hexo-theme-freemind/">Freemind</a>,<a href="http://getbootstrap.com/" target="_blank">Twitter Bootstrap</a> and <a href="http://getbootstrap.com/" target="_blank">BOOTSTRA.386</a>. 
     <br> Theme by <a target="_blank" rel="noopener" href="http://github.com/wzpan/hexo-theme-freemind/">Freemind.386</a>.     -->

     <!-- <script type="text/javascript">
      (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
      (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
      e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
      })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');
      
      _st('install','aB-vgeB8gEDrnRJuhceL','2.0.0');
    </script> -->
    </p>
 </footer>
</div> <!-- container-narrow -->
  


  
<a id="gotop" href="#">   
  <span>⬆︎TOP</span>
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/search.js"></script> 


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



   <script type="text/javascript">      
     var search_path = "search.xml";
	 if (search_path.length == 0) {
	 	search_path = "search.xml";
	 }
	 var path = "/" + search_path;
     searchFunc(path, 'local-search-input', 'local-search-result');
   </script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</body>
   </html>
