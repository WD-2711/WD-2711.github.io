<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="pragma" content="no-cache">
  <meta http-equiv="cache-control" content="no-cache">
  <meta http-equiv="expires" content="0">
  
  <title>oddfuzz | wd-z711&#39;s B10g</title>
  <meta name="author" content="wd-z711">
  
  <meta name="description" content="Common student in China. Interested in web &amp; re.">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="oddfuzz"/>
  <meta property="og:site_name" content="wd-z711&#39;s B10g"/>

  
    <meta property="og:image" content=""/>
  

  
  
    <link href="/favicon.png" rel="icon">
  
  
  <link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>

  <!-- analytics -->
  
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'G-YHJSKZDC3Y', 'auto');
  ga('send', 'pageview');
</script>




<meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="wd-z711's B10g" type="application/atom+xml">
</head>

 <body>  
  <nav id="main-nav" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
      <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
		<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
	  <a class="navbar-brand" href="/">wd-z711&#39;s B10g</a>
      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		  
		  <li>
			<a href="/archives" title="All the articles.">
			  <i class="fa fa-archive"></i>Archives
			</a>
		  </li>
		  
		  <li>
			<a href="/categories" title="All the categories.">
			  <i class="fa fa-folder"></i>Categories
			</a>
		  </li>
		  
		  <li>
			<a href="/about" title="About me.">
			  <i class="fa fa-user"></i>About
			</a>
		  </li>
		  
		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
  	<div class="content">
    	 


	
		<div class="page-header">
			<h1> oddfuzz</h1>
		</div>
	



<div class="row post">

	<!-- cols -->
	
	<div id="top_meta"></div>
	<div class="col-md-9">
	

	<!-- content -->
	<div class="mypage">		
	  		

	  <h1 id="ODDFUZZ-Discovering-Java-Deserialization-Vulnerabilities-via-Structure-Aware-Directed-Greybox-Fuzzing"><a href="#ODDFUZZ-Discovering-Java-Deserialization-Vulnerabilities-via-Structure-Aware-Directed-Greybox-Fuzzing" class="headerlink" title="ODDFUZZ: Discovering Java Deserialization Vulnerabilities via Structure-Aware Directed Greybox Fuzzing"></a>ODDFUZZ: Discovering Java Deserialization Vulnerabilities via Structure-Aware Directed Greybox Fuzzing</h1><h2 id="摘要"><a href="#摘要" class="headerlink" title="摘要"></a>摘要</h2><p>&emsp;可以用静态分析来定位java反序列化漏洞。ODDFUZZ使用轻量级污点分析定位候选的gadget链（避免漏报），之后使用定向灰盒测试生成poc用例来减少误报。ODDFUZZ使用结构感知种子生成方法保证用例有效性，并使用混合反馈与步进策略来指导定向模糊测试。</p>
<span id="more"></span>
<p>&emsp;找到ysoserial库34个漏洞中的16个（baseline 为3个），并在其他库中找到6个CVE。</p>
<h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>&emsp;开放动态反序列化 OOD 具有破坏性（？），通过静态分析查找反序列化漏洞的工具有：（1）GadgetInspector，但是会有精度问题，从而产生漏报与误报；（2）SerHybrid，分析堆访问路径来寻找影响 sink 的 source。</p>
<p>&emsp;挑战：（1）精确率与召回率之间的权衡。由于java的运行时多态，任何重写的方法都可能变为gadget链，遍历所有可能的gadget链会使得路径爆炸，现有方法是使用污点分析剪枝，但是这种方法要么精度不行，要么计算代价太高。（2）现有fuzz生成的testcase都无法到达sink，生成有效的testcase需要多层级结构、且属性满足特定控制流约束。（3）现有方案以代码覆盖率为导向，而不是以目标为导向，就会浪费很多资源去找无法到达sink的path。</p>
<p>&emsp;ODDFUZZ贡献：（1）处理运行时多态时，对准确率与召回率之间进行权衡；（2）建模gadget链的数据约束，进行结构感知的fuzz；（3）使用step-forword策略与hybrid feedback，快速找到漏洞。</p>
<p>&emsp;使用java fuzz框架JQF来写ODDFUZZ。</p>
<h2 id="Background"><a href="#Background" class="headerlink" title="Background"></a>Background</h2><h3 id="ODD"><a href="#ODD" class="headerlink" title="ODD"></a>ODD</h3><p>&emsp;开源动态反序列化ODD，又叫做对象注入漏洞OIV，指的是攻击者将序列化对象注入到应用程序的行为。ODD漏洞在js、php、.NET中也会有。open表示任意对象都可以被反序列化，dynamic表示能够调用invoke多态方法或基于反射的行为去找寻路径。由于java是动态的，所以很难预测会invoke哪个方法。攻击者可将应用程序的代码片段链接在一起（并按顺序执行它们）并将数据传递到安全敏感的调用点，攻击就成功。gadget链实例如下所示：</p>
<p><img src="../images/oddfuzz/image-20231108211644048.png" alt="image-20231108211644048" style="zoom:67%;" /></p>
<p>&emsp;面向属性的编程POP。精细的定义要反序列化的属性，以链接不同级别的对象，从而进行成功的攻击。下图是对上图的POP编程，通过构造的PriorityQueue，最后可进行代码的远程执行。</p>
<p><img src="../images/oddfuzz/image-20231108213655198.png" alt="image-20231108213655198" style="zoom:67%;" /></p>
<h3 id="威胁模型"><a href="#威胁模型" class="headerlink" title="威胁模型"></a>威胁模型</h3><p><img src="../images/oddfuzz/image-20231108213822316.png" alt="image-20231108213822316" style="zoom:67%;" /></p>
<h3 id="定向灰盒测试-DGF"><a href="#定向灰盒测试-DGF" class="headerlink" title="定向灰盒测试 DGF"></a>定向灰盒测试 DGF</h3><p>&emsp;以代码覆盖率为导向的灰盒测试（CGF）与定向灰盒测试（DGF）。对于某些场景，静态报告验证，漏洞就在那儿了，需要自己探索。DGF引导fuzzer到特定位置，并生成POC testcase。以下是DGF的流程：</p>
<p><img src="../images/oddfuzz/image-20231108214859002.png" alt="image-20231108214859002" style="zoom:67%;" /></p>
<p>&emsp;（1）静态分析阶段：提取调用图与控制流图，计算二进制文件与目标之间的距离。（2）fuzzing循环阶段，目标距离、覆盖率、相似性作为反馈信息，以快速引导fuzzer到达目标点。利用反馈信息，fuzzer在seed pool中选择seed，并分配适合的能量进行变异。seed的能量确定生成多少新种子。fuzzer使用多种变异策略来引导种子向目标站点进化。具有更小距离的新种子将被保留，以进行下一次fuzzing循环。</p>
<h2 id="Motivation"><a href="#Motivation" class="headerlink" title="Motivation"></a>Motivation</h2><h3 id="挑战1：运行时多态"><a href="#挑战1：运行时多态" class="headerlink" title="挑战1：运行时多态"></a>挑战1：运行时多态</h3><p>&emsp;现有的工作可以识别代码中gadget的组合，攻击者使用gadget来组合gadget链。由于运行时多态，无法根据声明类型确定虚拟方法调用，因此，无法精确找到运行时的程序路径，从而导致高漏报。解决此问题的方法是进行类层次分析（CHA），综合考虑显式与隐式方法调用，但是盲目的考虑所有可行的gadget会导致路径爆炸问题。</p>
<p>&emsp;gadgetInspector分别追踪了<code>函数参数</code>到<code>返回值、其他方法调用</code>的数据流，并列举了<code>基于类继承层次结构的所有可用方法</code>与<code>gadget链的相关函数重写</code>。然而，攻击者可控制的属性能够<code>从污点参数传播到其子类的参数</code>，这类情况gadgetInspector没有考虑，即没有考虑<code>过程内污点分析</code>。</p>
<p>&emsp;FUGIO在其构建的<code>深度有界调用树上追踪了过程内数据流</code>，以对不可行的gadget进行剪枝。然而，进行java ODD（开源动态反序列化）调用链发现时，这种方法不管用，这是因为传统java程序会集成很多个具有各自依赖关系的库，这会导致很多类和方法，使得调用链很深很宽，难以处理。</p>
<p><img src="../images/oddfuzz/image-20231109214851761.png" alt="image-20231109214851761" style="zoom:67%;" /></p>
<h2 id="ODDFUZZ-设计"><a href="#ODDFUZZ-设计" class="headerlink" title="ODDFUZZ 设计"></a>ODDFUZZ 设计</h2><h2 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h2><h2 id="评估"><a href="#评估" class="headerlink" title="评估"></a>评估</h2><h2 id="讨论"><a href="#讨论" class="headerlink" title="讨论"></a>讨论</h2><h2 id="相关工作"><a href="#相关工作" class="headerlink" title="相关工作"></a>相关工作</h2><h2 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h2>
  
	</div>

	<div>
  	<center>
	<div class="pagination">

    
    
    <a href="/2023/11/09/image-caption/" type="button" class="btn btn-default"><i
                class="fa fa-arrow-circle-o-left"></i> 上一页</a>
    

    <a href="/" type="button" class="btn btn-default"><i class="fa fa-home"></i>Home</a>
    
    <a href="/2023/11/03/blog-migrate-test/" type="button" class="btn btn-default ">下一页<i
                class="fa fa-arrow-circle-o-right"></i></a>
    

    
</div>

    </center>
	</div>


	<!-- comment -->
	
<section id="comment">
    <h2 class="title">留言</h2>

    <!-- 
    <div id="disqus_thread" class="ds-thread">
        <script type="text/javascript">
            /**
             * RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
             * LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
             */
                /*
                 var disqus_config = function () {
                 this.page.url = PAGE_URL; // Replace PAGE_URL with your page's canonical URL variable
                 this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
                 };
                 */
            (function() { // DON'T EDIT BELOW THIS LINE
                var d = document, s = d.createElement('script');

                s.src = 'https://https-wd-2711-tech.disqus.com/embed.js';

                s.setAttribute('data-timestamp', +new Date());
                (d.head || d.body).appendChild(s);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by
                Disqus.</a></noscript>
    </div> -->
    <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
    <div id="vcomments"></div>
    <script>
        new Valine({
            el: '#vcomments',
            appId: 'wLIJ70s3fPvW8WJPgVVAuWVR-gzGzoHsz',
            appKey: 'NVGqxhUkqtFv2CbwmXXWjCdR'
        })
    </script>

    
</section>


	</div> <!-- col-md-9/col-md-12 -->
		
	
	<div id="side_meta">
		<div class="col-md-3" id="post_meta"> 

	<!-- date -->
	
	<div class="meta-widget">
	<i class="fa fa-clock-o"></i>
	2023-11-07 
	</div>
	

	<!-- categories -->
    
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#categorys"><i class="fa fa-folder"></i></a>	
    <ul id="categorys" class="tag_box list-unstyled collapse in">
          
  <li>
    <li><a href="/categories/papers/">papers<span>9</span></a></li>
  </li>

    </ul>
	</div>
	

	<!-- tags -->
		

	<!-- toc -->
	<div class="meta-widget">
	
	   <a data-toggle="collapse" data-target="#toc"><i class="fa fa-bars"></i></a>
	   <div id="toc" class="toc collapse in">
		   <span class="toc-title">Contents</span>
			<ol class="toc-article"><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#ODDFUZZ-Discovering-Java-Deserialization-Vulnerabilities-via-Structure-Aware-Directed-Greybox-Fuzzing"><span class="toc-article-text">ODDFUZZ: Discovering Java Deserialization Vulnerabilities via Structure-Aware Directed Greybox Fuzzing</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#%E6%91%98%E8%A6%81"><span class="toc-article-text">摘要</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Introduction"><span class="toc-article-text">Introduction</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Background"><span class="toc-article-text">Background</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#ODD"><span class="toc-article-text">ODD</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#%E5%A8%81%E8%83%81%E6%A8%A1%E5%9E%8B"><span class="toc-article-text">威胁模型</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#%E5%AE%9A%E5%90%91%E7%81%B0%E7%9B%92%E6%B5%8B%E8%AF%95-DGF"><span class="toc-article-text">定向灰盒测试 DGF</span></a></li></ol></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Motivation"><span class="toc-article-text">Motivation</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#%E6%8C%91%E6%88%981%EF%BC%9A%E8%BF%90%E8%A1%8C%E6%97%B6%E5%A4%9A%E6%80%81"><span class="toc-article-text">挑战1：运行时多态</span></a></li></ol></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#ODDFUZZ-%E8%AE%BE%E8%AE%A1"><span class="toc-article-text">ODDFUZZ 设计</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#%E5%BA%94%E7%94%A8"><span class="toc-article-text">应用</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#%E8%AF%84%E4%BC%B0"><span class="toc-article-text">评估</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#%E8%AE%A8%E8%AE%BA"><span class="toc-article-text">讨论</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#%E7%9B%B8%E5%85%B3%E5%B7%A5%E4%BD%9C"><span class="toc-article-text">相关工作</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#%E7%BB%93%E8%AE%BA"><span class="toc-article-text">结论</span></a></li></ol></li></ol>
		</div>
	
	</div>
	
    <hr>
	
</div><!-- col-md-3 -->

	</div>

	<!-- copyright -->
	<div>
    <ul class="post-copyright">
      <li class="post-copyright-author">
      <strong>作者:  </strong>wd-z711</a>
      </li>
      <li class="post-copyright-link">
      <strong>文章链接:  </strong>
      <a href="/" target="_blank" title="">https://wd-2711.tech/</a>
      </li>
      <li class="post-copyright-license">
        <strong>版权声明:   </strong>
        本博客所有文章除特别声明外，均采用 <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">CC BY-NC-ND 4.0</a>
        许可协议。转载请注明出处!
      </li>
    </ul>
  <div>
 	

		


</div><!-- row -->




	</div>
  </div>
  <div class="container-narrow">
  <footer> <p>
  &copy; 2023 wd-z711
  
      <!-- with help from <a href="http://hexo.io/" target="_blank">Hexo</a>,<a target="_blank" rel="noopener" href="http://github.com/wzpan/hexo-theme-freemind/">Freemind</a>,<a href="http://getbootstrap.com/" target="_blank">Twitter Bootstrap</a> and <a href="http://getbootstrap.com/" target="_blank">BOOTSTRA.386</a>. 
     <br> Theme by <a target="_blank" rel="noopener" href="http://github.com/wzpan/hexo-theme-freemind/">Freemind.386</a>.     -->

     <!-- <script type="text/javascript">
      (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
      (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
      e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
      })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');
      
      _st('install','aB-vgeB8gEDrnRJuhceL','2.0.0');
    </script> -->
    </p>
 </footer>
</div> <!-- container-narrow -->
  


  
<a id="gotop" href="#">   
  <span>⬆︎TOP</span>
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/search.js"></script> 


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



   <script type="text/javascript">      
     var search_path = "search.xml";
	 if (search_path.length == 0) {
	 	search_path = "search.xml";
	 }
	 var path = "/" + search_path;
     searchFunc(path, 'local-search-input', 'local-search-result');
   </script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</body>
   </html>
