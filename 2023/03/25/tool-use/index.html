<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="pragma" content="no-cache">
  <meta http-equiv="cache-control" content="no-cache">
  <meta http-equiv="expires" content="0">
  
  <title>tool-use | wd-z711&#39;s B10g</title>
  <meta name="author" content="wd-z711">
  
  <meta name="description" content="Common student in China. Interested in web &amp; re.">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="tool-use"/>
  <meta property="og:site_name" content="wd-z711&#39;s B10g"/>

  
    <meta property="og:image" content=""/>
  

  
  
    <link href="/favicon.png" rel="icon">
  
  
  <link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>

  <!-- analytics -->
  
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'G-YHJSKZDC3Y', 'auto');
  ga('send', 'pageview');
</script>




<meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="wd-z711's B10g" type="application/atom+xml">
</head>

 <body>  
  <nav id="main-nav" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
      <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
		<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
	  <a class="navbar-brand" href="/">wd-z711&#39;s B10g</a>
      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		  
		  <li>
			<a href="/archives" title="All the articles.">
			  <i class="fa fa-archive"></i>Archives
			</a>
		  </li>
		  
		  <li>
			<a href="/categories" title="All the categories.">
			  <i class="fa fa-folder"></i>Categories
			</a>
		  </li>
		  
		  <li>
			<a href="/about" title="About me.">
			  <i class="fa fa-user"></i>About
			</a>
		  </li>
		  
		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
  	<div class="content">
    	 


	
		<div class="page-header">
			<h1> tool-use</h1>
		</div>
	



<div class="row post">

	<!-- cols -->
	
	<div id="top_meta"></div>
	<div class="col-md-9">
	

	<!-- content -->
	<div class="mypage">		
	  		

	  <h1 id="工具使用-amp-常用指令"><a href="#工具使用-amp-常用指令" class="headerlink" title="工具使用&amp;常用指令"></a>工具使用&amp;常用指令</h1><h2 id="0x00-qemu-IDA-ARM-Windows"><a href="#0x00-qemu-IDA-ARM-Windows" class="headerlink" title="0x00 qemu+IDA+ARM+Windows"></a>0x00 qemu+IDA+ARM+Windows</h2><p>&emsp;<strong>指令：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 1. 运行 raspberry</span><br><span class="line">qemu-system-arm.exe -M versatilepb -cpu arm1176 -m 256 -drive &quot;file=./arm/2020-02-13-raspbian-buster.img,if=none,index=0,media=disk,format=raw,id=disk0&quot; -device &quot;virtio-blk-pci,drive=disk0,disable-modern=on,disable-legacy=off&quot; -net &quot;user,hostfwd=tcp::5022-:22,hostfwd=tcp::23946-:23946&quot; -dtb ./arm/versatile-pb-buster.dtb -kernel ./arm/kernel-qemu-5.4.51-buster -append &quot;root=/dev/vda2 panic=1&quot; -no-reboot -net nic</span><br><span class="line"># 可以 ssh 连接树莓派， ssh pi@127.0.0.1 </span><br><span class="line"># 2. 运行 ida72 的 armlinux_server</span><br><span class="line">./armlinux_server</span><br><span class="line"># 3. 使用 ida72 来连接</span><br></pre></td></tr></table></figure>
<span id="more"></span>
<p>引用：</p>
<p>[1] <a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1867083">https://cloud.tencent.com/developer/article/1867083</a></p>
<h2 id="0x01-IDA的使用"><a href="#0x01-IDA的使用" class="headerlink" title="0x01 IDA的使用"></a>0x01 IDA的使用</h2><p>参考链接1：<a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/4205">https://xz.aliyun.com/t/4205</a></p>
<p>参考链接2：<a target="_blank" rel="noopener" href="https://leeyuxun.github.io/IDA%E5%9F%BA%E7%A1%80%E5%8A%9F%E8%83%BD%E6%80%BB%E7%BB%93.html">https://leeyuxun.github.io/IDA%E5%9F%BA%E7%A1%80%E5%8A%9F%E8%83%BD%E6%80%BB%E7%BB%93.html</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">R               //数字转字符快捷键</span><br><span class="line">&quot;Edit&quot;–&quot;Patch program&quot;–&quot;Assemble&quot; 修改汇编指令</span><br><span class="line">X               //查看引用</span><br><span class="line">P               //创建函数</span><br><span class="line">E               //选中某些数据重新编码</span><br><span class="line">tab 键          //伪代码与汇编来回切换</span><br><span class="line">空格键          //汇编与控制流图切换</span><br><span class="line">ALT+B          //搜索字符</span><br><span class="line">byte not defined：from idc_bc695 import *</span><br><span class="line">A              //将数据转换为字符串</span><br><span class="line">f5             //一键反汇编</span><br><span class="line">esc            //回退键，能够倒回上一部操作的视图（只有在反汇编窗口才是这个作用，如果是在其他窗口按下esc，会关闭该窗口）</span><br><span class="line">shift+f12      //可以打开string窗口，一键找出所有的字符串，右击setup，还能对窗口的属性进行设置</span><br><span class="line">ctrl+w         //保存ida数据库</span><br><span class="line">ctrl+s         //选择某个数据段，直接进行跳转</span><br><span class="line">ctrl+鼠标滚轮   //能够调节流程视图的大小</span><br><span class="line">X              //对着某个函数、变量按该快捷键，可以查看它的交叉引用</span><br><span class="line">G              //直接跳转到某个地址</span><br><span class="line">N              //更改变量的名称</span><br><span class="line">Y              //更改变量的类型</span><br><span class="line">/              //在反编译后伪代码的界面中写下注释</span><br><span class="line">\              //在反编译后伪代码的界面中隐藏/显示变量和函数的类型描述，有时候变量特别多的时候隐藏掉类型描述看起来会轻松很多</span><br><span class="line">;              //在反汇编后的界面中写下注释</span><br><span class="line">ctrl+shift+w   //拍摄IDA快照</span><br><span class="line">U              //undefine，取消定义函数、代码、数据的定义</span><br><span class="line">H              //在数字上按下H键或者右键进行选择，可以将数字转化为十进制</span><br><span class="line">B              //转换为二进制也是同理。</span><br><span class="line">c              //将数据段转化成代码</span><br><span class="line">K              //将数据解释为栈变量</span><br><span class="line">M              //解释为枚举成员</span><br><span class="line">O              //解释地址为数据段偏移量，用于字符串标号</span><br><span class="line">T              //解释数据为结构体成员</span><br><span class="line">Y              //修改参数类型</span><br><span class="line">D              //将字节变为数据</span><br><span class="line">O              //指定操作数是地址还是数据</span><br><span class="line">Shift+F5       //添加sig文件</span><br><span class="line">Alt+F9         //执行直到返回到用户代码段</span><br><span class="line">Alt+F7         //加载python script插件</span><br><span class="line">选中+options+setdatatypes //将byte数据变为4字节数据等</span><br><span class="line">shift+E        //将二进制数据导出为不同的格式数据，快捷键</span><br><span class="line">enter          //跟进函数实现</span><br><span class="line">Alt+Q          //将数据变为某结构体</span><br><span class="line">Alt+P          //修正栈帧</span><br></pre></td></tr></table></figure>
<p>&emsp;查看堆栈是否平衡：”Options”–”General”–”Disassembly”-“Stack pointer”。</p>
<p>&emsp;数据转换：Q: 十六进制、H：十进制、R: 字符、A：普通字符串。</p>
<p>&emsp;<code>__int64 v8; *(_BYTE *)(v8 + i)</code>变为<code>v8[i]</code>：将<code>__int64 v8;</code>变为<code>char *v8;</code>即可。</p>
<p>&emsp;IDA-&gt;edit-&gt;Patch program-&gt;Assemble修改，然后 IDA-&gt;edit-&gt;Patch program-&gt;Apply patches to input file即可得到修改后的文件。patch之后调试可能与patch后的程序不同，所以记得要File-&gt;Load File-&gt;Reload the input file。</p>
<p>&emsp;插入结构体：View -&gt; Open subviews -&gt; Local Types -&gt; Insert new。</p>
<p>&emsp;插入 emum，类似于：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">const</span> (</span><br><span class="line">	EncModeAuto = <span class="number">0</span></span><br><span class="line">	EncModeNone encMode = <span class="number">1</span></span><br><span class="line">	EncModeNumeric = <span class="number">2</span></span><br><span class="line">	EncModeAlphanumeric = <span class="number">4</span></span><br><span class="line">	EncModeByte = <span class="number">8</span></span><br><span class="line">	EncModeJP = <span class="number">16</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>&emsp;View -&gt; Open subviews -&gt; Enums -&gt; Insert new。之后使用 Add enum member 添加值。</p>
<p>&emsp;idapython使用：<a target="_blank" rel="noopener" href="https://lingze.xyz/book/reverse/ida_python/">https://lingze.xyz/book/reverse/ida_python/</a></p>
<p>&emsp;创建新的segment：Edit-&gt;Segments-&gt;CreateSegment</p>
<p>&emsp;添加结构体的几种姿势：<a target="_blank" rel="noopener" href="https://thinkycx.me/2019-07-15-how-to-create-structs-in-IDA.html">链接</a></p>
<p>&emsp;dump内存：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> idaapi</span><br><span class="line">start_address, data_length = xx, xx</span><br><span class="line">dump_file = xx</span><br><span class="line">data = idaapi.dbg_read_memory(start_address, data_length)</span><br><span class="line">fp = <span class="built_in">open</span>(dump_file, <span class="string">&#x27;wb&#x27;</span>)</span><br><span class="line">fp.write(data)</span><br><span class="line">fp.close()</span><br></pre></td></tr></table></figure>
<p>&emsp;ida中，正偏移为参数，负偏移为局部变量。如下所示：</p>
<p><img src="/images/tool-use/image-20230816231059579.png" alt="image-20230816231059579" style="zoom:67%;" /></p>
<p>&emsp;创建数组<code>*</code>，如下所示，在var_10上按<code>*</code>：</p>
<p><img src="/images/tool-use/image-20230816231322628.png" alt="image-20230816231322628" style="zoom:67%;" /></p>
<p>&emsp;窗口还原：<code>windows-&gt;Reset Desktop</code>。</p>
<p>&emsp;将数值变为常量：ida提供了命名常量目录，如果目录中不存在，可以手动添加库，进而添加常量（<code>view-&gt;open subviews-&gt;type libraries</code>）。</p>
<h3 id="插件"><a href="#插件" class="headerlink" title="插件"></a>插件</h3><p>&emsp;<strong>keypatch：</strong>修改x86、x64、arm等架构的代码。</p>
<p>&emsp;<strong>findcrypt3：</strong>查找使用的加密算法。</p>
<p>&emsp;<strong>Go_parser：</strong>alt+F7执行此脚本。</p>
<h3 id="ida-qiling"><a href="#ida-qiling" class="headerlink" title="ida+qiling"></a>ida+qiling</h3><p>&emsp;以<code>Qiling-study</code>的<code>challenge1</code>脚本为例，加入<code>ql.debugger = &#39;gdb:0.0.0.0:12346&#39;</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> qiling <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">challenge1</span>(<span class="params">ql</span>):</span><br><span class="line">    <span class="comment"># 以0x1000为起始，映射0x1000大小的数据，映射的大小必须是页大小的倍数，这里的页大小4096字节</span></span><br><span class="line">    <span class="comment"># info是对这部分内存做的一个标记，后续可以用这个标记来定位</span></span><br><span class="line">    ql.mem.<span class="built_in">map</span>(<span class="number">0x1000</span>, <span class="number">0x1000</span>, info = <span class="string">&#x27;[challenge1]&#x27;</span>)</span><br><span class="line">    <span class="comment"># 将整数值 1337 转换为一个16位字节写入内存地址 0x1337 所指定的内存位置，小端输入</span></span><br><span class="line">    ql.mem.write(<span class="number">0x1337</span>, ql.pack16(<span class="number">1337</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    path = [<span class="string">&quot;./qiling/examples/rootfs/x8664_linux/qilinglab-x86_64&quot;</span>]</span><br><span class="line">    rootfs = <span class="string">&quot;./qiling/examples/rootfs/x8664_linux&quot;</span></span><br><span class="line">    ql = Qiling(path, rootfs)</span><br><span class="line">    challenge1(ql)</span><br><span class="line">    ql.debugger = <span class="string">&#x27;gdb:0.0.0.0:12346&#x27;</span></span><br><span class="line">    ql.run()</span><br></pre></td></tr></table></figure>
<p>&emsp;运行此脚本，并设置<code>ida</code>：</p>
<p><img src="/images/tool-use/image-20230706205640712.png" alt="image-20230706205640712" style="zoom:67%;" /></p>
<p><img src="/images/tool-use/image-20230706205723508.png" alt="image-20230706205723508" style="zoom:67%;" /></p>
<p>&emsp;注意，<code>192.167.75.138</code>为虚拟机地址，要调试的文件路径必须在<code>..../rootfs/x8664_linux/filename</code>中（如果调试的是<code>x64</code>文件的话）。</p>
<h3 id="ida-gdb"><a href="#ida-gdb" class="headerlink" title="ida+gdb"></a>ida+gdb</h3><p>&emsp;虚拟机中运行：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo gdbserver *:7777 program_name</span><br></pre></td></tr></table></figure>
<p>&emsp;本地ida配置为gdb debugger即可。</p>
<h2 id="0x02-x64dbg"><a href="#0x02-x64dbg" class="headerlink" title="0x02 x64dbg"></a>0x02 x64dbg</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">F7             //步进</span><br><span class="line">alt + e        //进入符号栏</span><br><span class="line">F8             //步过 </span><br><span class="line">F9             //运行 </span><br><span class="line">Ctrl+F9        //运行到返回 </span><br><span class="line">F2             //打断点 </span><br><span class="line">Ctrl+G         //跳到某个位置</span><br><span class="line">space          //修改本行指令</span><br><span class="line">ctrl+P+修补文件 //保存patch后的文件</span><br></pre></td></tr></table></figure>
<p>scylla插件步骤：</p>
<p><img src="/images/tool-use/1665825294551-63f5a64d-a0d9-47fa-837c-941798a51f0c.png" alt="image.png" style="zoom:67%;" /></p>
<p><strong>ida与x64gdb地址对齐：</strong></p>
<p>&emsp;使用alt+e进入符号栏，看x64gdb的程序基址，然后调整ida为 edit-&gt;segments-&gt;rebase program。</p>
<h2 id="0x03-Ollydbg的使用"><a href="#0x03-Ollydbg的使用" class="headerlink" title="0x03 Ollydbg的使用"></a>0x03 Ollydbg的使用</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Ctrl + F2   // 重启调试器</span><br><span class="line">F12         // 让程序暂停</span><br><span class="line">SHIFT + F4  // 设置条件记录断点</span><br><span class="line">F2          // 断点</span><br><span class="line">F3          // 加载可执行程序</span><br><span class="line">F4          // 运行到光标处</span><br><span class="line">F5          // 缩小还原当前窗口</span><br><span class="line">Alt + F9    // 执行到用户代码处，用户跳出系统函数</span><br><span class="line">Ctrl + G    // 跳到16进制地址处</span><br></pre></td></tr></table></figure>
<ul>
<li>定位文件中某dll的某函数：</li>
</ul>
<p>（1）<code>View -&gt; Executable Modules</code>，点击要定位的dll。</p>
<p>（2）Ctrl+N，之后输入函数名。</p>
<h2 id="0x04-Windbg使用"><a href="#0x04-Windbg使用" class="headerlink" title="0x04 Windbg使用"></a>0x04 Windbg使用</h2><p>[2] <a target="_blank" rel="noopener" href="https://learn.microsoft.com/zh-cn/windows-hardware/drivers/debugger/getting-started-with-windbg">https://learn.microsoft.com/zh-cn/windows-hardware/drivers/debugger/getting-started-with-windbg</a></p>
<p>很全面：<a target="_blank" rel="noopener" href="https://blog.csdn.net/mofabang/article/details/49678729">https://blog.csdn.net/mofabang/article/details/49678729</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">ctrl + e                      // 加载程序</span><br><span class="line">.sympath srv*                 // 符号搜索路径指示 WinDbg 查找符号 (PDB) 文件的位置。 调试器需要符号文件来获取有关代码模块的信息，例如函数名称和变量名称。</span><br><span class="line">.reload                       // 指示 WinDbg 执行初始搜索以查找和加载符号文件。</span><br><span class="line">x notepad!*                   // 查看notepad.exe模块的符号</span><br><span class="line">x notepad!wWin*               // 查看包含 main的 notepad.exe 模块中的符号</span><br><span class="line">bu notepad!wWinMain           // 在 notepad!wWinMain 放置断点</span><br><span class="line">bl                            // 输出断点列表</span><br><span class="line">bc breakpoint                 // 删除断点</span><br><span class="line">g                             // 运行进程</span><br><span class="line">u                             // 显示反汇编代码</span><br><span class="line">d                             // 显示内存数据</span><br><span class="line">e                             // 修改内存数据</span><br><span class="line">lm                            // 查看进程中当前加载的代码模块的列表</span><br><span class="line">k                             // 查看堆栈跟踪。</span><br><span class="line">~                             // 查看进程中所有线程的列表</span><br><span class="line">~0s                           // 查看线程 0 的堆栈跟踪</span><br><span class="line">!analyze -v                   // 自动分析程序崩溃原因</span><br><span class="line">dt nt!_FILE_OBJECT            // 检查 _FILE_OBJECT 模块中的 nt 数据类型</span><br><span class="line">x nt!*CreateProcess*          // 检查模块中的 nt 一些符号</span><br><span class="line">!process 0 0                  // 查看所有进程的列表</span><br><span class="line">!process 进程地址 2            // 显示此进程的所有线程</span><br><span class="line">!thread 线程地址               // 显示此线程的信息</span><br><span class="line">!db 与 db                     // 一个是读物理地址，一个是读虚拟地址</span><br><span class="line">p                             // 单步执行</span><br><span class="line">pa                            // 执行到指定地址</span><br><span class="line">pt                            // 执行到返回指令</span><br><span class="line">pc                            // 执行到call指令</span><br><span class="line">gu                            // 执行到函数返回</span><br><span class="line">dq rsp                        // dq rsp 命令表示显示当前线程d的栈顶地址（即堆栈指针 rsp 的值）指向的 8 字节数据。</span><br><span class="line">lm                            // 查看模块数据</span><br><span class="line">.sympath                      // 查看当前符号</span><br><span class="line">u $ip L10                     // 查看$ip处的10条汇编指令</span><br><span class="line">r rcx=1                       // 修改rcx=1</span><br><span class="line">g $exentry                    // 执行到入口代码</span><br><span class="line">rdmsr 3ah                     // 读取标号为 3a 的 MSR 寄存器</span><br><span class="line">dv /t                         // 查看局部变量</span><br><span class="line">x &lt;ModuleName&gt;!&lt;VariableName&gt; // 查看全局变量，使用 lm 查找所有模块</span><br><span class="line">dps addr                      // 查看堆栈内容</span><br><span class="line">!vtop cr3_addr vitual_addr    // 将虚拟地址转为物理地址</span><br><span class="line"></span><br><span class="line">// 设置并加载符号</span><br><span class="line">.sympath SRV*c:\mySymbols*http://msdl.microsoft.com/download/symbols</span><br><span class="line">.reload</span><br><span class="line"></span><br><span class="line">// .ecxr 是一个调试命令，用于将当前线程的上下文环境设置为异常发生时的线程上下文。该命令通常用于在调试 Windows 应用程序时分析异常调用栈和异常发生时的线程上下文信息。</span><br><span class="line">.ecxr</span><br><span class="line"></span><br><span class="line">// 将地址范围 0x1000 到 0x2000 内的所有数据保存到文件 data.bin 中</span><br><span class="line">.writemem data.bin 0x1000 0x2000</span><br></pre></td></tr></table></figure>
<p><img src="/images/tool-use/image-20230424143500201.png" alt="image-20230424143500201" style="zoom:70%;" /></p>
<p>注：</p>
<ul>
<li>堆栈跟踪。堆栈跟踪（stack trace）是一种调试技术，用于追踪程序在执行过程中的调用链路。在程序执行过程中，每当一个函数或子程序被调用时，CPU会将当前函数的返回地址和一些其他信息（如函数参数、局部变量等）保存在堆栈中。这些信息构成了一个堆栈帧（stack frame）。堆栈跟踪就是通过分析堆栈中保存的堆栈帧信息，来确定程序执行过程中的调用链路。</li>
</ul>
<h4 id="windbg-win7双机调试"><a href="#windbg-win7双机调试" class="headerlink" title="windbg+win7双机调试"></a>windbg+win7双机调试</h4><p>链接：<a target="_blank" rel="noopener" href="https://blog.csdn.net/sagittarius_warrior/article/details/51305046">https://blog.csdn.net/sagittarius_warrior/article/details/51305046</a></p>
<p>&emsp;主机启动windbg时：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">windbg.exe -b -k com:pipe,port=\\.\pipe\com_1,resets=0</span><br></pre></td></tr></table></figure>
<h2 id="0x05-qemu使用"><a href="#0x05-qemu使用" class="headerlink" title="0x05 qemu使用"></a>0x05 qemu使用</h2><h3 id="risc-v环境搭建"><a href="#risc-v环境搭建" class="headerlink" title="risc_v环境搭建"></a>risc_v环境搭建</h3><p><code>qemu+risc_v+linux</code>环境搭建：<code>https://bbs.kanxue.com/thread-272645.htm</code></p>
<p>命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">qemu-system-riscv64 \</span><br><span class="line">    -machine virt \</span><br><span class="line">    -cpu rv64 \</span><br><span class="line">    -m 1G \</span><br><span class="line">    -device virtio-net-device,netdev=net \</span><br><span class="line">    -netdev user,id=net,hostfwd=tcp::2222-:22 \</span><br><span class="line">    -device virtio-blk-device,drive=hd \</span><br><span class="line">    -drive file=./Image/artifacts/overlay.qcow2,if=none,id=hd \</span><br><span class="line">    -bios /usr/lib/riscv64-linux-gnu/opensbi/generic/fw_jump.elf \</span><br><span class="line">    -kernel /usr/lib/u-boot/qemu-riscv64_smode/uboot.elf \</span><br><span class="line">    -append &quot;root=LABEL=rootfs console=ttyS0&quot; \</span><br><span class="line">    -nographic \</span><br><span class="line">    -fsdev local,security_model=passthrough,id=fsdev0,path=./share \</span><br><span class="line">    -device virtio-9p-pci,id=fs0,fsdev=fsdev0,mount_tag=hostshare</span><br></pre></td></tr></table></figure>
<p>命令解释： </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">-cpu rv64 \\ RISC-V 64位cpu</span><br><span class="line">-m 1G \\ 为客户机分配1GB运行内存</span><br><span class="line">-netdev user,id=net,hostfwd=tcp::2222-:22 \\ 转发22端口到localhost:2222。这样可以在外面远程SSH连接</span><br><span class="line">-bios /usr/lib/riscv64-linux-gnu/opensbi/generic/fw_jump.elf \\ 指纹识别，人脸识别等，没啥用</span><br><span class="line">-append &quot;root=LABEL=rootfs console=ttyS0&quot; \\ 内核启动参数，默认就好</span><br><span class="line">-kernel /usr/lib/u-boot/qemu-riscv64_smode/uboot.elf \\ 设置嵌入式系统引导程序</span><br><span class="line">-nographic \\ 禁用图形输出</span><br><span class="line"></span><br><span class="line">\\ 宿主机和客户机之间创建一个普通的文件夹</span><br><span class="line">-fsdev local,security_model=passthrough,id=fsdev0,path=./share \</span><br><span class="line">-device virtio-9p-pci,id=fs0,fsdev=fsdev0,mount_tag=hostshare</span><br></pre></td></tr></table></figure>
<p>&emsp;还需要在客户机（risc_v）上执行如下脚本</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SHARED_FOLDER=&quot;/mnt/share&quot;</span><br><span class="line"># Create shared folder</span><br><span class="line">mkdir $&#123;SHARED_FOLDER&#125;</span><br><span class="line">mount -t 9p -o trans=virtio,version=9p2000.L hostshare $&#123;SHARED_FOLDER&#125;</span><br></pre></td></tr></table></figure>
<p> &emsp;上述搭建流程有点问题：好多文件找不到，例如<code>/usr/lib/riscv64-linux-gnu/opensbi/generic/fw_jump.elf</code>、<code>/usr/lib/u-boot/qemu-riscv64_smode/uboot.elf</code>等。</p>
<p>&emsp;因此，又找了一篇文章<code>https://risc-v-getting-started-guide.readthedocs.io/en/latest/linux-qemu.html</code>，根据它搭建环境。<strong><code>https://zhuanlan.zhihu.com/p/258394849</code>写的也不错，安装流程比较全</strong>。</p>
<p>&emsp;安装之后，设置共享文件夹，参考链接如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://pwn4.fun/2020/05/27/Qemu%E8%99%9A%E6%8B%9F%E6%9C%BA%E4%B8%8E%E5%AE%BF%E4%B8%BB%E6%9C%BA%E4%B9%8B%E9%97%B4%E6%96%87%E4%BB%B6%E4%BC%A0%E8%BE%93/</span><br><span class="line">https://blog.csdn.net/jcf147/article/details/124477915</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">1. 创建img文件</span><br><span class="line">dd if=/dev/zero of=$PWD/share.img bs=1M count=1000</span><br><span class="line"></span><br><span class="line">2. 格式化文件</span><br><span class="line">mkfs.ext4 $PWD/share.img</span><br><span class="line"></span><br><span class="line">3. 在宿主机上创建要共享的文件夹并挂载到share.img</span><br><span class="line">mkdir /tmp/share</span><br><span class="line">sudo mount -o loop $PWD/share.img /tmp/share</span><br><span class="line"></span><br><span class="line">4. 向/tmp/share中放文件</span><br><span class="line"></span><br><span class="line">5. 启动qemu客户机，加一块硬盘</span><br><span class="line">-drive file=$PWD/share.img,if=virtio</span><br><span class="line">全部的命令为：</span><br><span class="line">qemu-system-riscv64 -M virt -m 256M -nographic -kernel linux/arch/riscv/boot/Image -drive file=rootfs.img,format=raw,id=hd0 -drive file=share.img,if=virtio -device virtio-blk-device,drive=hd0 -append &quot;root=/dev/vda rw console=ttyS0&quot;</span><br><span class="line"></span><br><span class="line">6. 在客户机中将硬盘挂载到/share文件夹</span><br><span class="line">mount -t ext4 /dev/vda(或者是/dev/vdb) /share</span><br><span class="line"></span><br><span class="line">该方法的缺点:宿主机和虚拟机文件传输不能实时进行，如果要传输新文件，需要重启虚拟机。</span><br></pre></td></tr></table></figure>
<p>虚拟机退出：<code>CTRL+A、X</code></p>
<h2 id="0x06-mumu-jeb调试"><a href="#0x06-mumu-jeb调试" class="headerlink" title="0x06 mumu+jeb调试"></a>0x06 mumu+jeb调试</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">jeb 常用指令</span><br><span class="line"></span><br><span class="line">n         //重命名</span><br><span class="line">Enter     //双击跟踪</span><br><span class="line">Esc       //返回</span><br><span class="line">Ctrl+Enter//前进</span><br><span class="line">H         //帮助</span><br><span class="line">I         //条目信息</span><br><span class="line">X         //交叉引用，Ctrl + X    源码交叉引用</span><br><span class="line">;or C     //注释</span><br><span class="line">B         //改变进制数</span><br><span class="line">Tab       //反编译</span><br><span class="line">ctrl+B    //打断点</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">adb 使用</span><br><span class="line"></span><br><span class="line">adb kill-server                 // 终止正在运行的 ADB 服务器进程</span><br><span class="line">adb connect 127.0.0.1:7555      // 连接到 mumu</span><br><span class="line">adb -s 4TIN8TZ9YD5DPFKV shell   // 打开设备4TIN8TZ9YD5DPFKV的一个shell，USB链接</span><br><span class="line">adb -s 4TIN8TZ9YD5DPFKV push myfile /data/local/tmp  // 向设备4TIN8TZ9YD5DPFKV发送文件</span><br><span class="line">adb install -r game_signed.apk  // 安装程序game_signed.apk</span><br><span class="line">adb devices                     // 查看当前连接的设备</span><br><span class="line">adb root                        // 以 root 权限运行 adb</span><br><span class="line">adb shell / exit                // 进入/退出 shell</span><br><span class="line">adb shell pm list packages      // 列出手机装的所有app 的包名</span><br></pre></td></tr></table></figure>
<h2 id="0x07-apktool使用"><a href="#0x07-apktool使用" class="headerlink" title="0x07 apktool使用"></a>0x07 apktool使用</h2><p>[1] <a target="_blank" rel="noopener" href="https://www.jianshu.com/p/919a966843c4">https://www.jianshu.com/p/919a966843c4</a></p>
<p>[2] <a target="_blank" rel="noopener" href="https://crifan.github.io/android_re_repack_apk/website/repack_process/redo_sign.html">https://crifan.github.io/android_re_repack_apk/website/repack_process/redo_sign.html</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apktool d libdroid_fixed.apk -o unzip  // 将libdroid_fixed.apk反编译到unzip文件夹中</span><br></pre></td></tr></table></figure>
<p>&emsp;更改apk反编译的文件后(<code>android:debuggable=&quot;true&quot;</code>)，重新编译成apk，并进行重新签名。</p>
<p>&emsp;重新编译apk如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apktool b unzip -o 11.apk</span><br></pre></td></tr></table></figure>
<p>&emsp;首先，生成keystone文件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">keytool -genkeypair -v -keystore thunderRepack.keystore -keyalg RSA -keysize 2048 -validity 10000 -alias thunderRepack</span><br></pre></td></tr></table></figure>
<p>&emsp;之后，用jarsigner对apk签名：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jarsigner -verbose -digestalg SHA1 -sigalg SHA1withRSA -keystore thunderRepack.keystore -signedjar 签名后的文件 要签名的文件 前面指定的alias别名</span><br></pre></td></tr></table></figure>
<p>&emsp;用zipalign给重新打包后的apk去对齐：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zipalign 4 对齐前apk 对齐后apk</span><br></pre></td></tr></table></figure>
<h2 id="0x08-mumu-ida调试"><a href="#0x08-mumu-ida调试" class="headerlink" title="0x08 mumu+ida调试"></a>0x08 mumu+ida调试</h2><p>[1] <a target="_blank" rel="noopener" href="https://chan-shaw.github.io/2020/04/05/IDA-%E5%8A%A8%E6%80%81%E8%B0%83%E8%AF%95/">https://chan-shaw.github.io/2020/04/05/IDA-%E5%8A%A8%E6%80%81%E8%B0%83%E8%AF%95/</a></p>
<h2 id="0x09-frida使用"><a href="#0x09-frida使用" class="headerlink" title="0x09 frida使用"></a>0x09 frida使用</h2><p>&emsp;Frida是以python为载体，注入Javascript作为<strong>Android中执行代码</strong>的一款Hook框架。</p>
<p>&emsp;客户端安装：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install frida-tools</span><br></pre></td></tr></table></figure>
<p>&emsp;服务端安装：在网站<code>https://github.com/frida/frida/releases?page=2</code>上下载对应的frida-server版本（<strong>注意模拟器一定要下载x86版本</strong>），并使用adb推送到mumu上，并添加运行权限，并运行<code>./frida-server-16.0.2-android-x86_64</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">adb push frida-server-16.0.2-android-arm /data/local/tmp</span><br><span class="line">./frida-server-16.0.2-android-x86_64</span><br></pre></td></tr></table></figure>
<p>&emsp;客户端开启端口转发：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">adb forward tcp:27042 tcp:27042</span><br><span class="line">adb forward tcp:27043 tcp:27043</span><br></pre></td></tr></table></figure>
<p>&emsp;使用<code>frida-ps -R</code>查看手机端进程，显示成功。这样frida就配置好了。</p>
<p>&emsp;frida gadget使用（无需root）：<code>https://blog.csdn.net/helloworlddm/article/details/109680109</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">frida -U com.android.settings -l hello.js // 以attach模式运行Hello.js脚本</span><br></pre></td></tr></table></figure>
<p>&emsp;frida读取文件：<a target="_blank" rel="noopener" href="https://bbs.kanxue.com/thread-278134.htm">https://bbs.kanxue.com/thread-278134.htm</a></p>
<h2 id="0x10-win7搭建ftp"><a href="#0x10-win7搭建ftp" class="headerlink" title="0x10 win7搭建ftp"></a>0x10 win7搭建ftp</h2><p>[1] <a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_73792568/article/details/128624878">https://blog.csdn.net/m0_73792568/article/details/128624878</a></p>
<p>&emsp;win7禁用签名：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bcdedit.exe -set loadoptions DDISABLE_INTEGRITY_CHECKS</span><br><span class="line">bcdedit /set testsigning on</span><br></pre></td></tr></table></figure>
<h2 id="0x11-OP-TEE环境搭建（qemu-v7）"><a href="#0x11-OP-TEE环境搭建（qemu-v7）" class="headerlink" title="0x11 OP-TEE环境搭建（qemu v7）"></a>0x11 OP-TEE环境搭建（qemu v7）</h2><p>（1）在ubuntu20.04上运行以下命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install \</span><br><span class="line">  android-tools-adb \</span><br><span class="line">  android-tools-fastboot \</span><br><span class="line">  autoconf \</span><br><span class="line">  automake \</span><br><span class="line">  bc \</span><br><span class="line">  bison \</span><br><span class="line">  build-essential \</span><br><span class="line">  ccache \</span><br><span class="line">  cscope \</span><br><span class="line">  curl \</span><br><span class="line">  device-tree-compiler \</span><br><span class="line">  expect \</span><br><span class="line">  flex \</span><br><span class="line">  ftp-upload \</span><br><span class="line">  gdisk \</span><br><span class="line">  iasl \</span><br><span class="line">  libattr1-dev \</span><br><span class="line">  libcap-dev \</span><br><span class="line">  libfdt-dev \</span><br><span class="line">  libftdi-dev \</span><br><span class="line">  libglib2.0-dev \</span><br><span class="line">  libgmp3-dev \</span><br><span class="line">  libhidapi-dev \</span><br><span class="line">  libmpc-dev \</span><br><span class="line">  libncurses5-dev \</span><br><span class="line">  libpixman-1-dev \</span><br><span class="line">  libssl-dev \</span><br><span class="line">  libtool \</span><br><span class="line">  make \</span><br><span class="line">  mtools \</span><br><span class="line">  netcat \</span><br><span class="line">  ninja-build \</span><br><span class="line">  python3-crypto \</span><br><span class="line">  python3-cryptography \</span><br><span class="line">  python3-pip \</span><br><span class="line">  python3-pyelftools \</span><br><span class="line">  python3-serial \</span><br><span class="line">  rsync \</span><br><span class="line">  unzip \</span><br><span class="line">  uuid-dev \</span><br><span class="line">  xdg-utils \</span><br><span class="line">  xterm \</span><br><span class="line">  xz-utils \</span><br><span class="line">  zlib1g-dev</span><br></pre></td></tr></table></figure>
<p>（2）运行如下命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mkdir optee</span><br><span class="line">cd optee</span><br><span class="line">// 下载仓库并进行同步，这一步可能有问题，见 https://blog.csdn.net/Thanksgining/article/details/108848825</span><br><span class="line">repo init -u https://github.com/OP-TEE/manifest.git</span><br><span class="line">repo sync</span><br><span class="line">cd build</span><br><span class="line">make toolchains</span><br><span class="line">make run</span><br><span class="line">// 会打开两个终端，normal world与secure world</span><br><span class="line">c // 进入normal world的控制台</span><br></pre></td></tr></table></figure>
<p>（3）此时会进入<code>normal world</code>与<code>secure world</code>的两个终端，在<code>normal world</code>终端内运行<code>xtest</code>与<code>optee_example_hello_world</code>来测试环境是否搭建完成。</p>
<p><img src="/images/tool-use/image-20230713165453429.png" alt="image-20230713165453429" style="zoom:67%;" /></p>
<h2 id="0x12-搭建qemu-armv7环境"><a href="#0x12-搭建qemu-armv7环境" class="headerlink" title="0x12 搭建qemu-armv7环境"></a>0x12 搭建qemu-armv7环境</h2><p>（1）下载<a target="_blank" rel="noopener" href="https://buildroot.org/">buildroot</a>。Buildroot是一个简单、高效、易于使用的工具，用于通过交叉编译生成嵌入式Linux系统。</p>
<p>（2）进入buildroot目录下，运行下面3条指令（最好不要在<code>conda</code>环境中运行）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ls configs/qemu_arm_ve*          // 列出所有以 qemu_arm_ve 开头的配置文件</span><br><span class="line">make qemu_arm_vexpress_defconfig // 用 QEMU ARM VExpress 的默认配置文件，生成 .config 文件</span><br><span class="line">make                             // 构建 Buildroot 工具链和目标系统，生成交叉编译工具链和目标系统所需的文件和镜像</span><br></pre></td></tr></table></figure>
<p>（3）下载<a target="_blank" rel="noopener" href="https://download.qemu.org/"><code>qemu-6.2.0.tar.bz2</code></a>，并解压。</p>
<p>（4）进入此目录，运行下面3条指令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd qemu-6.2.0/</span><br><span class="line">mkdir build</span><br><span class="line">cd build/</span><br></pre></td></tr></table></figure>
<p>（5）下载依赖包：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install ninja-build autoconf libpixman-1-dev libpixman-1-0 libsdl1.2-dev libtool libglib2.0-dev</span><br></pre></td></tr></table></figure>
<p>（6）配置<code>qemu</code>编译环境、进行编译并安装：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">../configure --target-list=arm-softmmu --audio-drv-list=</span><br><span class="line">make -j8</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>
<p>（7）运行qemu：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">qemu-system-arm</span><br><span class="line">-M vexpress-a9 </span><br><span class="line">-m 512M </span><br><span class="line">-kernel /home/xxxx/buildroot-2022.02.6/output/images/zImage </span><br><span class="line">-dtb /home/xxxx/buildroot-2022.02.6/output/images/vexpress-v2p-ca9.dtb </span><br><span class="line">-nographic </span><br><span class="line">-append &quot;root=/dev/mmcblk0 console=ttyAMA0&quot; </span><br><span class="line">-sd /home/zhao/buildroot-2022.02.6/output/images/rootfs.ext2</span><br></pre></td></tr></table></figure>
<ul>
<li><code>qemu-system-arm</code>：要启动的 QEMU 系统镜像</li>
<li><code>-M vexpress-a9</code>：模拟的硬件平台为 vexpress-a9，即基于 ARM Cortex-A9 处理器的开发板</li>
<li><code>-m 512M</code>：512MB 的内存</li>
<li><code>-kernel /home/xxxx/buildroot-2022.02.6/output/images/zImage</code>：要加载的 Linux 内核映像文件路径</li>
<li><code>-dtb /home/xxxx/buildroot-2022.02.6/output/images/vexpress-v2p-ca9.dtb</code>：要加载的设备树二进制文件路径，用于描述模拟硬件的设备信息</li>
<li><code>-nographic</code>：</li>
<li><code>-append &quot;root=/dev/mmcblk0 console=ttyAMA0&quot;</code>：要传递给内核的启动参数，其中 <code>root=/dev/mmcblk0</code> 表示根文件系统所在的设备为 MMC 卡，<code>console=ttyAMA0</code> 表示使用串口作为控制台输出。</li>
<li><code>-sd /home/xxx/buildroot-2022.02.6/output/images/rootfs.ext2</code>：要加载的根文件系统映像文件路径，用于提供虚拟机的文件系统。</li>
</ul>
<p>（8）退出qemu环境：<code>ctrl+A,X</code></p>
<h2 id="0x13-搭建qemu-aarch64环境"><a href="#0x13-搭建qemu-aarch64环境" class="headerlink" title="0x13 搭建qemu-aarch64环境"></a>0x13 搭建qemu-aarch64环境</h2><h3 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h3><p>&emsp;qemu-system-arm是用于模拟ARMv7、ARMv6、ARMv5等<strong>32位</strong>ARM架构的处理器的QEMU工具。它可以模拟一系列ARM SoC（System-on-Chip）芯片，例如Versatile，RealView，Integrator等，也可以模拟一些开发板，例如Raspberry Pi，BeagleBoard等。</p>
<p>&emsp;qemu-system-aarch64是用于模拟ARMv8-A架构的<strong>64位</strong>处理器的QEMU工具。它可以模拟一系列ARM SoC芯片，例如Juno，Foundation，Virt等，也可以模拟一些开发板，例如HiKey970，Xilinx ZCU102等。</p>
<h3 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h3><p>（1）安装<code>qemu</code>。（感觉安装了好多次qemu..）安装完之后，可以<code>qemu-system</code>试着补全，我们要的是<code>qemu-system-aarch64</code>。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install qemu qemu-system qemu-user qemu-system-arm</span><br></pre></td></tr></table></figure>
<p>（2）安装<code>aarch64</code>交叉编译工具。具体看<a target="_blank" rel="noopener" href="https://blog.csdn.net/L_lurker/article/details/119061540">链接</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install gcc-10-aarch64-linux-gnu</span><br><span class="line">// 重命名为aarch64-linux-gnu-gcc-10</span><br><span class="line">sudo mv /usr/bin/aarch64-linux-gnu-gcc-10 /usr/bin/aarch64-linux-gnu-gcc</span><br></pre></td></tr></table></figure>
<p>（3）制作根文件系统。下载busybox源码，并指定工具链：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export ARCH=arm64</span><br><span class="line">export CROSS_COMPILE=aarch64-linux-gnu-</span><br></pre></td></tr></table></figure>
<p>&emsp;配置（静态编译build static binary）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make menuconfig 1</span><br></pre></td></tr></table></figure>
<p>&emsp;编译安装：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">make </span><br><span class="line">make install</span><br></pre></td></tr></table></figure>
<p>&emsp;之后的步骤请看<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/373963265">链接</a>。</p>
<p>（4）内核源码编译。看<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/373963265">链接</a>。</p>
<p>（5）运行qemu。看<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/373963265">链接</a>，得改一改指令。</p>
<p>&emsp;最后按照<a target="_blank" rel="noopener" href="https://zhangsz.blog.csdn.net/article/details/131276866">链接</a>进行配置的，qemu共享文件<a target="_blank" rel="noopener" href="http://pwn4.fun/2020/05/27/Qemu%E8%99%9A%E6%8B%9F%E6%9C%BA%E4%B8%8E%E5%AE%BF%E4%B8%BB%E6%9C%BA%E4%B9%8B%E9%97%B4%E6%96%87%E4%BB%B6%E4%BC%A0%E8%BE%93/">链接</a>。</p>
<h2 id="0x14-qemu网络配置"><a href="#0x14-qemu网络配置" class="headerlink" title="0x14 qemu网络配置"></a>0x14 qemu网络配置</h2><p>&emsp;宿主机运行以下脚本，创建网桥<code>br0</code>。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/sh</span><br><span class="line">#sudo ifconfig eth0 down                 # 首先关闭宿主机网卡接口</span><br><span class="line">sudo brctl addbr br0                     # 添加一座名为 br0 的网桥</span><br><span class="line">sudo brctl addif br0 eth0                # 在 br0 中添加一个接口</span><br><span class="line">sudo brctl stp br0 off                   # 如果只有一个网桥，则关闭生成树协议</span><br><span class="line">sudo brctl setfd br0 1                   # 设置 br0 的转发延迟</span><br><span class="line">sudo brctl sethello br0 1                # 设置 br0 的 hello 时间</span><br><span class="line">sudo ifconfig br0 0.0.0.0 promisc up     # 启用 br0 接口</span><br><span class="line">sudo ifconfig eth0 0.0.0.0 promisc up    # 启用网卡接口</span><br><span class="line">sudo dhclient br0                        # 从 dhcp 服务器获得 br0 的 IP 地址</span><br><span class="line">sudo brctl show br0                      # 查看虚拟网桥列表</span><br><span class="line">sudo brctl showstp br0                   # 查看 br0 的各接口信息</span><br></pre></td></tr></table></figure>
<p>&emsp;宿主机运行以下脚本，在<code>br0</code>上新开一个<code>tap0</code>接口。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/sh</span><br><span class="line">sudo tunctl -t tap0 -u root              # 创建一个 tap0 接口，只允许 root 用户访问</span><br><span class="line">sudo brctl addif br0 tap0                # 在虚拟网桥中增加一个 tap0 接口</span><br><span class="line">sudo ifconfig tap0 0.0.0.0 promisc up    # 启用 tap0 接口</span><br><span class="line">sudo brctl showstp br0</span><br></pre></td></tr></table></figure>
<p>&emsp;qemu虚拟机启动时加上：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-nic tap</span><br></pre></td></tr></table></figure>
<h2 id="0x15-gdb常用指令"><a href="#0x15-gdb常用指令" class="headerlink" title="0x15 gdb常用指令"></a>0x15 gdb常用指令</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">r                                        # 运行程序</span><br><span class="line">c                                        # 继续执行，到下一个断点处（或运行结束）</span><br><span class="line">n                                        # 步过</span><br><span class="line">s                                        # 步进</span><br><span class="line">until                                    # 运行程序直到退出循环体</span><br><span class="line">until+行号                               # 运行至某行</span><br><span class="line">finish                                   # 运行程序，直到当前函数完成返回，并打印函数返回时的堆栈地址和返回值及参数值等信息</span><br><span class="line">call 函数(参数)                          # 调用“函数”，并传递“参数”，如：call gdb_test(55)</span><br><span class="line">q                                        # 退出gdb</span><br><span class="line">b n                                      # 在第n行处设置断点，也可以带上代码路径和代码名称，例如 b OAGUPDATE.cpp:578</span><br><span class="line">break func                               # 在函数func()的入口处设置断点，如：break cb_button</span><br><span class="line">delete 断点号n                           # 删除第n个断点</span><br><span class="line">disable 断点号n                          # 停用第n个断点</span><br><span class="line">enable 断点号n                           # 开启第n个断点</span><br><span class="line">clear 行号n                              # 清除第n行的断点</span><br><span class="line">info b                                   # 显示当前程序的断点设置情况</span><br><span class="line">l                                        # 列出程序的源代码，默认每次显示10行。再次输入l，则继续输出10行</span><br><span class="line">list 行号                                # 将显示当前文件以“行号”为中心的前后10行代码，如：list 12</span><br><span class="line">list 函数名                              # 将显示“函数名”所在函数的源代码，如：list main</span><br><span class="line">print 表达式                             # 其中“表达式”可以是任何当前正在被测试程序的有效表达式，比如当前正在调试C语言的程序，那么“表达式”可以是任何C语言的有效表达式，包括数字，变量甚至是函数调用</span><br><span class="line">print a                                  # 将显示整数 a 的值</span><br><span class="line">print ++a                                # 将把 a 中的值加1,并显示出来</span><br><span class="line">print name                               # 将显示字符串 name 的值</span><br><span class="line">print gdb_test(22)                       # 将以整数22作为参数调用 gdb_test() 函数</span><br><span class="line">print gdb_test(a)                        # 将以变量 a 作为参数调用 gdb_test() 函数</span><br><span class="line">display 表达式                           # 在单步运行时将非常有用，使用display命令设置一个表达式后，它将在每次单步进行指令后，紧接着输出被设置的表达式及值。如： display a</span><br><span class="line">watch 表达式                             # 设置一个监视点，一旦被监视的“表达式”的值改变，gdb将强行终止正在被调试的程序。如： watch a</span><br><span class="line">where/bt                                 # 当前运行的堆栈列表</span><br><span class="line">set args 参数                            # 指定运行时的参数</span><br><span class="line">set args &quot;$(python -c &#x27;print(&quot;\x90&quot;)&#x27;)&quot;   # 参数为字节值</span><br><span class="line">show args                                # 查看设置好的参数</span><br><span class="line">info program                             # 来查看程序的是否在运行，进程号，被暂停的原因</span><br><span class="line">layout src                               # 显示源代码窗口</span><br><span class="line">layout asm                               # 显示反汇编窗口</span><br><span class="line">layout regs                              # 显示源代码/反汇编和CPU寄存器窗口</span><br><span class="line">layout split                             # 显示源代码和反汇编窗口</span><br><span class="line">layout next：显示下一个layout</span><br><span class="line">layout prev：显示上一个layout</span><br><span class="line">Ctrl + x，再按1：单窗口模式，显示一个窗口</span><br><span class="line">Ctrl + x，再按2：双窗口模式，显示两个窗口</span><br><span class="line">Ctrl + x，再按a：回到传统模式，即退出layout，回到执行layout之前的调试窗口。</span><br><span class="line">Ctrl + L                                 # 刷新窗口</span><br><span class="line">source xx.py                             # 使用自动化脚本</span><br><span class="line">x/10i addr                               # 某地址之后的10条指令</span><br><span class="line">info inferiors                           # 查看当前正在 GDB 中调试的进程的进程ID</span><br><span class="line">shell cat /proc/pid/maps                 # 查看进程对应的内存映射</span><br><span class="line">disassemble main                         # 查看 main 函数的反汇编</span><br><span class="line">dereference $esp                         # 查看当前栈顶的内容</span><br><span class="line">info functions                           # 列出所有函数</span><br><span class="line">info address main                        # 查看 main 函数的地址</span><br><span class="line">x/10xb addr                              # 按字节查看数据</span><br><span class="line">x/10xw addr                              # 按 32 位查看数据</span><br><span class="line">x/10xg addr                              # 按 64 位查看数据</span><br></pre></td></tr></table></figure>
<p>&emsp;gdb 将某地址改为其它字节（调试时使用）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Step1：info locals 查看局部变量，并使用 p &amp;变量名 查看此变量的地址</span><br><span class="line">Step2：运行 python 脚本，将某地址之后的字节进行修改，具体用法为：</span><br><span class="line">	source modify_mem.py</span><br><span class="line">	modifymem addr 1234 -&gt; 则地址 addr 变为 0x12,0x34</span><br><span class="line">Step3：使用 x/100bx addr 查看修改后的结果</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># modify_mem.py</span></span><br><span class="line"><span class="keyword">import</span> gdb</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ModifyMemory</span>(gdb.Command):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>(ModifyMemory, self).__init__(<span class="string">&quot;modifymem&quot;</span>, gdb.COMMAND_USER)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">invoke</span>(<span class="params">self, arg, from_tty</span>):</span><br><span class="line">        args = arg.split()</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(args) != <span class="number">2</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Usage: modifymem &lt;address&gt; &lt;bytes&gt;&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        </span><br><span class="line">        address = <span class="built_in">int</span>(args[<span class="number">0</span>], <span class="number">16</span>)</span><br><span class="line">        bytes_to_write = <span class="built_in">bytes</span>.fromhex(args[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">        inferior = gdb.inferiors()[<span class="number">0</span>]</span><br><span class="line">        memory = inferior.read_memory(address, <span class="built_in">len</span>(bytes_to_write))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Original memory at <span class="subst">&#123;<span class="built_in">hex</span>(address)&#125;</span>: <span class="subst">&#123;memory&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">        inferior.write_memory(address, bytes_to_write)</span><br><span class="line">        new_memory = inferior.read_memory(address, <span class="built_in">len</span>(bytes_to_write))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;New memory at <span class="subst">&#123;<span class="built_in">hex</span>(address)&#125;</span>: <span class="subst">&#123;new_memory&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">ModifyMemory()</span><br></pre></td></tr></table></figure>
<h2 id="0x16-adb使用"><a href="#0x16-adb使用" class="headerlink" title="0x16 adb使用"></a>0x16 adb使用</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">adb devices // 查看当前所有的设备</span><br><span class="line">adb install xx.apk // 安装apk，路径为宿主机路径</span><br><span class="line">adb shell ps // 列出手机中所有进程的信息</span><br><span class="line">adb shell pm path apk包名 // 获取apk的安装路径</span><br><span class="line">adb push 源文件 手机上的路径</span><br><span class="line">adb pull 手机上的路径 目的地</span><br></pre></td></tr></table></figure>
<h2 id="0x17-vim"><a href="#0x17-vim" class="headerlink" title="0x17 vim"></a>0x17 vim</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:set nu // 显示行号</span><br></pre></td></tr></table></figure>
<h2 id="0x18-objdump"><a href="#0x18-objdump" class="headerlink" title="0x18 objdump"></a>0x18 objdump</h2><p><a target="_blank" rel="noopener" href="https://ivanzz1001.github.io/records/post/linux/2018/04/09/linux-objdump">https://ivanzz1001.github.io/records/post/linux/2018/04/09/linux-objdump</a></p>
<h2 id="0x19-驱动相关"><a href="#0x19-驱动相关" class="headerlink" title="0x19 驱动相关"></a>0x19 驱动相关</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// 打开调试模式</span><br><span class="line">bcdedit.exe /set testsigning on</span><br><span class="line">bcdedit.exe /set nointegritychecks on</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// 安装 sys</span><br><span class="line">sc create wd2711 binPath=&quot;C:\Users\23957\Desktop\MyDriver1.sys&quot; type=kernel start=demand</span><br><span class="line">sc start wd2711</span><br></pre></td></tr></table></figure>
<h2 id="0x20-readELF"><a href="#0x20-readELF" class="headerlink" title="0x20 readELF"></a>0x20 readELF</h2><p><a target="_blank" rel="noopener" href="https://wangchujiang.com/linux-command/c/readelf.html">https://wangchujiang.com/linux-command/c/readelf.html</a></p>
<h2 id="0x21-Ubuntu-gcc-版本切换"><a href="#0x21-Ubuntu-gcc-版本切换" class="headerlink" title="0x21 Ubuntu gcc 版本切换"></a>0x21 Ubuntu gcc 版本切换</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># 添加 gcc-7 版本</span><br><span class="line">sudo apt-get install gcc-7 g++-7</span><br><span class="line">sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-7 70</span><br><span class="line">sudo update-alternatives --install /usr/bin/g++ g++ /usr/bin/g++-7 70</span><br><span class="line"></span><br><span class="line"># 添加 gcc-9 版本</span><br><span class="line">sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-9 90</span><br><span class="line">sudo update-alternatives --install /usr/bin/g++ g++ /usr/bin/g++-9 90</span><br><span class="line"></span><br><span class="line"># 使用此命令切换版本</span><br><span class="line">sudo update-alternatives --config gcc</span><br><span class="line">sudo update-alternatives --config g++</span><br></pre></td></tr></table></figure>
<h2 id="0x22-randare2"><a href="#0x22-randare2" class="headerlink" title="0x22 randare2"></a>0x22 randare2</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">r2 /path/to/your/executable # 打开一个可执行文件</span><br><span class="line">i                           # 查看二进制文件的基本信息</span><br><span class="line">ii                          # 扫描二进制文件的入口点和符号</span><br><span class="line">pd 10                       # 反汇编当前地址的10条指令</span><br><span class="line">pd 2 @ 0x00400550           # 从地址 0x00400550 开始反汇编2条指令</span><br><span class="line">aa                          # 分析所有函数</span><br><span class="line">afl                         # 列出所有已识别的函数</span><br><span class="line">pdf @ sym.main              # 反汇编并打印 main 函数</span><br><span class="line">oo+                         # 以读写方式打开文件</span><br><span class="line">db 0x00400550               # 在地址 0x00400550 处设置断点</span><br><span class="line">dc                          # 继续运行程序</span><br><span class="line">dr                          # 查看寄存器</span><br><span class="line">/c &quot;hello&quot;                  # 搜索字符串 &quot;hello&quot;</span><br><span class="line">/x 41424344                 # 搜索十六进制模式 0x41424344</span><br><span class="line">q                           # 退出 Radare2</span><br><span class="line">ood                         # 加载并开始运行程序</span><br></pre></td></tr></table></figure>

  
	</div>

	<div>
  	<center>
	<div class="pagination">

    
    
    <a href="/2023/03/26/re-part-5/" type="button" class="btn btn-default"><i
                class="fa fa-arrow-circle-o-left"></i> 上一页</a>
    

    <a href="/" type="button" class="btn btn-default"><i class="fa fa-home"></i>Home</a>
    
    <a href="/2023/03/23/peer-DID/" type="button" class="btn btn-default ">下一页<i
                class="fa fa-arrow-circle-o-right"></i></a>
    

    
</div>

    </center>
	</div>


	<!-- comment -->
	
<section id="comment">
    <h2 class="title">留言</h2>

    <!-- 
    <div id="disqus_thread" class="ds-thread">
        <script type="text/javascript">
            /**
             * RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
             * LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
             */
                /*
                 var disqus_config = function () {
                 this.page.url = PAGE_URL; // Replace PAGE_URL with your page's canonical URL variable
                 this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
                 };
                 */
            (function() { // DON'T EDIT BELOW THIS LINE
                var d = document, s = d.createElement('script');

                s.src = 'https://https-wd-2711-tech.disqus.com/embed.js';

                s.setAttribute('data-timestamp', +new Date());
                (d.head || d.body).appendChild(s);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by
                Disqus.</a></noscript>
    </div> -->
    <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
    <div id="vcomments"></div>
    <script>
        new Valine({
            el: '#vcomments',
            appId: 'wLIJ70s3fPvW8WJPgVVAuWVR-gzGzoHsz',
            appKey: 'NVGqxhUkqtFv2CbwmXXWjCdR'
        })
    </script>

    
</section>


	</div> <!-- col-md-9/col-md-12 -->
		
	
	<div id="side_meta">
		<div class="col-md-3" id="post_meta"> 

	<!-- date -->
	
	<div class="meta-widget">
	<i class="fa fa-clock-o"></i>
	2023-03-25 
	</div>
	

	<!-- categories -->
    
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#categorys"><i class="fa fa-folder"></i></a>	
    <ul id="categorys" class="tag_box list-unstyled collapse in">
          
  <li>
    <li><a href="/categories/re/">re<span>42</span></a></li>
  </li>

    </ul>
	</div>
	

	<!-- tags -->
		

	<!-- toc -->
	<div class="meta-widget">
	
	</div>
	
    <hr>
	
</div><!-- col-md-3 -->

	</div>

	<!-- copyright -->
	<div>
    <ul class="post-copyright">
      <li class="post-copyright-author">
      <strong>作者:  </strong>wd-z711</a>
      </li>
      <li class="post-copyright-link">
      <strong>文章链接:  </strong>
      <a href="/" target="_blank" title="">https://wd-2711.tech/</a>
      </li>
      <li class="post-copyright-license">
        <strong>版权声明:   </strong>
        本博客所有文章除特别声明外，均采用 <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">CC BY-NC-ND 4.0</a>
        许可协议。转载请注明出处!
      </li>
    </ul>
  <div>
 	

		


</div><!-- row -->




	</div>
  </div>
  <div class="container-narrow">
  <footer> <p>
  &copy; 2025 wd-z711
  
      <!-- with help from <a href="http://hexo.io/" target="_blank">Hexo</a>,<a target="_blank" rel="noopener" href="http://github.com/wzpan/hexo-theme-freemind/">Freemind</a>,<a href="http://getbootstrap.com/" target="_blank">Twitter Bootstrap</a> and <a href="http://getbootstrap.com/" target="_blank">BOOTSTRA.386</a>. 
     <br> Theme by <a target="_blank" rel="noopener" href="http://github.com/wzpan/hexo-theme-freemind/">Freemind.386</a>.     -->

     <!-- <script type="text/javascript">
      (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
      (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
      e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
      })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');
      
      _st('install','aB-vgeB8gEDrnRJuhceL','2.0.0');
    </script> -->
    </p>
 </footer>
</div> <!-- container-narrow -->
  


  
<a id="gotop" href="#">   
  <span>⬆︎TOP</span>
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/search.js"></script> 


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



   <script type="text/javascript">      
     var search_path = "search.xml";
	 if (search_path.length == 0) {
	 	search_path = "search.xml";
	 }
	 var path = "/" + search_path;
     searchFunc(path, 'local-search-input', 'local-search-result');
   </script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</body>
   </html>
