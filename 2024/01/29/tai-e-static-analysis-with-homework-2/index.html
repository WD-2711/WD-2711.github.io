<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="pragma" content="no-cache">
  <meta http-equiv="cache-control" content="no-cache">
  <meta http-equiv="expires" content="0">
  
  <title>tai_e-static-analysis-with-homework-2 | wd-z711&#39;s B10g</title>
  <meta name="author" content="wd-z711">
  
  <meta name="description" content="Common student in China. Interested in web &amp; re.">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="tai_e-static-analysis-with-homework-2"/>
  <meta property="og:site_name" content="wd-z711&#39;s B10g"/>

  
    <meta property="og:image" content=""/>
  

  
  
    <link href="/favicon.png" rel="icon">
  
  
  <link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>

  <!-- analytics -->
  
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'G-YHJSKZDC3Y', 'auto');
  ga('send', 'pageview');
</script>




<meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="wd-z711's B10g" type="application/atom+xml">
</head>

 <body>  
  <nav id="main-nav" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
      <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
		<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
	  <a class="navbar-brand" href="/">wd-z711&#39;s B10g</a>
      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		  
		  <li>
			<a href="/archives" title="All the articles.">
			  <i class="fa fa-archive"></i>Archives
			</a>
		  </li>
		  
		  <li>
			<a href="/categories" title="All the categories.">
			  <i class="fa fa-folder"></i>Categories
			</a>
		  </li>
		  
		  <li>
			<a href="/about" title="About me.">
			  <i class="fa fa-user"></i>About
			</a>
		  </li>
		  
		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
  	<div class="content">
    	 


	
		<div class="page-header">
			<h1> tai_e-static-analysis-with-homework-2</h1>
		</div>
	



<div class="row post">

	<!-- cols -->
	
	<div id="top_meta"></div>
	<div class="col-md-9">
	

	<!-- content -->
	<div class="mypage">		
	  		

	  <h1 id="Software-analysis-foundation-amp-homework-2"><a href="#Software-analysis-foundation-amp-homework-2" class="headerlink" title="Software analysis foundation &amp; homework-2"></a>Software analysis foundation &amp; homework-2</h1><h2 id="0x00-context-insensitive-pointer-analysis"><a href="#0x00-context-insensitive-pointer-analysis" class="headerlink" title="0x00 context-insensitive pointer analysis"></a>0x00 context-insensitive pointer analysis</h2><p>This homework will accomplish a context-insensitive pointer analysis, and build a call graph. This call graph will be more precise than call graph build by CHA. This pointer analysis algorithm handles 4 type pointers (local variables[Assign]/instance field[Store and Load]/instance call[]/static field/array index) and static method call.</p>
<span id="more"></span>
<h3 id="basic-knowledge"><a href="#basic-knowledge" class="headerlink" title="basic knowledge"></a>basic knowledge</h3><p>Pointer analysis will affect many types of statements, look at this table.</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>statement type</th>
<th>instance</th>
</tr>
</thead>
<tbody>
<tr>
<td>New</td>
<td>x = new T()</td>
</tr>
<tr>
<td>Assign</td>
<td>x = y</td>
</tr>
<tr>
<td>Store</td>
<td>x.f = y</td>
</tr>
<tr>
<td>Load</td>
<td>y = x.f</td>
</tr>
<tr>
<td>Call</td>
<td>r = x.k(a, …)</td>
</tr>
</tbody>
</table>
</div>
<p>Some domain and Notation characteristics are filled in below table:</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>domain name</th>
<th>notations</th>
<th>explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td>variables</td>
<td>$x,y \in V$</td>
<td>nop</td>
</tr>
<tr>
<td>fields</td>
<td>$f,g\in F$</td>
<td>nop</td>
</tr>
<tr>
<td>objects</td>
<td>$o_i,o_j \in O$</td>
<td>nop</td>
</tr>
<tr>
<td>instance field</td>
<td>$o_i.f,o_j.g \in O \times F$</td>
<td>nop</td>
</tr>
<tr>
<td>pointers</td>
<td>$Pointer = V \cup (O \times F)$</td>
<td>nop</td>
</tr>
<tr>
<td>pointers-to relations</td>
<td>$pt: Pointer \rightarrow P(O)$</td>
<td>P(O) denotes powerset of O. If we have pt(x), it denotes: many objects have been give to x (x may points to many objects), such as x=k;x=o.l();…, so many objects denotes k,o.l(),…. These objects is pt(x).</td>
</tr>
</tbody>
</table>
</div>
<p>After above introduction, we can build rules for different statement types:</p>
<p><img src="/images/tai-e-static-analysis-with-homework-2/image-20240130182513865.png" alt="image-20240130182513865" style="zoom:67%;" /></p>
<p>Pointer analysis is to propagate points-to information among pointers (variables &amp; fields). For example, in Load scenario, $o_j \in pt(o_i.f)$ will changed to $o_j \in pt(y)$. So the key to implementation is determined: when $pt(x)$ is changed, propagate the changed part to related pointers of $x$.</p>
<p>Pointer flow graph (PFG) of a program is a directed graph that express <code>how objects flow among the pointers in the program</code>. PFG’s nodes is $pointer$, and edges is $pointer \times pointer$. Edge $x \rightarrow y$ represents that the objects pointed by x may flow to y. Look at below table, we can know better:</p>
<p><img src="/images/tai-e-static-analysis-with-homework-2/image-20240130184316878.png" alt="image-20240130184316878" style="zoom:67%;" /></p>
<p>For example, we can build a call graph for the following program:</p>
<p><img src="/images/tai-e-static-analysis-with-homework-2/image-20240130185239374.png" alt="image-20240130185239374" style="zoom:67%;" /></p>
<p>With PFG, pointer analysis can be solved by computing transitive closure of the PFG, which means: if $e$ is reachable from $b$ on the PFG, then the objects pointed by $b$ may flow to and also be pointed by $e$.</p>
<p>Then, we may conclude method to implement pointer analysis. (1) Build pointer flow graph (PFG). (2) Propagate points-to information on PFG. But these two steps are not separated, but mutually dependent. The example above seems like do step (2), but it also dependent to $o_i \in pt(c), o_i \in pt(d)$. In conclusion, PFG is dynamically updated during pointer analysis.</p>
<p>The pointer analysis algorithm is displayed below:</p>
<p><img src="/images/tai-e-static-analysis-with-homework-2/image-20240130191654851.png" alt="image-20240130191654851" style="zoom:67%;" /></p>
<p>I think we may feel confused when we first see this algorithm. Let’s understand it. Worklist contains the point-to information to be processed, each worklist entry $[n,pts]$ is a pair of pointer $n$ and points-to set $pts$, <code>which means that pts should be propagated to pt(n)</code>. AddEdge (red box) is build edge between two pointers, and if $s \rightarrow t$, we will know that $s$’s pointer-to should passed to $t$.</p>
<p>And as we get an item from worklist, we want to calculate what we need to pass (differential propagation), that means $\Delta=pts-pt(n)$. Then, we will call Propagate (green box). In this function, we need do: (1) rich $pt(n)$ using $\delta$. (2) for $n$’s successors, we need add successors and $\Delta$ into worklist. We know that it has 4 types of statements, black box will handle <code>New</code> and <code>Assign</code> type, while other code will handle <code>Store</code> and <code>Load</code> types.</p>
<p>In the above pages, we discuss local variables/instance field’s pointer analysis. Then, we discuss pointer analysis in the presence of method invocation. We know that if we want to do pointer analysis, we need call graph. Even in inter-procedural pointer analysis, we also need call graph. There are two ways to build call graph, for example, we have code <code>b = a.bar()</code>.</p>
<p>(1) CHA. It resolves call targets based on declared type $a$, this way is not imprecise, introduce spurious call graph edges and points-to relations.</p>
<p>(2) Pointer analysis. It resolves call targets based on $pt(a)$, this way is more precise than CHA, this call graph is also dynamic build.</p>
<p>The graph below shows <code>Call</code> rule:</p>
<p><img src="/images/tai-e-static-analysis-with-homework-2/image-20240130221520243.png" alt="image-20240130221520243" style="zoom:67%;" /></p>
<p>As shown above, dotted line ($x\rightarrow m_{this}$) is not added to edges. Why? Assume $pt(x)={new\quad A, new\quad B, new\quad C}; x.foo()$. If we add edges, we need to add 3 edge (for A/B/C), which will introduce spurious points-to relations. If we combine above algorithm with inter-procedural pointer analysis, we need build call graph to do pointer analysis, algorithm will change to:</p>
<p><img src="/images/tai-e-static-analysis-with-homework-2/image-20240201184026425.png" alt="image-20240201184026425" style="zoom:67%;" /></p>
<p>In this homework, we may need to analysis more types statement: static related, array index and static method call. For static related, the rule is:</p>
<p><img src="/images/tai-e-static-analysis-with-homework-2/image-20240201192709926.png" alt="image-20240201192709926" style="zoom:67%;" /></p>
<p>For array index, we don’t distinguish array index (location). If $o_i$ represents an array object, then we use $o_i[*]$ to represent a pointer that points to all objects in array. The rule is:</p>
<p><img src="/images/tai-e-static-analysis-with-homework-2/image-20240201193341092.png" alt="image-20240201193341092" style="zoom:67%;" /></p>
<p>Static method handling is similar to instance method, except: (1) we needn’t to do $dispatch$ to resolve callee method. (2) we needn’t to pass receiver object. The rule is:</p>
<p><img src="/images/tai-e-static-analysis-with-homework-2/image-20240201193803565.png" alt="image-20240201193803565" style="zoom:67%;" /></p>
<h3 id="related-class"><a href="#related-class" class="headerlink" title="related class"></a>related class</h3><p>I pass this section because we can see in <a target="_blank" rel="noopener" href="http://tai-e.pascal-lab.net/pa5.html#_2-2%E6%96%B0%E5%88%86%E6%9E%90%E8%A7%84%E5%88%99">link1</a>.</p>
<h3 id="code"><a href="#code" class="headerlink" title="code"></a>code</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solver</span> &#123;</span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">addReachable</span><span class="params">(JMethod method)</span> &#123;</span><br><span class="line">        <span class="comment">// TODO - finish me</span></span><br><span class="line">        <span class="keyword">if</span> (!callGraph.contains(method)) &#123;</span><br><span class="line">            <span class="comment">// add m to RM, S = S merges with S_m</span></span><br><span class="line">            callGraph.addReachableMethod(method);</span><br><span class="line"></span><br><span class="line">            List&lt;Stmt&gt; methodStmt = method.getIR().getStmts();</span><br><span class="line">            <span class="keyword">for</span> (Stmt s: methodStmt) &#123;</span><br><span class="line">                <span class="keyword">if</span> (s <span class="keyword">instanceof</span> New) &#123;</span><br><span class="line">                    ((New)s).accept(stmtProcessor);</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (s <span class="keyword">instanceof</span> Copy) &#123;</span><br><span class="line">                    ((Copy)s).accept(stmtProcessor);</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (s <span class="keyword">instanceof</span> LoadField) &#123;</span><br><span class="line">                    ((LoadField)s).accept(stmtProcessor);</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (s <span class="keyword">instanceof</span> StoreField) &#123;</span><br><span class="line">                    ((StoreField)s).accept(stmtProcessor);</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (s <span class="keyword">instanceof</span> Invoke) &#123;</span><br><span class="line">                    ((Invoke)s).accept(stmtProcessor);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">class</span> <span class="title class_">StmtProcessor</span> <span class="keyword">implements</span> <span class="title class_">StmtVisitor</span>&lt;Void&gt; &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> Void <span class="title function_">visit</span><span class="params">(New stmt)</span> &#123;</span><br><span class="line">            <span class="comment">// x = new T();</span></span><br><span class="line">            Optional&lt;LValue&gt; tmp1 = stmt.getDef();</span><br><span class="line">            <span class="keyword">if</span> (tmp1.isPresent()) &#123;</span><br><span class="line">                <span class="type">LValue</span> <span class="variable">tmp2</span> <span class="operator">=</span> tmp1.get();</span><br><span class="line">                <span class="keyword">if</span> (tmp2 <span class="keyword">instanceof</span> Var) &#123;</span><br><span class="line">                    workList.addEntry(pointerFlowGraph.getVarPtr((Var)tmp2), <span class="keyword">new</span> <span class="title class_">PointsToSet</span>(heapModel.getObj((New)stmt)));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> Void <span class="title function_">visit</span><span class="params">(Copy stmt)</span> &#123;</span><br><span class="line">            <span class="comment">// x = y;</span></span><br><span class="line">            <span class="type">Var</span> <span class="variable">tmp1</span> <span class="operator">=</span> stmt.getLValue();</span><br><span class="line">            <span class="type">Var</span> <span class="variable">tmp2</span> <span class="operator">=</span> stmt.getRValue();</span><br><span class="line">            addPFGEdge(pointerFlowGraph.getVarPtr(tmp2), pointerFlowGraph.getVarPtr(tmp1));</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> Void <span class="title function_">visit</span><span class="params">(LoadField stmt)</span> &#123;</span><br><span class="line">            <span class="comment">// x = T.a;</span></span><br><span class="line">            <span class="type">FieldRef</span> <span class="variable">tmp1</span> <span class="operator">=</span> stmt.getFieldRef();</span><br><span class="line">            <span class="keyword">if</span> (tmp1.isStatic()) &#123;</span><br><span class="line">                <span class="type">JField</span> <span class="variable">tmp2</span> <span class="operator">=</span> tmp1.resolve();</span><br><span class="line">                <span class="type">Var</span> <span class="variable">tmp3</span> <span class="operator">=</span> stmt.getLValue();</span><br><span class="line">                addPFGEdge(pointerFlowGraph.getStaticField(tmp2), pointerFlowGraph.getVarPtr(tmp3));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> Void <span class="title function_">visit</span><span class="params">(StoreField stmt)</span> &#123;</span><br><span class="line">            <span class="comment">// T.a = x;</span></span><br><span class="line">            <span class="type">FieldRef</span> <span class="variable">tmp1</span> <span class="operator">=</span> stmt.getFieldRef();</span><br><span class="line">            <span class="keyword">if</span> (tmp1.isStatic()) &#123;</span><br><span class="line">                <span class="type">JField</span> <span class="variable">tmp2</span> <span class="operator">=</span> tmp1.resolve();</span><br><span class="line">                <span class="type">Var</span> <span class="variable">tmp3</span> <span class="operator">=</span> stmt.getRValue();</span><br><span class="line">                addPFGEdge(pointerFlowGraph.getVarPtr(tmp3), pointerFlowGraph.getStaticField(tmp2));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> Void <span class="title function_">visit</span><span class="params">(Invoke stmt)</span> &#123;</span><br><span class="line">            <span class="comment">// x = T.b(b1, b2, ...);</span></span><br><span class="line">            <span class="keyword">if</span> (stmt.isStatic()) &#123;</span><br><span class="line">                <span class="type">JMethod</span> <span class="variable">m</span> <span class="operator">=</span> resolveCallee(<span class="literal">null</span>, stmt);</span><br><span class="line">                <span class="keyword">if</span> (!callGraph.getCalleesOf(stmt).contains(m)) &#123;</span><br><span class="line">                    Edge&lt;Invoke, JMethod&gt; e = <span class="keyword">new</span> <span class="title class_">Edge</span>&lt;&gt;(getCallKind((stmt).getInvokeExp()), stmt, m);</span><br><span class="line">                    callGraph.addEdge(e);</span><br><span class="line">                    addReachable(m);</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// argument</span></span><br><span class="line">                    List&lt;Var&gt; args_source = stmt.getInvokeExp().getArgs();</span><br><span class="line">                    List&lt;Var&gt; args_target = m.getIR().getParams();</span><br><span class="line">                    <span class="keyword">assert</span> args_source.size() == args_target.size();</span><br><span class="line">                    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">ii</span> <span class="operator">=</span> <span class="number">0</span>; ii &lt; args_source.size(); ii++) &#123;</span><br><span class="line">                        <span class="type">Var</span> <span class="variable">source</span> <span class="operator">=</span> args_source.get(ii);</span><br><span class="line">                        <span class="type">Var</span> <span class="variable">target</span> <span class="operator">=</span> args_target.get(ii);</span><br><span class="line">                        addPFGEdge(pointerFlowGraph.getVarPtr(source), pointerFlowGraph.getVarPtr(target));</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// return</span></span><br><span class="line">                    <span class="keyword">if</span> (stmt.getLValue() != <span class="literal">null</span>) &#123;</span><br><span class="line">                        List&lt;Var&gt; ret_vars = m.getIR().getReturnVars();</span><br><span class="line">                        <span class="keyword">for</span> (Var v: ret_vars) &#123;</span><br><span class="line">                            addPFGEdge(pointerFlowGraph.getVarPtr(v), pointerFlowGraph.getVarPtr(stmt.getLValue()));</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">addPFGEdge</span><span class="params">(Pointer source, Pointer target)</span> &#123;</span><br><span class="line">        <span class="comment">// TODO - finish me</span></span><br><span class="line">        <span class="keyword">if</span> (!pointerFlowGraph.getSuccsOf(source).contains(target)) &#123;</span><br><span class="line">            pointerFlowGraph.addEdge(source, target);</span><br><span class="line">            <span class="keyword">if</span> (!source.getPointsToSet().isEmpty()) &#123;</span><br><span class="line">                workList.addEntry(target, source.getPointsToSet());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">analyze</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// TODO - finish me</span></span><br><span class="line">        <span class="keyword">while</span> (!workList.isEmpty())&#123;</span><br><span class="line">            <span class="comment">//remove</span></span><br><span class="line">            <span class="type">var</span> <span class="variable">entry</span> <span class="operator">=</span> workList.pollEntry();</span><br><span class="line">            <span class="comment">//propagate</span></span><br><span class="line">            <span class="type">PointsToSet</span> <span class="variable">subSet</span> <span class="operator">=</span> propagate(entry.pointer(),entry.pointsToSet());</span><br><span class="line"></span><br><span class="line">            <span class="comment">//load store</span></span><br><span class="line">            <span class="keyword">if</span>(entry.pointer() <span class="keyword">instanceof</span> VarPtr varPtr)&#123;</span><br><span class="line">                <span class="type">Var</span> <span class="variable">var</span> <span class="operator">=</span> varPtr.getVar();</span><br><span class="line">                <span class="keyword">for</span>(Obj obj : subSet)&#123;</span><br><span class="line">                    <span class="comment">//x.f = y</span></span><br><span class="line">                    <span class="keyword">for</span>(StoreField storeField : <span class="keyword">var</span>.getStoreFields())&#123;</span><br><span class="line">                        <span class="keyword">if</span>(!storeField.isStatic())</span><br><span class="line">                            addPFGEdge(pointerFlowGraph.getVarPtr(storeField.getRValue()),pointerFlowGraph.getInstanceField(obj,storeField.getFieldRef().resolve()));</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">//y = x.f</span></span><br><span class="line">                    <span class="keyword">for</span>(LoadField loadField : <span class="keyword">var</span>.getLoadFields())&#123;</span><br><span class="line">                        <span class="keyword">if</span>(!loadField.isStatic())</span><br><span class="line">                            addPFGEdge(pointerFlowGraph.getInstanceField(obj,loadField.getFieldRef().resolve()),pointerFlowGraph.getVarPtr(loadField.getLValue()));</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">//store array x[i] = y</span></span><br><span class="line">                    <span class="keyword">for</span>(StoreArray storeArray : <span class="keyword">var</span>.getStoreArrays())&#123;</span><br><span class="line">                        addPFGEdge(pointerFlowGraph.getVarPtr(storeArray.getRValue()),pointerFlowGraph.getArrayIndex(obj));</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">//load array y = x[i]</span></span><br><span class="line">                    <span class="keyword">for</span>(LoadArray loadArray : <span class="keyword">var</span>.getLoadArrays())&#123;</span><br><span class="line">                        addPFGEdge(pointerFlowGraph.getArrayIndex(obj), pointerFlowGraph.getVarPtr(loadArray.getLValue()));</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">//call (not static)</span></span><br><span class="line">                    processCall(<span class="keyword">var</span>,obj);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> PointsToSet <span class="title function_">propagate</span><span class="params">(Pointer pointer, PointsToSet pointsToSet)</span> &#123;</span><br><span class="line">        <span class="comment">// TODO - finish me</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// get diff</span></span><br><span class="line">        <span class="type">PointsToSet</span> <span class="variable">diff</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PointsToSet</span>();</span><br><span class="line">        <span class="keyword">if</span> (!pointsToSet.isEmpty()) &#123;</span><br><span class="line">            <span class="type">PointsToSet</span> <span class="variable">tmp1</span> <span class="operator">=</span> pointer.getPointsToSet();</span><br><span class="line">            <span class="keyword">for</span> (Obj i : pointsToSet) &#123;</span><br><span class="line">                <span class="keyword">if</span> (!tmp1.contains(i)) &#123;</span><br><span class="line">                    diff.addObject(i);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!diff.isEmpty()) &#123;</span><br><span class="line">            <span class="type">PointsToSet</span> <span class="variable">tmp1</span> <span class="operator">=</span> pointer.getPointsToSet();</span><br><span class="line">            <span class="keyword">for</span> (Obj i : diff) &#123;</span><br><span class="line">                tmp1.addObject(i);</span><br><span class="line">            &#125;</span><br><span class="line">            Set&lt;Pointer&gt; tmp2 = pointerFlowGraph.getSuccsOf(pointer);</span><br><span class="line">            <span class="keyword">for</span> (Pointer i: tmp2) &#123;</span><br><span class="line">                workList.addEntry(i, diff);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> diff;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">processCall</span><span class="params">(Var <span class="keyword">var</span>, Obj recv)</span> &#123;</span><br><span class="line">        <span class="comment">// TODO - finish me</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(Invoke i : <span class="keyword">var</span>.getInvokes()) &#123;</span><br><span class="line">            <span class="type">JMethod</span> <span class="variable">m</span> <span class="operator">=</span> resolveCallee(recv, i);</span><br><span class="line">            workList.addEntry(pointerFlowGraph.getVarPtr(m.getIR().getVar(<span class="number">0</span>)), <span class="keyword">new</span> <span class="title class_">PointsToSet</span>(recv));</span><br><span class="line">            <span class="keyword">if</span> (!callGraph.getCalleesOf(i).contains(m)) &#123;</span><br><span class="line">                Edge&lt;Invoke, JMethod&gt; e = <span class="keyword">new</span> <span class="title class_">Edge</span>&lt;&gt;(getCallKind((i).getInvokeExp()), i, m);</span><br><span class="line">                callGraph.addEdge(e);</span><br><span class="line">                addReachable(m);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// argument</span></span><br><span class="line">                List&lt;Var&gt; args_source = i.getInvokeExp().getArgs();</span><br><span class="line">                List&lt;Var&gt; args_target = m.getIR().getParams();</span><br><span class="line">                <span class="keyword">assert</span> args_source.size() == args_target.size();</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">ii</span> <span class="operator">=</span> <span class="number">0</span>; ii &lt; args_source.size(); ii++) &#123;</span><br><span class="line">                    <span class="type">Var</span> <span class="variable">source</span> <span class="operator">=</span> args_source.get(ii);</span><br><span class="line">                    <span class="type">Var</span> <span class="variable">target</span> <span class="operator">=</span> args_target.get(ii);</span><br><span class="line">                    addPFGEdge(pointerFlowGraph.getVarPtr(source), pointerFlowGraph.getVarPtr(target));</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// return</span></span><br><span class="line">                <span class="keyword">if</span> (i.getLValue() != <span class="literal">null</span>) &#123;</span><br><span class="line">                    List&lt;Var&gt; ret_vars = m.getIR().getReturnVars();</span><br><span class="line">                    <span class="keyword">for</span> (Var v: ret_vars) &#123;</span><br><span class="line">                        addPFGEdge(pointerFlowGraph.getVarPtr(v), pointerFlowGraph.getVarPtr(i.getLValue()));</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> CallKind <span class="title function_">getCallKind</span><span class="params">(InvokeExp invokeExp)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (invokeExp <span class="keyword">instanceof</span> InvokeVirtual) &#123;</span><br><span class="line">            <span class="keyword">return</span> CallKind.VIRTUAL;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (invokeExp <span class="keyword">instanceof</span> InvokeInterface) &#123;</span><br><span class="line">            <span class="keyword">return</span> CallKind.INTERFACE;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (invokeExp <span class="keyword">instanceof</span> InvokeSpecial) &#123;</span><br><span class="line">            <span class="keyword">return</span> CallKind.SPECIAL;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (invokeExp <span class="keyword">instanceof</span> InvokeStatic) &#123;</span><br><span class="line">            <span class="keyword">return</span> CallKind.STATIC;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (invokeExp <span class="keyword">instanceof</span> InvokeDynamic) &#123;</span><br><span class="line">            <span class="keyword">return</span> CallKind.DYNAMIC;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AnalysisException</span>(<span class="string">&quot;Cannot handle InvokeExp: &quot;</span> + invokeExp);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/images/tai-e-static-analysis-with-homework-2/image-20240208155318581.png" alt="image-20240208155318581" style="zoom:67%;" /></p>

  
	</div>

	<div>
  	<center>
	<div class="pagination">

    
    
    <a href="/2024/02/09/react-study/" type="button" class="btn btn-default"><i
                class="fa fa-arrow-circle-o-left"></i> 上一页</a>
    

    <a href="/" type="button" class="btn btn-default"><i class="fa fa-home"></i>Home</a>
    
    <a href="/2024/01/19/decompilation-history/" type="button" class="btn btn-default ">下一页<i
                class="fa fa-arrow-circle-o-right"></i></a>
    

    
</div>

    </center>
	</div>


	<!-- comment -->
	
<section id="comment">
    <h2 class="title">留言</h2>

    <!-- 
    <div id="disqus_thread" class="ds-thread">
        <script type="text/javascript">
            /**
             * RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
             * LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
             */
                /*
                 var disqus_config = function () {
                 this.page.url = PAGE_URL; // Replace PAGE_URL with your page's canonical URL variable
                 this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
                 };
                 */
            (function() { // DON'T EDIT BELOW THIS LINE
                var d = document, s = d.createElement('script');

                s.src = 'https://https-wd-2711-tech.disqus.com/embed.js';

                s.setAttribute('data-timestamp', +new Date());
                (d.head || d.body).appendChild(s);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by
                Disqus.</a></noscript>
    </div> -->
    <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
    <div id="vcomments"></div>
    <script>
        new Valine({
            el: '#vcomments',
            appId: 'wLIJ70s3fPvW8WJPgVVAuWVR-gzGzoHsz',
            appKey: 'NVGqxhUkqtFv2CbwmXXWjCdR'
        })
    </script>

    
</section>


	</div> <!-- col-md-9/col-md-12 -->
		
	
	<div id="side_meta">
		<div class="col-md-3" id="post_meta"> 

	<!-- date -->
	
	<div class="meta-widget">
	<i class="fa fa-clock-o"></i>
	2024-01-29 
	</div>
	

	<!-- categories -->
    
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#categorys"><i class="fa fa-folder"></i></a>	
    <ul id="categorys" class="tag_box list-unstyled collapse in">
          
  <li>
    <li><a href="/categories/static-analysis/">static-analysis<span>2</span></a></li>
  </li>

    </ul>
	</div>
	

	<!-- tags -->
		

	<!-- toc -->
	<div class="meta-widget">
	
	   <a data-toggle="collapse" data-target="#toc"><i class="fa fa-bars"></i></a>
	   <div id="toc" class="toc collapse in">
		   <span class="toc-title">Contents</span>
			<ol class="toc-article"><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#Software-analysis-foundation-amp-homework-2"><span class="toc-article-text">Software analysis foundation &amp; homework-2</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#0x00-context-insensitive-pointer-analysis"><span class="toc-article-text">0x00 context-insensitive pointer analysis</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#basic-knowledge"><span class="toc-article-text">basic knowledge</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#related-class"><span class="toc-article-text">related class</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#code"><span class="toc-article-text">code</span></a></li></ol></li></ol></li></ol>
		</div>
	
	</div>
	
    <hr>
	
</div><!-- col-md-3 -->

	</div>

	<!-- copyright -->
	<div>
    <ul class="post-copyright">
      <li class="post-copyright-author">
      <strong>作者:  </strong>wd-z711</a>
      </li>
      <li class="post-copyright-link">
      <strong>文章链接:  </strong>
      <a href="/" target="_blank" title="">https://wd-2711.tech/</a>
      </li>
      <li class="post-copyright-license">
        <strong>版权声明:   </strong>
        本博客所有文章除特别声明外，均采用 <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">CC BY-NC-ND 4.0</a>
        许可协议。转载请注明出处!
      </li>
    </ul>
  <div>
 	

		


</div><!-- row -->




	</div>
  </div>
  <div class="container-narrow">
  <footer> <p>
  &copy; 2025 wd-z711
  
      <!-- with help from <a href="http://hexo.io/" target="_blank">Hexo</a>,<a target="_blank" rel="noopener" href="http://github.com/wzpan/hexo-theme-freemind/">Freemind</a>,<a href="http://getbootstrap.com/" target="_blank">Twitter Bootstrap</a> and <a href="http://getbootstrap.com/" target="_blank">BOOTSTRA.386</a>. 
     <br> Theme by <a target="_blank" rel="noopener" href="http://github.com/wzpan/hexo-theme-freemind/">Freemind.386</a>.     -->

     <!-- <script type="text/javascript">
      (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
      (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
      e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
      })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');
      
      _st('install','aB-vgeB8gEDrnRJuhceL','2.0.0');
    </script> -->
    </p>
 </footer>
</div> <!-- container-narrow -->
  


  
<a id="gotop" href="#">   
  <span>⬆︎TOP</span>
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/search.js"></script> 


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



   <script type="text/javascript">      
     var search_path = "search.xml";
	 if (search_path.length == 0) {
	 	search_path = "search.xml";
	 }
	 var path = "/" + search_path;
     searchFunc(path, 'local-search-input', 'local-search-result');
   </script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</body>
   </html>
